{"code":"(window.webpackJsonp=window.webpackJsonp||[]).push([[7],{1143:function(e,t,a){\"use strict\";Object.defineProperty(t,\"__esModule\",{value:!0});var n=u(a(6)),i=u(a(238)),r=u(a(1144)),l=u(a(1146)),o=u(a(1148)),s=u(a(1150)),c=u(a(1152)),d=a(7);function u(e){return e&&e.__esModule?e:{default:e}}t.default=function(){var e=n.default.module(\"waltz.measurable\",[]);return(0,d.registerStores)(e,[i.default]),(0,d.registerComponents)(e,[r.default,l.default,o.default,s.default]),e.config(c.default),e.name}},1144:function(e,t,a){\"use strict\";Object.defineProperty(t,\"__esModule\",{value:!0});var n=function(e){return e&&e.__esModule?e:{default:e}}(a(1145)),i=a(0),r=a(2),l=a(12),o=a(396);var s={MENU:\"MENU\",OPERATION:\"OPERATION\"},c={modes:s,mode:s.MENU,selectedOperation:null,preview:null,command:null};function d(e,t,a){var n=(0,i.initialiseData)(this,c);var d={name:\"Update\",description:\"These are operations modify an existing taxonomy element.  Care must be taken \\n                to prevent inadvertently altering the <em>meaning</em> of nodes.  The operations \\n                will not result in data loss.\",options:[{name:\"Name\",code:\"UPDATE_NAME\",title:\"Update name\",description:\"The name of the taxonomy item may be changed, however care should be \\n                    taken to prevent inadvertently altering the <em>meaning</em> of the item\",icon:\"edit\"},{name:\"Description\",code:\"UPDATE_DESCRIPTION\",icon:\"edit\"},{name:\"Concrete\",code:\"UPDATE_CONCRETENESS\",title:\"Update Concrete Flag\",description:\"The concrete flag is used to determine whether applications may\\n                    use this taxonomy item to describe themselves via ratings.  Typically\\n                    higher level <em>grouping</em> items are non-concrete as they are not\\n                    specific enough to accurately describe the portfolio.\",icon:\"edit\",onShow:function(){return n.command=function(e){return{changeType:n.selectedOperation.code,changeDomain:(0,l.toEntityRef)(n.changeDomain),a:(0,l.toEntityRef)(n.measurable),newValue:e+\"\",createdBy:n.userName}}(!n.measurable.concrete),t.execute(r.CORE_API.TaxonomyManagementStore.preview,[n.command]).then(function(e){n.preview=e.data,n.submitButtonClass=(0,o.severityToBootstrapBtnClass)((0,o.findHighestSeverity)(_.map(n.preview.impacts,\"severity\")))})}},{name:\"External Id\",code:\"UPDATE_EXTERNAL_ID\",icon:\"edit\"},{name:\"Move\",code:\"MOVE\",icon:\"arrows\"}]};n.menus=[d,{name:\"Create\",description:\"These operations introduce new elements in the taxonomy. They will \\n                <strong>not</strong> result in data loss.\",color:\"#0b8829\",options:[{name:\"Add Child\",code:\"ADD\",icon:\"plus-circle\"},{name:\"Clone\",code:\"CLONE\",icon:\"clone\"}]},{name:\"Destructive\",description:\"These operations <strong>will</strong> potentially result in data loss and \\n                should be used with care\",color:\"#b40400\",options:[{name:\"Merge\",code:\"MERGE\",icon:\"code-fork\"},{name:\"Deprecate\",code:\"DEPRECATE\",icon:\"exclamation-triangle\"},{name:\"Destroy\",code:\"REMOVE\",icon:\"trash\"}]}],n.$onInit=function(){a.whoami().then(function(e){return n.userName=e.userName})},n.$onChanges=function(e){e.measurable&&n.onDismiss()},n.toTemplateName=function(e){return\"wmcc/\"+e.code+\".html\"},n.onDismiss=function(){n.mode=s.MENU,n.command=null,n.preview=null},n.onSelectOperation=function(e){return n.mode=s.OPERATION,n.selectedOperation=e,_.isFunction(e.onShow)?e.onShow():Promise.resolve()},n.onSubmitChange=function(){t.execute(r.CORE_API.TaxonomyManagementStore.submitPendingChange,[n.command]).then(function(t){return e.info(\"Change submitted\")})}}d.$inject=[\"Notification\",\"ServiceBroker\",\"UserService\"];var u={bindings:{measurable:\"<\",changeDomain:\"<\"},controller:d,template:n.default};t.default={id:\"waltzMeasurableChangeControl\",component:u}},1145:function(e,t){e.exports='<div ng-switch=$ctrl.mode> <div ng-switch-when=MENU> <div class=row> <div class=col-sm-12> <h4>Available Options</h4> <div class=help-block> Select an operation from the menu below. Hover over each item to see a more detailed description. </div> </div> </div> <div class=row> <div class=col-md-4 ng-repeat=\"menu in $ctrl.menus\"> <div ng-include=\"\\'wmcc/menu.html\\'\"></div> </div> </div> </div> <div ng-switch-when=OPERATION> <div class=row> <div class=col-sm-12> <h4 ng-bind=\"$ctrl.selectedOperation.title || $ctrl.selectedOperation.name\"></h4> <div class=help-block ng-bind-html=$ctrl.selectedOperation.description> </div> </div> </div> <div class=row> <div class=col-sm-12> <hr> <div ng-include=$ctrl.toTemplateName($ctrl.selectedOperation)> </div> </div> </div> <div class=row> <div class=col-sm-12> <hr> <a ng-click=$ctrl.onSubmitChange() class=\"btn btn-sm\" ng-class=$ctrl.submitButtonClass> Submit change </a> | <a ng-click=$ctrl.onDismiss() class=clickable> Close </a> </div> </div> </div> </div> <script type=text/ng-template id=wmcc/UPDATE_CONCRETENESS.html> <p>\\n        The concrete flag for this taxonomy item is currently set\\n        to <kbd ng-bind=\"$ctrl.measurable.concrete\"></kbd>\\n    </p>\\n    <p>\\n        Setting it to <kbd ng-bind=\"! $ctrl.measurable.concrete\"></kbd>\\n        will have the following impact:\\n    </p>\\n\\n    <waltz-taxonomy-change-command-preview preview=\"$ctrl.preview\">\\n    </waltz-taxonomy-change-command-preview> <\\/script> <script type=text/ng-template id=wmcc/menu.html> <h5 ng-bind=\"menu.name\"></h5>\\n    <ul class=\"list-unstyled\">\\n        <li ng-repeat=\"opt in menu.options\">\\n            <a class=\"clickable\"\\n               uib-popover-template=\"\\'wmcc/operation-popup.html\\'\"\\n               popover-append-to-body=\"true\"\\n               popover-placement=\"top\"\\n               popover-trigger=\"mouseenter click\"\\n               popover-enable=\"opt.description\"\\n               popover-popup-delay=\"200\"\\n               ng-click=\"$ctrl.onSelectOperation(opt)\"\\n               ng-style=\"{color: menu.color}\">\\n                <waltz-icon name=\"{{opt.icon}}\"></waltz-icon>\\n                <span ng-bind=\"opt.name\"></span>\\n            </a>\\n        </li>\\n    </ul>\\n    <div class=\"help-block\"\\n         ng-bind-html=\"menu.description\">\\n    </div> <\\/script> <script type=text/ng-template id=wmcc/operation-popup.html> <div class=\"small\">\\n        <div ng-bind-html=\"opt.description\"></div>\\n    </div> <\\/script> '},1146:function(e,t,a){\"use strict\";Object.defineProperty(t,\"__esModule\",{value:!0});var n={template:function(e){return e&&e.__esModule?e:{default:e}}(a(1147)).default,controller:function(){},bindings:{measurable:\"<\"}};t.default={id:\"waltzMeasurableInfo\",component:n}},1147:function(e,t){e.exports='<div class=row> <div class=\"col-sm-4 waltz-display-field-label\"> Name </div> <div class=col-sm-8> <span ng-bind=$ctrl.measurable.name></span> </div> </div> <div class=row> <div class=\"col-sm-4 waltz-display-field-label\"> External Id </div> <div class=col-sm-8> <span ng-bind=$ctrl.measurable.externalId></span> </div> </div> <div class=row> <div class=\"col-sm-4 waltz-display-field-label\"> Concrete </div> <div class=col-sm-8> <waltz-toggle state=$ctrl.measurable.concrete read-only=true label-on=Concrete label-off=\"Not concrete\"> </waltz-toggle> </div> </div> <div class=row> <div class=\"col-sm-4 waltz-display-field-label\"> Description </div> <div class=col-sm-8> <waltz-markdown ng-if=$ctrl.measurable.description text=$ctrl.measurable.description> </waltz-markdown> <span ng-if=!$ctrl.measurable.description> Description not provided </span> </div> </div>'},1148:function(e,t,a){\"use strict\";Object.defineProperty(t,\"__esModule\",{value:!0});var n=c(a(1)),i=a(0),r=a(151),l=a(30),o=a(24),s=c(a(1149));function c(e){return e&&e.__esModule?e:{default:e}}var d={linkToState:\"main.measurable.view\",expandedNodes:[],hierarchy:[],searchNodes:[],searchTerms:\"\",chartScale:function(){return 0},treeOptions:{nodeChildren:\"children\",dirSelectable:!0,equality:function(e,t){return!(!e||!t)&&e.id===t.id}}},u=(0,r.buildPropertySummer)();function p(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],t=(0,o.buildHierarchies)(e,!1);return n.default.each(t,function(e){return u(e)}),t}function f(){var e=(0,i.initialiseData)(this,d);e.searchTermsChanged=function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:\"\";e.hierarchy=p((0,o.doSearch)(t,e.searchNodes))},e.clearSearch=function(){e.searchTermsChanged(\"\"),e.searchTerms=\"\"},e.$onChanges=function(t){t.measurables&&(e.searchNodes=(0,o.prepareSearchNodes)(e.measurables),e.hierarchy=p(e.measurables),e.expandedNodes=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];return e.length<6?n.default.clone(e):[]}(e.hierarchy),e.chartScale=function(e){var t=n.default.get(n.default.maxBy(e,\"totalCount\"),\"totalCount\")||0;return(0,l.scaleLinear)().range([0,100]).domain([0,t])}(e.hierarchy))}}f.$inject=[];var m={template:s.default,bindings:{measurables:\"<\",onSelect:\"<?\",linkToState:\"@?\"},controller:f};t.default={component:m,id:\"waltzMeasurableTree\"}},1149:function(e,t){e.exports='<div class=wmt-search-region> <waltz-icon name=search ng-class=\"{\\n                    \\'wmt-search-active\\' : $ctrl.searchTerms.length > 0,\\n                    \\'wmt-search-inactive\\' : $ctrl.searchTerms.length == 0\\n                }\"> </waltz-icon> <input type=search class=form-control name=searchTerms ng-model=$ctrl.searchTerms ng-change=$ctrl.searchTermsChanged($ctrl.searchTerms) ng-model-options=\"{ debounce: 200 }\" placeholder=Search> &nbsp; <waltz-icon name=close style=color:#8b0000 ng-if=\"$ctrl.searchTerms.length > 0\" class=clickable ng-click=$ctrl.clearSearch()> </waltz-icon> </div> <treecontrol class=tree-light tree-model=$ctrl.hierarchy options=$ctrl.treeOptions expanded-nodes=$ctrl.expandedNodes order-by=\"\\'-name\\'\"> <span uib-popover-template=\"\\'wmt/measurable-popup.html\\'\" popover-append-to-body=true popover-placement=right popover-trigger=\"mouseenter click\" popover-enable=\"node.totalCount > 0 || node.description\" popover-popup-delay=200 ng-class=\"{ \\'text-muted\\': node.rating == null }\" class=no-overflow> <span ng-if=$ctrl.onSelect class=clickable ng-click=$ctrl.onSelect(node)> <span ng-include=\"\\'wmt/measurable-node.html\\'\"></span> </span> <a ng-if=!$ctrl.onSelect ui-state=$ctrl.linkToState ui-state-params=\"{id: node.id }\"> <span ng-include=\"\\'wmt/measurable-node.html\\'\"></span> </a> </span> </treecontrol> <script type=text/ng-template id=wmt/measurable-popup.html> <div class=\"small\">\\n        <waltz-markdown text=\"node.description\"></waltz-markdown>\\n        <div ng-if=\"node.totalCount > 0\" class=\"small text-muted\">\\n            <hr>\\n            <span ng-bind=\"node.totalCount\"></span> applications\\n        </div>\\n    </div> <\\/script> <script type=text/ng-template id=wmt/measurable-node.html> <span ng-class=\"{ \\'italics\\' : ! node.concrete }\"\\n          ng-bind=\"node.name\">\\n    </span>\\n    <span class=\"wmt-bar-chart\"\\n          ng-if=\"node.totalCount > 0\"\\n          ng-style=\"{width: $ctrl.chartScale(node.totalCount) + \\'px\\'}\">\\n    </span> <\\/script>'},1150:function(e,t,a){\"use strict\";Object.defineProperty(t,\"__esModule\",{value:!0});var n=u(a(1)),i=a(152),r=a(111),l=a(2),o=a(80),s=a(29),c=u(a(1151)),d=a(0);function u(e){return e&&e.__esModule?e:{default:e}}var p={scope:\"CHILDREN\"};function f(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];return n.default.map(e,function(e){return Object.assign({},e,{entityReference:{kind:\"MEASURABLE\",id:e.id,name:e.name,description:e.description}})})}function m(e){var t=(0,d.initialiseData)(this,p);t.$onInit=function(){var a={entityReference:t.parentEntityRef,scope:t.scope};e.loadViewData(l.CORE_API.AssetCostStore.findTotalCostForAppSelector,[a]).then(function(e){return t.totalCost=e.data}),e.loadViewData(l.CORE_API.ComplexityStore.findBySelector,[a]).then(function(e){return t.complexitySummary=(0,r.calcComplexitySummary)(e.data)})},t.$onChanges=function(a){a.serverStats&&(t.enrichedServerStats=(0,i.enrichServerStats)(t.serverStats)),(a.children||a.measurable)&&(t.childRefs=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return f(n.default.chain(e).filter(function(e){return e.id!==t.id}).filter(function(e){return e.parentId===t.id}).value())}(t.children,t.measurable)),(a.parents||a.measurable)&&(t.parentRefs=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return f(n.default.filter(e,function(e){return e.id!==t.id}))}(t.parents,t.measurable)),t.measurable&&(t.entityRef={kind:\"MEASURABLE\",id:t.measurable.id},e.loadViewData(l.CORE_API.MeasurableRelationshipStore.tallyByEntityReference,[{id:t.measurable.id,kind:\"MEASURABLE\"}]).then(function(e){return t.relationshipStats=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];return n.default.chain(e).map(function(e,t){return{kind:t,name:(0,s.getEnumName)(o.entity,t),count:e}}).orderBy(\"name\").value()}(e.data)}))}}m.$inject=[\"ServiceBroker\"];var g={template:c.default,bindings:{parentEntityRef:\"<\",scope:\"@?\",applications:\"<\",children:\"<\",measurable:\"<\",parents:\"<\",serverStats:\"<\"},controller:m};t.default={component:g,id:\"waltzMeasurableSummary\"}},1151:function(e,t){e.exports='<div class=\"waltz-page-summary waltz-page-summary-attach\"> <waltz-no-data ng-if=!$ctrl.measurable> <message>No information for this measurable</message> </waltz-no-data> <div ng-if=$ctrl.measurable> <div class=row> <div class=col-sm-5> <waltz-sub-section name=Overview> <content> <div style=padding:8px> <waltz-measurable-info measurable=$ctrl.measurable> </waltz-measurable-info> </div> </content> </waltz-sub-section> </div> <div class=col-sm-7> <div ng-if=\"$ctrl.applications.length > 0 || $ctrl.relationshipStats.length > 0\"> <waltz-sub-section name=Stats> <content> <div class=row style=padding:8px> <div class=col-sm-4 ng-if=\"$ctrl.applications.length > 0\"> <waltz-basic-info-tile name=\"App Stats\" icon=rocket> <div style=font-size:large waltz-jump-to=costs-section> Cost: <waltz-currency-amount amount=$ctrl.totalCost.amount simplify=true> </waltz-currency-amount> </div> <div style=font-size:large waltz-jump-to=complexity-section> Complexity: <span ng-bind=\"$ctrl.complexitySummary.cumulativeScore | toFixed:1\"></span> </div> <div style=font-size:large ng-if=\"$ctrl.enrichedServerStats.total > 0\" waltz-jump-to=technologies-section> Servers #: <span ng-bind=$ctrl.enrichedServerStats.total></span> </div> </waltz-basic-info-tile> </div> <div class=col-sm-4 ng-if=\"$ctrl.applications.length > 0\"> <waltz-apps-by-investment-pie applications=$ctrl.applications size=70> </waltz-apps-by-investment-pie> </div> <div class=col-sm-4 ng-if=\"$ctrl.relationshipStats.length > 0\"> <waltz-basic-info-tile name=Relationships waltz-jump-to=related-measurables icon=link> <div ng-repeat=\"category in $ctrl.relationshipStats\" style=font-size:large> <span ng-bind=category.name></span>: <span ng-bind=category.count></span> </div> </waltz-basic-info-tile> </div> </div> </content> </waltz-sub-section> </div> </div> </div> <div class=row style=padding:1em> <div class=col-md-10> <waltz-immediate-hierarchy-navigator parents=$ctrl.parentRefs children=$ctrl.childRefs> </waltz-immediate-hierarchy-navigator> </div> </div> </div> </div>'},1152:function(e,t,a){\"use strict\";Object.defineProperty(t,\"__esModule\",{value:!0});var n=function(){return function(e,t){if(Array.isArray(e))return e;if(Symbol.iterator in Object(e))return function(e,t){var a=[],n=!0,i=!1,r=void 0;try{for(var l,o=e[Symbol.iterator]();!(n=(l=o.next()).done)&&(a.push(l.value),!t||a.length!==t);n=!0);}catch(e){i=!0,r=e}finally{try{!n&&o.return&&o.return()}finally{if(i)throw r}}return a}(e,t);throw new TypeError(\"Invalid attempt to destructure non-iterable instance\")}}(),i=o(a(1)),r=o(a(1153)),l=a(2);function o(e){return e&&e.__esModule?e:{default:e}}var s={},c={url:\"measurable/{id:int}\",views:{\"content@\":r.default}};function d(e,t,a,r){var o=a.category,s=a.externalId;e.all([r.loadAppData(l.CORE_API.MeasurableCategoryStore.findAll),r.loadViewData(l.CORE_API.MeasurableStore.findByExternalId,[s])]).then(function(e){var a=n(e,2),r=a[0],l=a[1],c=r.data,d=l.data,u=i.default.find(c,{externalId:o});if(u){var p=i.default.find(d,{categoryId:u.id});p?t.go(\"main.measurable.view\",{id:p.id}):console.log(\"Cannot find measure corresponding category: \"+o+\", external id: \"+s)}else console.log(\"Cannot find measure corresponding category: \"+o+\", external id: \"+s)})}d.$inject=[\"$q\",\"$state\",\"$stateParams\",\"ServiceBroker\"];var u={url:\"measurable/external-id/{category:string}/{externalId:string}\",resolve:{bouncer:d}};function p(e){e.state(\"main.measurableBouncer\",u).state(\"main.measurable\",s).state(\"main.measurable.view\",c)}p.$inject=[\"$stateProvider\"],t.default=p},1153:function(e,t,a){\"use strict\";Object.defineProperty(t,\"__esModule\",{value:!0});var n=s(a(1)),i=a(0),r=a(24),l=s(a(1154)),o=a(2);function s(e){return e&&e.__esModule?e:{default:e}}var c={sections:[],availableSections:[]};function d(e,t,a,l,s){var d=t.id,u={id:d,kind:\"MEASURABLE\"},p={entityReference:u,scope:\"CHILDREN\"},f=(0,i.initialiseData)(this,c);f.entityReference=u,f.selector=p,f.scope=p.scope;e.all([l.loadAppData(o.CORE_API.MeasurableStore.findAll,[]).then(function(e){var t=e.data,a=(0,r.populateParents)(t);f.measurable=n.default.find(a,{id:d}),f.entityReference=Object.assign({},f.entityReference,{name:f.measurable.name}),f.parents=(0,r.getParents)(f.measurable),f.children=n.default.chain(t).filter({parentId:d}).sortBy(\"name\").value()})]).then(function(){return e.all([l.loadAppData(o.CORE_API.MeasurableCategoryStore.findAll).then(function(e){return f.measurableCategory=n.default.find(e.data,{id:f.measurable.categoryId})}),l.loadViewData(o.CORE_API.ApplicationStore.findBySelector,[p]).then(function(e){return f.applications=e.data}),l.loadViewData(o.CORE_API.TechnologyStatisticsService.findBySelector,[p]).then(function(e){return f.techStats=e.data})])}).then(function(){return function(e,t){return t.put(e.name,\"MEASURABLE\",\"main.measurable.view\",{id:e.id})}(f.measurable,s)}),f.$onInit=function(){f.availableSections=a.findAvailableSectionsForKind(\"MEASURABLE\"),f.sections=a.findUserSectionsForKind(\"MEASURABLE\")},f.addSection=function(e){return f.sections=a.openSection(e,\"MEASURABLE\")},f.removeSection=function(e){return f.sections=a.removeSection(e,\"MEASURABLE\")}}d.$inject=[\"$q\",\"$stateParams\",\"DynamicSectionManager\",\"ServiceBroker\",\"HistoryStore\"],t.default={template:l.default,controller:d,controllerAs:\"ctrl\"}},1154:function(e,t){e.exports='<div> <waltz-page-header name=\"{{ ctrl.measurable.name }}\" icon=puzzle-piece tour=ctrl.tour small=\"{{ ctrl.measurableCategory.name }}\"> <ol class=waltz-breadcrumbs> <li><a ui-sref=main>Home</a></li> <li><a ui-sref=\"main.measurable-category.list ({id: ctrl.measurableCategory.id })\" ng-bind=ctrl.measurableCategory.name ng-if=ctrl.measurable> </a> <a ng-if=!ctrl.measurable> Measurable </a> </li> <li><span ng-bind=ctrl.measurable.name ng-if=ctrl.measurable></span></li> </ol> </waltz-page-header> <waltz-measurable-summary parent-entity-ref=ctrl.entityReference scope=CHILDREN applications=ctrl.applications children=ctrl.children measurable=ctrl.measurable parents=ctrl.parents server-stats=ctrl.techStats.serverStats> </waltz-measurable-summary> <div ng-if=ctrl.measurable> <div class=\"waltz-page-summary waltz-page-summary-attach\"> <waltz-dynamic-section-navigation available-sections=ctrl.availableSections open-sections=ctrl.sections on-select=ctrl.addSection offset=650> </waltz-dynamic-section-navigation> </div> <br> <waltz-dynamic-sections-view sections=ctrl.sections parent-entity-ref=ctrl.entityReference on-remove=ctrl.removeSection> </waltz-dynamic-sections-view> </div> </div>'},1155:function(e,t,a){\"use strict\";Object.defineProperty(t,\"__esModule\",{value:!0});var n=o(a(6)),i=o(a(235)),r=o(a(1156)),l=a(7);function o(e){return e&&e.__esModule?e:{default:e}}t.default=function(){var e=n.default.module(\"waltz.measurable-category\",[]);return(0,l.registerStores)(e,[i.default]),e.config(r.default),e.name}},1156:function(e,t,a){\"use strict\";Object.defineProperty(t,\"__esModule\",{value:!0});var n=o(a(1)),i=o(a(1157)),r=o(a(1159)),l=a(154);function o(e){return e&&e.__esModule?e:{default:e}}var s={};function c(e,t,a,i){var r=function(t){return e.go(\"main.measurable-category.list\",{id:t},{location:\"replace\"})},o=function(){return i.findOrDefault(\"settings.measurable.default-category\",null).then(function(e){r(e||1)})};a.loadPreferences(!0).then(function(e){var t=e[l.lastViewedMeasurableCategoryKey];n.default.get(t,\"value\",0)>0?r(t.value):o()})}c.$inject=[\"$state\",\"$stateParams\",\"UserPreferenceService\",\"SettingsService\"];var d={url:\"measurable-category/\",resolve:{bouncer:c}},u={url:\"measurable-category/{id:int}\",views:{\"content@\":i.default}},p={url:\"measurable-category/{id:int}/edit\",views:{\"content@\":r.default}};function f(e){e.state(\"main.measurable-category\",s).state(\"main.measurable-category.index\",d).state(\"main.measurable-category.list\",u).state(\"main.measurable-category.edit\",p)}f.$inject=[\"$stateProvider\"],t.default=f},1157:function(e,t,a){\"use strict\";Object.defineProperty(t,\"__esModule\",{value:!0});var n=function(){return function(e,t){if(Array.isArray(e))return e;if(Symbol.iterator in Object(e))return function(e,t){var a=[],n=!0,i=!1,r=void 0;try{for(var l,o=e[Symbol.iterator]();!(n=(l=o.next()).done)&&(a.push(l.value),!t||a.length!==t);n=!0);}catch(e){i=!0,r=e}finally{try{!n&&o.return&&o.return()}finally{if(i)throw r}}return a}(e,t);throw new TypeError(\"Invalid attempt to destructure non-iterable instance\")}}(),i=c(a(1)),r=a(0),l=a(2),o=c(a(1158)),s=a(154);function c(e){return e&&e.__esModule?e:{default:e}}var d={category:null};function u(e,t,a,o,c){var u=(0,r.initialiseData)(this,d),p=a.id;u.$onInit=function(){c.savePreference(s.lastViewedMeasurableCategoryKey,p);var r=o.loadAppData(l.CORE_API.MeasurableStore.findAll).then(function(e){return u.measurablesByCategory=i.default.groupBy(e.data,function(e){return e.categoryId}),u.measurablesByCategory[p]});o.loadAppData(l.CORE_API.MeasurableCategoryStore.findAll).then(function(e){u.categories=e.data,u.category=i.default.find(u.categories,{id:a.id})});var d=o.loadViewData(l.CORE_API.MeasurableRatingStore.countByMeasurableCategory,[p]).then(function(e){return e.data});o.loadAppData(l.CORE_API.SvgDiagramStore.findByGroups,[\"NAVAID.MEASURABLE.\"+p]).then(function(e){return u.diagrams=e.data}),e.all([r,d]).then(function(e){var a=n(e,2),r=a[0],l=a[1],o=i.default.keyBy(l,\"id\");u.measurables=i.default.map(r,function(e){return Object.assign({},e,{directCount:function(e){return i.default.get(o,[e,\"count\"],0)}(e.id)})}),u.measurablesByExtId=i.default.keyBy(r,\"externalId\"),u.blockProcessor=function(e){var a=e.value,n=u.measurablesByExtId[a];n?(e.block.onclick=function(){return t.go(\"main.measurable.view\",{id:n.id})},angular.element(e.block).addClass(\"clickable\")):console.log(\"MeasurableList: Could not find measurable with external id: \"+a,e)}})}}u.$inject=[\"$q\",\"$state\",\"$stateParams\",\"ServiceBroker\",\"UserPreferenceService\"],t.default={template:o.default,controller:u,controllerAs:\"$ctrl\"}},1158:function(e,t){e.exports='<div> <waltz-page-header name={{$ctrl.category.name}} small=Viewpoints icon=puzzle-piece> <ol class=waltz-breadcrumbs> <li> <a ui-sref=main> Home </a> </li> <li> <span ng-bind=$ctrl.category.name> </span> </li> </ol> </waltz-page-header> <div class=\"waltz-page-summary-attach waltz-page-summary\"> <div class=row> <div class=col-md-12> <div class=waltz-tabs> <span class=wt-tab-header ng-repeat=\"tab in $ctrl.categories track by tab.id\" ng-class=\"{\\n                                \\'wt-active\\' : tab.id === $ctrl.category.id,\\n                                \\'wt-disabled\\' : ! $ctrl.measurablesByCategory[tab.id]\\n                          }\"> <a ng-if=$ctrl.measurablesByCategory[tab.id] ui-sref=\"main.measurable-category.list ({ id:tab.id })\"> <span ng-bind=tab.name> </span> </a> <span ng-bind=tab.name ng-if=\"! $ctrl.measurablesByCategory[tab.id]\"> </span> </span> </div> </div> </div> <br> <div class=row ng-if=\"$ctrl.diagrams.length > 0\"> <div class=col-sm-12> <waltz-svg-diagrams diagrams=$ctrl.diagrams block-processor=$ctrl.blockProcessor> </waltz-svg-diagrams> <hr> </div> </div> <div class=row> <div class=col-sm-7> <waltz-measurable-tree measurables=$ctrl.measurables> </waltz-measurable-tree> </div> <div class=col-sm-5> <strong ng-bind=$ctrl.category.description> </strong> <waltz-static-panels render-mode=chromeless group-key=HOME.MEASURABLE.{{$ctrl.category.id}}> </waltz-static-panels> <hr> <waltz-data-extract-link name=Export uib-popover=\"Exports this taxonomy and the key people associated with it\" popover-trigger=mouseenter extract=measurable-category/{{$ctrl.category.id}} filename={{$ctrl.category.name}}.csv> </waltz-data-extract-link> </div> </div> </div> </div> '},1159:function(e,t,a){\"use strict\";Object.defineProperty(t,\"__esModule\",{value:!0});var n=s(a(1)),i=a(0),r=a(2),l=s(a(1160)),o=a(12);function s(e){return e&&e.__esModule?e:{default:e}}var c={TREE_VIEW:\"TREE_VIEW\",NODE_VIEW:\"NODE_VIEW\",CHANGE_VIEW:\"CHANGE_VIEW\"},d={category:null,measurables:[],selectedMeasurable:null,selectedChange:null,recentlySelected:[],pendingChanges:[],mode:c.TREE_VIEW};function u(e,t,a,l){var s=(0,i.initialiseData)(this,d),u=a.id;s.$onInit=function(){l.loadAppData(r.CORE_API.MeasurableStore.findAll).then(function(e){return s.measurables=n.default.filter(e.data,function(e){return e.categoryId===u})}),l.loadAppData(r.CORE_API.MeasurableCategoryStore.findAll).then(function(e){return s.category=n.default.find(e.data,{id:u})}).then(function(){return l.loadViewData(r.CORE_API.TaxonomyManagementStore.findPendingChangesByDomain,[(0,o.toEntityRef)(s.category)])}).then(function(e){return s.pendingChanges=console.log(e.data)||e.data})};var p=function(){s.selectedMeasurable=null,s.selectedChange=null};s.onSelect=function(e){p(),s.mode=c.NODE_VIEW,s.recentlySelected=n.default.unionBy(s.recentlySelected,[e],function(e){return e.id}),s.selectedMeasurable=e},s.onDismissSelection=function(){p(),s.mode=c.TREE_VIEW}}u.$inject=[\"$q\",\"$state\",\"$stateParams\",\"ServiceBroker\"],t.default={template:l.default,controller:u,controllerAs:\"$ctrl\"}},1160:function(e,t){e.exports='<div> <waltz-page-header name={{$ctrl.category.name}} small=Edit icon=puzzle-piece> <ol class=waltz-breadcrumbs> <li> <a ui-sref=main> Home </a> </li> <li> <a ui-sref=\"main.measurable-category.list ({id: $ctrl.category.id})\" ng-bind=$ctrl.category.name> </a> </li> <li>Edit</li> </ol> </waltz-page-header> <div class=\"waltz-page-summary-attach waltz-page-summary\"> <div class=row ng-show=\"$ctrl.mode === \\'TREE_VIEW\\'\"> <div class=col-sm-6> <div class=help-block> To make changes to this taxonomy first select an item you wish to modify. </div> <waltz-measurable-tree measurables=$ctrl.measurables on-select=$ctrl.onSelect> </waltz-measurable-tree> </div> <div class=col-sm-6> <waltz-sub-section name=\"Pending Changes\"> <content> <div style=padding:8px> <div class=help-block> Pending changes to this taxonomy are shown here: </div> <waltz-pending-taxonomy-changes-sub-section change-domain=$ctrl.category> </waltz-pending-taxonomy-changes-sub-section> </div> </content> </waltz-sub-section> <div ng-if=\"$ctrl.recentlySelected.length > 0\"> <hr> <h4>Recently Viewed</h4> <div class=help-block> Recently selected nodes are shown here: </div> <ul class=list-unstyled> <li ng-repeat=\"recent in $ctrl.recentlySelected\"> - <span ng-bind=recent.name class=clickable ng-click=$ctrl.onSelect(recent)> </span> </li> </ul> </div> </div> </div> <div class=row ng-show=\"$ctrl.mode === \\'NODE_VIEW\\'\"> <div class=col-sm-5> <waltz-sub-section name=Overview> <content> <div style=padding:8px> <waltz-measurable-info measurable=$ctrl.selectedMeasurable> </waltz-measurable-info> </div> <div class=waltz-sub-section-controls> <a ng-click=$ctrl.onDismissSelection() class=clickable> Close </a> </div> </content> </waltz-sub-section> </div> <div class=col-sm-7> <waltz-sub-section name=Operations> <content> <div style=padding:8px> <waltz-measurable-change-control change-domain=$ctrl.category measurable=$ctrl.selectedMeasurable> </waltz-measurable-change-control> </div> </content> </waltz-sub-section> </div> </div> </div> </div> '},1161:function(e,t,a){\"use strict\";Object.defineProperty(t,\"__esModule\",{value:!0});var n=v(a(6)),i=a(7),r=v(a(236)),l=v(a(1162)),o=v(a(1164)),s=v(a(1166)),c=v(a(1168)),d=v(a(1169)),u=v(a(1171)),p=v(a(1173)),f=v(a(1175)),m=v(a(1177)),g=v(a(1179));function v(e){return e&&e.__esModule?e:{default:e}}t.default=function(){var e=n.default.module(\"waltz.measurable.rating\",[]);return e.config(c.default),(0,i.registerStores)(e,[r.default]),e.component(\"waltzMeasurableRatingAppSection\",d.default).component(\"waltzMeasurableRatingExplorerSection\",u.default).component(\"waltzMeasurableRatingPanel\",p.default).component(\"waltzMeasurableRatingTree\",f.default).component(\"waltzMeasurableRatingsBrowser\",m.default).component(\"waltzRelatedMeasurablesSection\",g.default),(0,i.registerComponents)(e,[l.default,o.default,s.default]),e.name}},1162:function(e,t,a){\"use strict\";Object.defineProperty(t,\"__esModule\",{value:!0});var n=a(0),i=function(e){return e&&e.__esModule?e:{default:e}}(a(1163)),r=a(2);var l={visibility:{treeView:!0,gridView:!1,gridAvailable:!1}};function o(e){var t=(0,n.initialiseData)(this,l);t.$onInit=function(){e.loadAppData(r.CORE_API.DrillGridDefinitionStore.findAll).then(function(e){return t.visibility.gridAvailable=e.data.length>0}),e.loadViewData(r.CORE_API.RoadmapStore.findRoadmapsAndScenariosByFormalRelationship,[t.parentEntityRef]).then(function(e){return t.roadmapReferences=e.data})},t.showGridView=function(){t.visibility.gridView=!0,t.visibility.treeView=!1},t.showTreeView=function(){t.visibility.gridView=!1,t.visibility.treeView=!0}}o.$inject=[\"ServiceBroker\"];var s={template:i.default,bindings:{parentEntityRef:\"<\"},controller:o};t.default={component:s,id:\"waltzMeasurableRatingsBrowserSection\"}},1163:function(e,t){e.exports='<div> <waltz-section-actions> <div ng-if=$ctrl.visibility.gridAvailable> <button class=\"btn btn-xs btn-primary\" ng-if=$ctrl.visibility.treeView ng-click=$ctrl.showGridView()> <waltz-icon name=th></waltz-icon> Grid View </button> <button class=\"btn btn-xs btn-primary\" ng-if=$ctrl.visibility.gridView ng-click=$ctrl.showTreeView()> <waltz-icon name=sitemap rotate=270></waltz-icon> Tree View </button> </div> </waltz-section-actions> <div ng-if=$ctrl.visibility.treeView class=waltz-fade-if> <waltz-measurable-ratings-browser-tree-panel parent-entity-ref=$ctrl.parentEntityRef> </waltz-measurable-ratings-browser-tree-panel> <br> <waltz-roadmap-references parent-entity-ref=$ctrl.parentEntityRef> </waltz-roadmap-references> </div> <div ng-if=$ctrl.visibility.gridView class=waltz-fade-if> <waltz-drill-grid-panel parent-entity-ref=$ctrl.parentEntityRef> </waltz-drill-grid-panel> </div> </div>'},1164:function(e,t,a){\"use strict\";Object.defineProperty(t,\"__esModule\",{value:!0});var n=d(a(1)),i=a(0),r=a(27),l=a(17),o=a(2),s=d(a(1165)),c=a(73);function d(e){return e&&e.__esModule?e:{default:e}}var u={applications:[],measurables:[],measurableCategories:[],measurableRatingsDetail:null,ratingTallies:[],detail:null,visibility:{loading:!1},selectedMeasurable:null,onLoadDetail:function(){return f(\"onLoadDetail\")}};function p(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:[],i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:[],r=arguments.length>4&&void 0!==arguments[4]?arguments[4]:{},l=n.default.keyBy(a,\"id\"),o=function(e){return function e(t,a){return t.push(a.id),n.default.each(a.children,function(a){return e(t,a)}),t}([],e)}(e),s=n.default.chain(i).filter(function(e){return n.default.includes(o,e.measurableId)}).map(function(e){return{application:l[e.entityReference.id],rating:Object.assign({},t.ratingsByCode[e.rating],{plannedDate:e.plannedDate,description:e.description}),measurable:r[e.measurableId]}}).value();return n.default.sortBy(s,\"application.name\")}function f(){console.log(\"wmrbs::\",arguments)}function m(e,t){var a=(0,i.initialiseData)(this,u);a.$onInit=function(){return a.selector=(0,l.mkSelectionOptions)(a.parentEntityRef),e.all([function(e,t,a){return e.loadViewData(o.CORE_API.MeasurableRatingStore.statsByAppSelector,[t]).then(function(e){return a.ratingTallies=e.data})}(t,a.selector,a),function(e,t,a){return e.loadViewData(o.CORE_API.MeasurableStore.findMeasurablesBySelector,[t]).then(function(e){a.measurables=e.data,a.measurablesById=n.default.keyBy(e.data,\"id\")})}(t,a.selector,a),function(e,t){return e.loadAppData(o.CORE_API.MeasurableCategoryStore.findAll,[]).then(function(e){return t.measurableCategories=e.data})}(t,a),function(e,t,a){return e.loadViewData(o.CORE_API.ApplicationStore.findBySelector,[t]).then(function(e){return a.applications=e.data})}(t,a.selector,a),function(e,t){return e.loadAppData(o.CORE_API.RatingSchemeStore.findAll).then(function(e){return t.ratingSchemesById=(0,c.indexRatingSchemes)(e.data)})}(t,a)])},a.$onChanges=function(e){},a.onSelect=function(i){a.visibility.loading=!0,a.tableData=null,a.selectedMeasurable=i;var l=a.measurableRatingsDetail?e.resolve(a.measurableRatingsDetail):t.execute(o.CORE_API.MeasurableRatingStore.findByAppSelector,[a.selector]).then(function(e){return a.measurableRatingsDetail=e.data}),s=n.default.find(a.measurableCategories,{id:i.categoryId}),c=a.ratingSchemesById[s.ratingSchemeId];a.columnDefs=function(e){return[(0,r.mkLinkGridCell)(\"Name\",\"application.name\",\"application.id\",\"main.app.view\"),{field:\"application.assetCode\",name:\"Asset Code\",width:\"10%\"},{field:\"rating.name\",name:\"Rating\",cellTemplate:'<div class=\"ui-grid-cell-contents\"><waltz-rating-indicator-cell rating=\"row.entity.rating\" show-name=\"true\"></waltz-rating-indicator-cell></div>',width:\"10%\"},{field:\"measurable.name\",name:e.name},{field:\"rating.description\",name:\"Comment\"},{field:\"rating.plannedDate\",name:\"Planned Date\",cellTemplate:'<div class=\"ui-grid-cell-contents\"><waltz-from-now timestamp=\"COL_FIELD\"></waltz-from-now></div>',width:\"13%\"}]}(s),n.default.isFunction(n.default.get(l,\"then\"))?l.then(function(e){return a.tableData=p(i,c,a.applications,e,a.measurablesById)}).then(function(){return a.visibility.loading=!1}):(f(\"was expecting promise, got: \",l),a.visibility.loading=!1)},a.onGridInitialise=function(e){a.exportGrid=function(){return e.exportFn(a.selectedMeasurable.name+\" Ratings.csv\")}}}m.$inject=[\"$q\",\"ServiceBroker\"];var g={template:s.default,bindings:{parentEntityRef:\"<\"},controller:m};t.default={component:g,id:\"waltzMeasurableRatingsBrowserTreePanel\"}},1165:function(e,t){e.exports='<div> <div class=row> <div class=col-sm-6> <waltz-measurable-ratings-browser rating-tallies=$ctrl.ratingTallies measurables=$ctrl.measurables categories=$ctrl.measurableCategories scroll-height=500 on-select=$ctrl.onSelect> </waltz-measurable-ratings-browser> </div> <div class=col-sm-6> <waltz-loading-notification show=$ctrl.visibility.loading style=padding-top:54px name=Loading> </waltz-loading-notification> <div ng-if=$ctrl.tableData class=waltz-fade-if> <h4> <span ng-bind=$ctrl.selectedMeasurable.name> </span> <a class=\"small small\" ui-sref=\"main.measurable.view ({ id: $ctrl.selectedMeasurable.id })\"> ( more &raquo; ) </a> </h4> <p class=\"small text-muted\"> <waltz-markdown text=$ctrl.selectedMeasurable.description></waltz-markdown> </p> <waltz-grid-with-search column-defs=$ctrl.columnDefs entries=$ctrl.tableData searchplaceholdertext=Search exportfilename=ratings.csv on-initialise=$ctrl.onGridInitialise> </waltz-grid-with-search> <div class=pull-right style=margin-bottom:4px> <a class=\"clickable waltz-visibility-child-30\" ng-click=$ctrl.exportGrid()> <waltz-icon name=download></waltz-icon> Export ratings </a> </div> </div> </div> </div> </div> '},1166:function(e,t,a){\"use strict\";Object.defineProperty(t,\"__esModule\",{value:!0});var n=u(a(1)),i=a(2),r=a(46),l=a(0),o=a(74),s=a(397),c=a(73),d=u(a(1167));function u(e){return e&&e.__esModule?e:{default:e}}var p={selected:null,measurables:[],categories:[],plannedDateCache:{},ratings:[],ratingSchemesById:{},ratingItemsBySchemeIdByCode:{},tabs:[],saveInProgress:!1,startingCategoryId:0,unusedCategories:[],visibility:{showAllCategories:!1,tab:null}};function f(e,t,a,d,u){var f=(0,l.initialiseData)(this,p);f.$onInit=function(){g(!0)};var m=function(){f.tabs=(0,s.mkTabs)(f.categories,f.ratingSchemesById,f.measurables,f.ratings,f.visibility.showAllCategories),f.hasHiddenTabs=f.categories.length!==f.tabs.length},g=function(t){var a=u.loadAppData(i.CORE_API.RatingSchemeStore.findAll).then(function(e){f.ratingSchemesById=n.default.keyBy(e.data,\"id\"),f.ratingItemsBySchemeIdByCode=(0,c.indexRatingSchemes)(e.data||[])}),r=u.loadAppData(i.CORE_API.MeasurableCategoryStore.findAll).then(function(e){f.categories=e.data,f.categoriesById=n.default.keyBy(e.data,\"id\")}),l=u.loadAppData(i.CORE_API.MeasurableStore.findAll).then(function(e){return f.measurables=e.data}),o=u.loadViewData(i.CORE_API.MeasurableRatingStore.findForEntityReference,[f.parentEntityRef],{force:t}).then(function(e){return f.ratings=e.data});e.all([o,l,r,a]).then(function(){m(),f.onTabChange(f.startingCategoryId)})},v=function(){return f.selected.rating?f.selected.rating.description:null},b=function(){return f.selected.rating?f.selected.rating.rating:null},h=function(){return f.selected.rating?f.selected.rating.plannedDate:null},y=function(e,t,i){return function(e,t){return n.default.isEmpty(e.rating)?t.create:t.update}(f.selected,a)(f.parentEntityRef,f.selected.measurable.id,e,t,i).then(function(e){return f.ratings=e}).then(function(){return m()}).then(function(){f.saveInProgress=!1;var a={rating:e,description:t,plannedDate:i};f.selected=Object.assign({},f.selected,{rating:a})})},w=function(){f.saveInProgress=!1,f.selected={}};f.backUrl=t.href((0,o.kindToViewState)(f.parentEntityRef.kind),{id:f.parentEntityRef.id}),f.onMeasurableSelect=function(e,t){var a=n.default.find(f.categories,{id:e.categoryId});f.selected=Object.assign({},f.selected,{rating:t,measurable:e,category:a})},f.onRatingSelect=function(t){if(f.selected.measurable&&f.selected.measurable.concrete&&t!==b()){var i=function(e,t,a,i){return h()&&n.default.set(f.plannedDateCache,e+\".\"+t+\".\"+a,h()),f.getNeedsPlannedDate(e,i)?n.default.get(f.plannedDateCache,e+\".\"+t+\".\"+i,null):null}(f.selected.ratingScheme.id,f.selected.measurable.id,b(),t);return\"X\"===t?(f.selected.rating?(f.saveInProgress=!0,a.remove(f.parentEntityRef,f.selected.measurable.id).then(function(e){f.saveInProgress=!1,f.ratings=e,f.tabs=(0,s.mkTabs)(f.categories,f.ratingSchemesById,f.measurables,f.ratings),f.selected.rating=null})):e.reject()).then(function(){return d.success(\"Removed\")}):y(t,v(),i).then(function(){return d.success(\"Saved\")})}},f.onSaveComment=function(e){return y(b(),e,h()).then(function(){return d.success(\"Saved Comment\")})},f.doCancel=w,f.onTabChange=function(e){f.visibility.tab=e,w();var t=f.categoriesById[e],a=f.ratingSchemesById[t.ratingSchemeId];f.selected={category:t,ratingScheme:a},f.onKeypress=(0,c.mkRatingsKeyHandler)(a.ratings,f.onRatingSelect,f.doCancel)},f.onShowAllTabs=function(){f.visibility.showAllCategories=!0,m()},f.getNeedsPlannedDate=function(e,t){return!(!e||!t)&&f.ratingItemsBySchemeIdByCode[e].ratingsByCode[t].needsPlannedDate},f.onUpdatePlannedDate=function(e,t){var a=(0,r.timeFormat)(\"%Y-%m-%d\")(t.newVal);return y(b(),v(),a).then(function(){return d.success(\"Saved Planned Date\")})}}f.$inject=[\"$q\",\"$state\",\"MeasurableRatingStore\",\"Notification\",\"ServiceBroker\"];var m={template:d.default,bindings:{parentEntityRef:\"<\",startingCategoryId:\"<\"},controller:f};t.default={component:m,id:\"waltzMeasurableRatingEditPanel\"}},1167:function(e,t){e.exports='<div> <div class=col-sm-4> <div class=row ng-if=!$ctrl.selected.measurable> <div class=col-sm-12> <h4>Instructions</h4> <p> <b>First</b> select an item from the trees in the tabbed view which reflects a characteristic of <span ng-bind=$ctrl.parentEntityRef.name></span> and <b>then</b> choose a rating and provide an optional comment. </p> <hr> <p> <b>Rating Scheme</b> <table class=\"table table-condensed\"> <thead> <tr> <th>Rating</th> <th>Key</th> </tr> </thead> <tbody> <tr ng-repeat=\"rating in $ctrl.selected.ratingScheme.ratings | orderBy: \\'position\\'\"> <td> <span style=\"display:inline-block;width:16px;height:16px;border:1px solid #000;border-radius:2px\" ng-style=\"{ \\'background-color\\': rating.color }\"> </span> <span ng-bind=rating.name ng-style=\"{ \\'font-style\\': rating.userSelectable ? \\'normal\\' : \\'italic\\' }\" title={{rating.description}}> </span> </td> <td> <span ng-if=rating.userSelectable> <kbd ng-bind=rating.rating></kbd> </span> </td> </tr> <tr> <td>Save comment</td> <td> <kbd>Ctrl+Enter</kbd> </td> </tr> </tbody> </table> </p> </div> </div> <div class=row ng-if=$ctrl.selected.measurable> <div class=col-sm-12> <h4 ng-bind=$ctrl.selected.measurable.name></h4> <div style=max-height:160px;overflow-y:auto> <div class=\"text-muted small\"> <waltz-markdown text=$ctrl.selected.measurable.description></waltz-markdown> </div> </div> <div ng-if=\"! $ctrl.selected.measurable.concrete\"> <p> <waltz-icon name=info-circle></waltz-icon> This node is abstract and cannot be given a direct rating. </p> </div> <div ng-if=$ctrl.selected.measurable.concrete> <hr> <div ng-if=$ctrl.selected.rating> <span ng-bind=$ctrl.parentEntityRef.name> </span> already exhibits this characteristic. You may change the rating, comment or remove this characteristic. </div> <div ng-if=\"! $ctrl.selected.rating\"> This entity does not currently exhibit this characteristic. To add it, choose a rating and, optionally, provide a comment. </div> <br> <div class=row> <div class=col-sm-3> Rating: </div> <div class=col-sm-9> <waltz-rating-picker selected=$ctrl.selected.rating.rating scheme-id=$ctrl.selected.ratingScheme.id edit-disabled=$ctrl.saveInProgress on-select=$ctrl.onRatingSelect on-keypress=$ctrl.onKeypress> </waltz-rating-picker> </div> </div> <div class=row ng-if=\"$ctrl.getNeedsPlannedDate($ctrl.selected.ratingScheme.id, $ctrl.selected.rating.rating)\"> <hr> <div class=col-sm-3> Planned Date: </div> <div class=col-sm-9> <waltz-editable-field on-save=$ctrl.onUpdatePlannedDate field-type=date date-format=\"dd MMM yyyy\" initial-val=$ctrl.selected.rating.plannedDate> </waltz-editable-field> </div> </div> <div class=row ng-if=$ctrl.selected.rating> <hr> <div class=col-sm-3> Comments: </div> <div class=col-sm-9> <waltz-inline-edit-area placeholder=None on-save=$ctrl.onSaveComment value=$ctrl.selected.rating.description> </waltz-inline-edit-area> </div> </div> <div class=row> <hr> <div class=col-sm-12> <a class=clickable ng-click=$ctrl.doCancel()> &laquo; Back </a> </div> </div> </div> </div> </div> </div> <div class=col-sm-8> <div class=waltz-tabs> <input type=radio ng-change=$ctrl.onTabChange(tab.category.id) ng-repeat-start=\"tab in $ctrl.tabs track by tab.category.id\" ng-model=$ctrl.visibility.tab ng-value=tab.category.id ng-disabled=\"! tab.measurables\" name=measurable_rating_edit id=\"{{ tab.category.id + \\'_\\' + $id }}\"> <label for=\"{{ tab.category.id + \\'_\\' + $id }}\" ng-repeat-end> <span ng-bind=tab.category.name ng-class=\"{ italics: tab.ratings.length == 0 }\"> </span> <span ng-show=\"tab.ratings.length > 0\" class=\"small text-muted\"> - <span ng-bind=tab.ratings.length></span> </span> </label> <span ng-if=$ctrl.hasHiddenTabs ng-click=$ctrl.onShowAllTabs() uib-popover=\"Unused categories (those with no mappings to this entity) are hidden by default.  Click here to show them.\" popover-append-to-body=true popover-popup-delay=300 popover-trigger=mouseenter style=\"padding:5px 10px;display:block;float:left;cursor:pointer\"> <waltz-icon name=plus></waltz-icon> Show all categories </span> <div ng-repeat=\"tab in $ctrl.tabs track by tab.category.id\" ng-class=\"{ \\'wt-active\\': tab.category.id == $ctrl.visibility.tab }\" class=wt-tab> <div style=padding-top:6px> <waltz-measurable-rating-tree ratings=tab.ratings rating-scheme=tab.ratingScheme measurables=tab.measurables on-keypress=$ctrl.onKeypress scroll-height=600 on-select=$ctrl.onMeasurableSelect> </waltz-measurable-rating-tree> </div> <br> <p class=\"text-muted small\" ng-bind=tab.category.description></p> </div> </div> </div> </div>'},1168:function(e,t,a){\"use strict\";Object.defineProperty(t,\"__esModule\",{value:!0});var n={};function i(e){e.state(\"main.measurable-rating\",n)}i.$inject=[\"$stateProvider\"],t.default=i},1169:function(e,t,a){\"use strict\";Object.defineProperty(t,\"__esModule\",{value:!0});var n=s(a(1)),i=a(2),r=a(0),l=s(a(1170)),o=a(397);function s(e){return e&&e.__esModule?e:{default:e}}var c={categories:[],ratings:[],measurables:[],visibility:{editor:!1,overlay:!1,tab:null},byCategory:{}};function d(e,t){var a=(0,r.initialiseData)(this,c);a.viewMode=function(){l(!0),a.visibility.editor=!1};var l=function(){var r=arguments.length>0&&void 0!==arguments[0]&&arguments[0];t.loadViewData(i.CORE_API.RoadmapStore.findRoadmapsAndScenariosByRatedEntity,[a.parentEntityRef]).then(function(e){return a.roadmapReferences=e.data});var l=t.loadViewData(i.CORE_API.MeasurableRatingStore.findForEntityReference,[a.parentEntityRef],{force:r}).then(function(e){return a.ratings=e.data}),s=t.loadAppData(i.CORE_API.RatingSchemeStore.findAll).then(function(e){return a.ratingSchemesById=n.default.keyBy(e.data,\"id\")}),c=t.loadAppData(i.CORE_API.MeasurableCategoryStore.findAll).then(function(e){return a.categories=e.data}),d=t.loadViewData(i.CORE_API.MeasurableStore.findMeasurablesRelatedToPath,[a.parentEntityRef],{force:r}).then(function(e){return a.measurables=e.data});e.all([d,s,l,c]).then(function(){a.tabs=(0,o.mkTabs)(a.categories,a.ratingSchemesById,a.measurables,a.ratings,!1);var e=(0,o.determineStartingTab)(a.tabs);a.visibility.tab=e?e.category.id:null})};a.$onInit=function(){return l()}}d.$inject=[\"$q\",\"ServiceBroker\"];var u={template:l.default,bindings:{parentEntityRef:\"<\"},controller:d};t.default=u},1170:function(e,t){e.exports='<div> <waltz-section-actions> <a waltz-has-role=RATING_EDITOR ng-if=\"$ctrl.visibility.editor === false\" ng-click=\"$ctrl.visibility.editor = true\" class=\"btn btn-xs btn-primary\"> Edit </a> <a waltz-has-role=RATING_EDITOR ng-if=\"$ctrl.visibility.editor === true\" ng-click=$ctrl.viewMode() class=\"btn btn-xs btn-primary\"> View </a> <button class=\"btn btn-xs waltz-btn-transparent\" ng-click=\"$ctrl.visibility.overlay = ! $ctrl.visibility.overlay\"> <waltz-icon name=map-signs></waltz-icon> </button> </waltz-section-actions> <waltz-source-data-overlay visible=$ctrl.visibility.overlay entities=\"[\\'MEASURABLE_RATING\\', \\'PROCESS\\']\"> </waltz-source-data-overlay> <div ng-if=\"$ctrl.visibility.editor === false\"> <div class=row ng-if=\"$ctrl.measurables.length > 0\"> <div class=col-sm-12> <div class=waltz-tabs> <input type=radio ng-repeat-start=\"tab in $ctrl.tabs\" ng-model=$ctrl.visibility.tab ng-value=tab.category.id ng-disabled=\"tab.ratings.length === 0\" name=measurable_rating id=\"{{ tab.category.id + \\'_\\' +$id}}\"> <label for=\"{{ tab.category.id + \\'_\\' +$id}}\" uib-popover-template=\"\\'wmras-tab-popover.html\\'\" popover-trigger=mouseenter popover-append-to-body=true popover-placement=top popover-popup-delay=200 ng-repeat-end ng-bind=tab.category.name> </label> <div ng-repeat=\"tab in $ctrl.tabs\" ng-class=\"{ \\'wt-active\\': tab.category.id == $ctrl.visibility.tab }\" class=wt-tab> <br> <waltz-measurable-rating-panel category=tab.category entity-reference=$ctrl.parentEntityRef measurables=tab.measurables ratings=tab.ratings rating-scheme=tab.ratingScheme> </waltz-measurable-rating-panel> </div> </div> </div> </div> <br> <waltz-roadmap-references parent-entity-ref=$ctrl.parentEntityRef> </waltz-roadmap-references> <div class=row ng-if=\"$ctrl.measurables.length == 0\"> <div class=col-md-12> <waltz-no-data> <message> <strong>No data</strong> available for this entity </message> </waltz-no-data> </div> </div> </div> <div> <waltz-measurable-rating-edit-panel parent-entity-ref=$ctrl.parentEntityRef starting-category-id=$ctrl.visibility.tab ng-if=$ctrl.visibility.editor> </waltz-measurable-rating-edit-panel> </div> </div> <script type=text/ng-template id=wmras-tab-popover.html> <div class=\"small\">\\n        <strong ng-bind=\"tab.category.name\">\\n        </strong>\\n        <div>\\n            <hr>\\n            <waltz-markdown text=\"tab.category.description\">\\n            </waltz-markdown>\\n        </div>\\n    </div> <\\/script> '},1171:function(e,t,a){\"use strict\";Object.defineProperty(t,\"__esModule\",{value:!0});var n=d(a(1)),i=a(0),r=a(2),l=a(27),o=a(19),s=d(a(1172)),c=a(17);function d(e){return e&&e.__esModule?e:{default:e}}var u={measurables:[],query:\"\",pie:null,ratings:[],visibility:{ratingOverlay:!1}};function p(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[],a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{},r=n.default.keyBy(t,\"id\"),l=n.default.keyBy(a.ratings,function(e){return e.rating});return n.default.chain(e).map(function(e){return{rating:l[e.rating],measurable:r[e.measurableId],entityReference:Object.assign({},e.entityReference,{assetCode:i[e.entityReference.id].assetCode})}}).value()}var f='\\n    <div class=\"ui-grid-cell-contents\">\\n        <waltz-rating-indicator-cell rating=\"row.entity.rating\" \\n                                     show-name=\"true\">\\n        </waltz-rating-indicator-cell>\\n    </div>';function m(e,t){var a=(0,i.initialiseData)(this,u),s=function(e){if(0!==n.default.get(e,\"count\",0)){a.pie.selectedSegmentKey=e?e.key:null;var t=e?n.default.filter(a.ratings,function(t){return t.rating===e.key}):a.ratings;a.tableData=p(t,a.measurables,a.ratingScheme,a.appsById)}},d=function(){var i=(0,c.mkSelectionOptions)(a.parentEntityRef),l=t.loadViewData(r.CORE_API.ApplicationStore.findBySelector,[i]).then(function(e){return a.appsById=n.default.keyBy(e.data,\"id\")}),o=t.loadAppData(r.CORE_API.RatingSchemeStore.findAll).then(function(e){return a.ratingSchemes=e.data}),s=t.loadViewData(r.CORE_API.MeasurableRatingStore.findByMeasurableSelector,[i]).then(function(e){return a.ratings=e.data}),d=t.loadAppData(r.CORE_API.MeasurableStore.findAll).then(function(e){return a.measurables=e.data}),u=t.loadAppData(r.CORE_API.MeasurableCategoryStore.findAll).then(function(e){return a.measurableCategories=e.data});return e.all([l,s,d,u,o])},m=function(){var e=n.default.find(a.measurables,{id:a.parentEntityRef.id}),t=n.default.find(a.measurableCategories,{id:e.categoryId});a.ratingScheme=n.default.find(a.ratingSchemes,{id:t.ratingSchemeId}),a.columnDefs=function(e,t){var a=[(0,l.mkLinkGridCell)(\"Name\",\"entityReference.name\",\"entityReference.id\",\"main.app.view\"),{field:\"entityReference.assetCode\",name:\"Asset Code\"},{field:\"rating\",name:\"Rating\",cellTemplate:f,sortingAlgorithm:function(e,t){return e.name.localeCompare(t.name)},exportFormatter:function(e){return e.name}}],n=t.length>1?[{field:\"measurable.name\",name:e.name}]:[];return[].concat(a,n,[{field:\"rating.description\",name:\"Comment\"}])}(t,a.measurables),a.pie=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},a=arguments[2],i=n.default.countBy(e,\"rating\"),r=n.default.keyBy(t.ratings,\"rating\"),l=(0,o.mkRatingSchemeColorScale)(t);return{selectedSegmentKey:null,data:n.default.chain(t.ratings).reject(function(e){return\"X\"===e.rating}).map(function(e){return{key:e.rating,count:i[e.rating]||0}}).value(),config:{size:130,onSelect:a,colorProvider:function(e){return l(e.data.key)},labelProvider:function(e){return n.default.get(r,[e.key,\"name\"],e.key)},descriptionProvider:function(e){return n.default.get(r,[e.key,\"description\"],e.key)}}}}(a.ratings,a.ratingScheme,s),a.tableData=p(a.ratings,a.measurables,a.ratingScheme,a.appsById)};a.$onInit=function(){return d().then(function(){return m()})},a.$onChanges=function(e){return d().then(function(){return m()})},a.onGridInitialise=function(e){return a.exportData=function(){return e.exportFn(\"measurable-ratings.csv\")}}}m.$inject=[\"$q\",\"ServiceBroker\"];var g={template:s.default,bindings:{parentEntityRef:\"<\"},controller:m};t.default=g},1172:function(e,t){e.exports='<div> <waltz-section-actions> <button class=\"btn btn-xs btn-primary\" ng-disabled=\"$ctrl.tableData.length == 0 \" ng-click=$ctrl.exportData()> <waltz-icon name=cloud-download></waltz-icon> Export </button> <button class=\"btn btn-xs waltz-btn-transparent\" ng-click=\"$ctrl.visibility.ratingOverlay = ! $ctrl.visibility.ratingOverlay\"> <waltz-icon name=map-signs></waltz-icon> </button> </waltz-section-actions> <waltz-source-data-overlay visible=$ctrl.visibility.ratingOverlay entities=\"[\\'APP_RATING\\']\"> </waltz-source-data-overlay> <div class=row ng-if=\"$ctrl.tableData.length === 0\"> <div class=col-sm-12> <waltz-no-data> <message> <strong>No applications have been rated against this viewpoint.</strong> </message> </waltz-no-data> </div> </div> <div class=row ng-if=\"$ctrl.tableData.length > 0\"> <div class=col-sm-3> <div style=text-align:center> <waltz-pie data=$ctrl.pie.data config=$ctrl.pie.config> </waltz-pie> </div> <waltz-pie-segment-table data=$ctrl.pie.data selected-segment-key=$ctrl.pie.selectedSegmentKey config=$ctrl.pie.config> </waltz-pie-segment-table> </div> <div class=col-sm-9> <div ng-if=\"$ctrl.tableData.length > 0\"> <waltz-grid-with-search column-defs=$ctrl.columnDefs entries=$ctrl.tableData search-placeholder-text=Search export-filename=ratings.csv on-initialise=$ctrl.onGridInitialise> </waltz-grid-with-search> </div> </div> </div> </div>'},1173:function(e,t,a){\"use strict\";Object.defineProperty(t,\"__esModule\",{value:!0});var n=l(a(1)),i=a(0),r=l(a(1174));function l(e){return e&&e.__esModule?e:{default:e}}var o={measurables:[],ratings:[],selected:null};function s(){var e=this;e.$onInit=function(){return(0,i.initialiseData)(e,o)},e.$onChanges=function(){e.ratingsByCode=n.default.keyBy(n.default.get(e.ratingScheme,\"ratings\",[]),\"rating\")},e.onSelect=function(t,a){return e.selected={measurable:t,rating:a}}}s.$inject=[];var c={template:r.default,bindings:{category:\"<\",entityReference:\"<\",ratings:\"<\",ratingScheme:\"<\",measurables:\"<\"},controller:s};t.default=c},1174:function(e,t){e.exports='<div class=row> <div class=col-sm-6> <waltz-measurable-rating-tree ratings=$ctrl.ratings rating-scheme=$ctrl.ratingScheme on-select=$ctrl.onSelect measurables=$ctrl.measurables> </waltz-measurable-rating-tree> </div> <div class=col-sm-6 style=\"border-left:1px solid #eee\"> <div ng-if=\"$ctrl.selected == null\" class=\"waltz-fade-if text-muted\"> Please select an item on the tree to see more detail. </div> <div ng-if=\"$ctrl.selected != null\" class=waltz-fade-if> <div> <h4> <a class=clickable style=font-weight:lighter ui-sref=\"main.measurable.view ({ id: $ctrl.selected.measurable.id })\"> <span ng-bind=$ctrl.selected.measurable.name></span> </a> </h4> <div ng-if=$ctrl.selected.measurable.description> <waltz-markdown class=small text=$ctrl.selected.measurable.description> </waltz-markdown> <br> </div> <br> <div> <div class=row> <div class=\"col-sm-3 waltz-display-field-label\"> Rating </div> <div class=col-sm-9> <waltz-rating-indicator-cell rating=$ctrl.ratingsByCode[$ctrl.selected.rating.rating] show-name=true> </waltz-rating-indicator-cell> </div> </div> <div class=row ng-if=$ctrl.selected.rating.plannedDate> <div class=\"col-sm-3 waltz-display-field-label\"> Planned Date </div> <div class=col-sm-9> <span class=small ng-bind=\"$ctrl.selected.rating.plannedDate || \\'No planned date\\'\"> </span> </div> </div> <div class=row> <div class=\"col-sm-3 waltz-display-field-label\"> Description </div> <div class=col-sm-9> <span class=small ng-bind=\"$ctrl.selected.rating.description || \\'No comment given\\'\"> </span> </div> </div> </div> <div class=\"pull-right small\"> <waltz-last-updated entity=$ctrl.selected.rating> </waltz-last-updated> </div> </div> </div> </div> </div> '},1175:function(e,t,a){\"use strict\";Object.defineProperty(t,\"__esModule\",{value:!0});var n=s(a(1)),i=a(0),r=a(24),l=s(a(1176)),o=a(39);function s(e){return e&&e.__esModule?e:{default:e}}var c={containerClass:\"\",hierarchy:[],measurables:[],ratings:[],ratingScheme:null,searchTerms:\"\",treeOptions:{nodeChildren:\"children\",dirSelectable:!0,equality:function(e,t){return!(!e||!t)&&e.id===t.id}},onKeypress:null,onSelect:function(e,t){return console.log(\"default on-select for measurable-rating-tree: \",e,t)}};function d(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];return(0,r.buildHierarchies)(e,!1)}function u(){var e=this;e.$onInit=function(){return(0,i.initialiseData)(e,c)},e.$onChanges=function(t){var a=n.default.map(e.measurables,function(e){return Object.assign({},e,{displayName:function(e){return(0,o.truncateMiddle)(e.name,96)}(e)})});e.searchNodes=(0,r.prepareSearchNodes)(a),e.hierarchy=d(a),e.ratingsByMeasurable=n.default.keyBy(e.ratings||[],\"measurableId\"),e.ratingsByCode=n.default.keyBy(n.default.get(e.ratingScheme,\"ratings\",[]),\"rating\"),n.default.isEmpty(e.expandedNodes)&&(e.expandedNodes=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},a=n.default.keyBy(e,\"id\"),i=n.default.filter(e,function(e){return null!=t[e.id]}),r=[];return n.default.each(i,function(e){for(r.push(e.id);e&&e.parentId;){r.push(e.parentId);var t=a[e.parentId];t||console.warn(\"WMRE: could not find parent (\"+e.parentId+\") of measurable (\"+e.id+\")\"),e=t}}),n.default.map(n.default.uniq(r),function(e){return a[e]})}(a,e.ratingsByMeasurable)),t.scrollHeight&&(e.containerClass=\"waltz-scroll-region-\"+e.scrollHeight)},e.searchTermsChanged=function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:\"\";e.hierarchy=d((0,r.doSearch)(t,e.searchNodes))},e.clearSearch=function(){e.searchTermsChanged(\"\"),e.searchTerms=\"\"}}u.$inject=[];var p={template:l.default,bindings:{ratings:\"<\",ratingScheme:\"<\",measurables:\"<\",onKeypress:\"<\",onSelect:\"<\",scrollHeight:\"@\"},controller:u};t.default=p},1176:function(e,t){e.exports='<div class=wmt-search-region> <waltz-icon name=search ng-class=\"{\\n                    \\'wmt-search-active\\' : $ctrl.searchTerms.length > 0,\\n                    \\'wmt-search-inactive\\' : $ctrl.searchTerms.length == 0\\n                }\"> </waltz-icon> <input type=search class=form-control name=searchTerms ng-model=$ctrl.searchTerms ng-change=$ctrl.searchTermsChanged($ctrl.searchTerms) ng-model-options=\"{ debounce: 200 }\" placeholder=Search> &nbsp; <waltz-icon name=close style=color:#8b0000 ng-if=\"$ctrl.searchTerms.length > 0\" class=clickable ng-click=$ctrl.clearSearch()> </waltz-icon> </div> <div ng-class=$ctrl.containerClass ng-attr-tabindex=\"{{$ctrl.onKeypress ? 1 : undefined}}\" ng-keydown=$ctrl.onKeypress($event)> <treecontrol class=tree-light tree-model=$ctrl.hierarchy expanded-nodes=$ctrl.expandedNodes options=$ctrl.treeOptions on-selection=\"$ctrl.onSelect(node, $ctrl.ratingsByMeasurable[node.id])\" order-by=\"\\'-name\\'\"> <span class=waltz-visibility-parent> <span ng-style=\"{ opacity: node.concrete ? 1 : 0.5 }\"> <waltz-rating-indicator-cell rating=$ctrl.ratingsByCode[$ctrl.ratingsByMeasurable[node.id].rating]> </waltz-rating-indicator-cell> </span> <span uib-popover-template=\"\\'wmrt-popover.html\\'\" popover-trigger=mouseenter popover-append-to-body=true popover-placement=right ng-class=\"{ \\'text-muted\\': $ctrl.ratingsByMeasurable[node.id].rating == null }\" class=no-overflow> <span ng-bind=node.displayName ng-class=\"{ \\'italics\\' : ! node.concrete }\"> </span> <span class=small ng-if=\"$ctrl.ratingsByMeasurable[node.id].description.length > 0\"> <waltz-icon name=sticky-note-o></waltz-icon> </span> </span> </span> </treecontrol> </div> <script type=text/ng-template id=wmrt-popover.html> <div class=\"small\">\\n        <strong ng-bind=\"node.name\"></strong>\\n        <hr>\\n        <waltz-markdown text=\"node.description\"></waltz-markdown>\\n        <div ng-if=\"$ctrl.ratingsByMeasurable[node.id].description.length > 0\">\\n            <hr>\\n            <div ng-bind=\"$ctrl.ratingsByMeasurable[node.id].description\"></div>\\n        </div>\\n    </div> <\\/script>'},1177:function(e,t,a){\"use strict\";Object.defineProperty(t,\"__esModule\",{value:!0});var n=c(a(1)),i=a(0),r=a(24),l=a(2),o=a(73),s=c(a(1178));function c(e){return e&&e.__esModule?e:{default:e}}var d={containerClass:[],measurables:[],ratingTallies:[],treeOptions:{nodeChildren:\"children\",dirSelectable:!0,equality:function(e,t){return!(!e||!t)&&e.id===t.id}},onSelect:function(e){return console.log(\"wmrb: default on-select\",e)},visibility:{tab:null}};function u(e,t){return n.default.mergeWith({},e,t,function(e,t){return(e||0)+(t||0)})}function p(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[],a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},i=n.default.groupBy(t,\"categoryId\");return n.default.chain(e).filter(function(e){return n.default.get(i,e.id,[]).length>0}).map(function(e){var t=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];return(0,r.buildHierarchies)(e,!1)}(i[e.id]),l=n.default.chain(t).map(\"totalRatings.total\").max().value();return{category:e,ratingScheme:a[e.ratingSchemeId],treeData:t,maxSize:l,expandedNodes:[]}}).sortBy(\"category.name\").value()}function f(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[],a=n.default.groupBy(e,\"id\");return n.default.reduce(t,function(e,t){var i=a[t.id],r=i?function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],t=n.default.countBy(e,\"rating\"),a=n.default.sum(n.default.values(t));return Object.assign({},t,{total:a})}(i):{};return e[t.id]={direct:n.default.clone(r),compound:n.default.clone(r)},e},{})}function m(e){var t=(0,i.initialiseData)(this,d),a=function(){n.default.isEmpty(t.measurables)||n.default.isEmpty(t.ratingTallies)||n.default.isEmpty(t.categories)||n.default.isEmpty(t.ratingSchemesById)||(t.tabs=p(t.categories,t.measurables,t.ratingSchemesById),t.ratingsMap=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[],a=n.default.keyBy(t,\"id\"),i=f(e,t);return n.default.each(t,function(e){for(var t=i[e.id];e.parentId;){var n=a[e.parentId];if(!n)break;var r=i[e.parentId];r.compound=u(r.compound,t.direct),e=n}}),i}(t.ratingTallies,t.measurables),t.visibility.tab=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],t=n.default.find(e,function(e){return e.treeData.length>0});return n.default.get(t||e[0],\"category.id\")}(t.tabs),t.maxTotal=n.default.max(n.default.flatMap(n.default.values(t.ratingsMap),function(e){return n.default.get(e,\"compound.total\",[0])})))};t.$onInit=function(){return e.loadAppData(l.CORE_API.RatingSchemeStore.findAll).then(function(e){t.ratingSchemesById=(0,o.indexRatingSchemes)(e.data),t.distinctRatingCodes=(0,o.distinctRatingCodes)(e.data)}).then(function(){return a()})},t.$onChanges=function(e){e.scrollHeight&&(t.containerClass=[\"waltz-scroll-region-\"+t.scrollHeight]),a()}}m.$inject=[\"ServiceBroker\"];var g={template:s.default,bindings:{measurables:\"<\",categories:\"<\",ratingTallies:\"<\",onSelect:\"<\",scrollHeight:\"<\"},controller:m};t.default=g},1178:function(e,t){e.exports='<div> <div class=waltz-tabs> <input type=radio ng-repeat-start=\"tab in $ctrl.tabs\" ng-model=$ctrl.visibility.tab ng-value=tab.category.id ng-disabled=\"tab.treeData.length === 0\" name=measurable_ratings_browser id=\"{{ tab.category.id + \\'_\\' + $id}}\"> <label for=\"{{ tab.category.id + \\'_\\' + $id}}\" ng-repeat-end> <div ng-bind=tab.category.name></div> </label> <div ng-repeat=\"tab in $ctrl.tabs track by tab.category.id\" ng-class=\"{ \\'wt-active\\': tab.category.id == $ctrl.visibility.tab }\" class=wt-tab> <br> <div ng-class=$ctrl.containerClass> <treecontrol class=tree-light tree-model=tab.treeData expanded-nodes=tab.expandedNodes options=$ctrl.treeOptions on-selection=$ctrl.onSelect(node) order-by=\"\\'-name\\'\"> <span style=display:inline-block;width:90%;padding:0;margin:0 ng-class=\"{ \\'text-muted\\': $ctrl.ratingsMap[node.id].compund.total == 0 }\" class=\"no-overflow waltz-visibility-parent\"> <span ng-bind=node.name uib-popover-template=\"\\'wmrb/measurable-popover.html\\'\" popover-trigger=mouseenter popover-append-to-body=true popover-placement=right popover-popup-delay=300 popover-enable=\"node.description.length > 0 || $ctrl.ratingsMap[node.id].compound.total > 0\" class=waltz-visibility-child-90 ng-class=\"{ \\'italics\\' : ! node.concrete }\"> </span> <waltz-rag-line class=waltz-visibility-child-50 scores=$ctrl.ratingsMap[node.id].compound rating-scheme-items=$ctrl.ratingSchemesById[tab.category.ratingSchemeId].ratings style=padding:0 range=\"[0, $ctrl.maxTotal]\"> </waltz-rag-line> </span> </treecontrol> </div> </div> </div> </div> <script type=text/ng-template id=wmrb/measurable-popover.html> <label ng-bind=\"node.name\"></label>\\n    <br>\\n    <waltz-markdown class=\"small\"\\n                    text=\"node.description\"></waltz-markdown>\\n    <hr>\\n    <div class=\"small\">\\n        <table class=\"table table-condensed small\">\\n            <thead>\\n            <tr>\\n                <th>Rating</th>\\n                <th>Count</th>\\n            </tr>\\n            </thead>\\n            <tbody>\\n            <tr ng-repeat=\"(key, val) in $ctrl.ratingsMap[node.id].compound\">\\n                <td ng-if-start=\"key != \\'total\\'\">\\n                    <div style=\"display: inline-block; height: 10px; width: 10px;\"\\n                         ng-style=\"{ \\'background-color\\': $ctrl.ratingSchemesById[tab.category.ratingSchemeId].ratingsByCode[key].color }\">\\n                    </div>\\n                    <span ng-bind=\"$ctrl.ratingSchemesById[tab.category.ratingSchemeId].ratingsByCode[key].name\"></span>\\n                </td>\\n                <td ng-if-end>\\n                    <span ng-bind=\"val\"></span>\\n                </td>\\n            </tr>\\n            </tbody>\\n            <tbody>\\n            <tr>\\n                <td>\\n                    <b>Total</b>\\n                </td>\\n                <td>\\n                    <span ng-bind=\"$ctrl.ratingsMap[node.id].compound.total\"></span>\\n                </td>\\n            </tr>\\n            </tbody>\\n        </table>\\n    </div> <\\/script>'},1179:function(e,t,a){\"use strict\";Object.defineProperty(t,\"__esModule\",{value:!0});var n=s(a(1)),i=a(0),r=a(2),l=s(a(1180)),o=a(17);function s(e){return e&&e.__esModule?e:{default:e}}var c={};function d(e,t){var a=(0,i.initialiseData)(this,c);a.$onChanges=function(){if(a.parentEntityRef){var i=(0,o.mkSelectionOptions)(a.parentEntityRef),l=[t.loadAppData(r.CORE_API.MeasurableCategoryStore.findAll).then(function(e){return a.categories=e.data}),t.loadAppData(r.CORE_API.MeasurableStore.findAll).then(function(e){return a.measurables=e.data}),t.loadViewData(r.CORE_API.MeasurableRatingStore.statsForRelatedMeasurables,[i]).then(function(e){return a.stats=e.data})];e.all(l).then(function(){return a.relatedMeasurables=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[],a=n.default.map(e,\"id\"),i=n.default.keyBy(t,\"id\");return n.default.chain(t).filter(function(e){return n.default.includes(a,e.id)}).reduce(function(e,t){for(var a=t;a;)e[a.id]=a,a=i[a.parentId];return e},{}).values().value()}(a.stats,a.measurables)})}},a.onSelect=function(e){return a.selectedMeasurable=e}}d.$inject=[\"$q\",\"ServiceBroker\"];var u={template:l.default,bindings:{parentEntityRef:\"<\"},controller:d};t.default=u},1180:function(e,t){e.exports='<div> <h4>Explicit Relationships</h4> <waltz-related-measurables-panel parent-entity-ref=$ctrl.parentEntityRef> </waltz-related-measurables-panel> <h4>Implicit Relationships</h4> <p class=text-muted> Implicit relationships are derived by looking at other viewpoints associated to applications aligned to this viewpoint. </p> <div class=row ng-if=\"$ctrl.relatedMeasurables.length < 2\"> <div class=col-sm-12> <waltz-no-data> <message> <strong>No related viewpoints found.</strong> </message> </waltz-no-data> </div> </div> <div class=row ng-if=\"$ctrl.relatedMeasurables.length > 1\"> <div class=col-sm-7> <waltz-measurable-ratings-browser rating-tallies=$ctrl.stats measurables=$ctrl.relatedMeasurables categories=$ctrl.categories on-select=$ctrl.onSelect scroll-height=400> </waltz-measurable-ratings-browser> </div> <div class=col-sm-5> <div ng-if=$ctrl.selectedMeasurable class=waltz-fade-if style=padding-top:4em> <h4> <span ng-bind=$ctrl.selectedMeasurable.name> </span> <small ng-bind=\"$ctrl.selectedMeasurable.categoryId | toDisplayName:\\'measurableCategory\\'\"> </small> </h4> <p ng-bind=$ctrl.selectedMeasurable.description></p> <a ui-sref=\"main.measurable.view ({ id: $ctrl.selectedMeasurable.id })\"> More &raquo; </a> </div> </div> </div> <div class=row ng-if=\"$ctrl.relatedMeasurables.length > 1\"> <div class=col-sm-12> <br> <p class=\"text-muted small\"> The tree above shows correlations between this item and others. The small barchart below each tree node shows how many applications exhibit the viewpoint in addition to this viewpoint. The colors of the barchart indicated the relative rating counts. </p> </div> </div> </div> '},1181:function(e,t,a){\"use strict\";Object.defineProperty(t,\"__esModule\",{value:!0});var n=f(a(6)),i=function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var a in e)Object.prototype.hasOwnProperty.call(e,a)&&(t[a]=e[a]);return t.default=e,t}(a(237)),r=a(7),l=f(a(1182)),o=f(a(1185)),s=f(a(1187)),c=f(a(1189)),d=f(a(1191)),u=f(a(1193)),p=f(a(1195));function f(e){return e&&e.__esModule?e:{default:e}}t.default=function(){var e=n.default.module(\"waltz.measurable.relationship\",[]);return(0,r.registerStore)(e,i),e.component(\"waltzRelatedMeasurablesPanel\",u.default).component(\"waltzRelatedMeasurablesViz\",p.default),(0,r.registerComponents)(e,[l.default,o.default,s.default,c.default,d.default]),e.name}},1182:function(e,t,a){\"use strict\";Object.defineProperty(t,\"__esModule\",{value:!0});var n=d(a(1)),i=a(0),r=a(2),l=a(1183),o=a(24),s=a(12),c=d(a(1184));function d(e){return e&&e.__esModule?e:{default:e}}var u={form:{relationshipKind:\"RELATES_TO\",description:null,counterpart:null},counterpartType:\"\",measurables:[],categories:[],availableRelationshipKinds:l.availableRelationshipKinds,relationshipKindsKey:\"\",onCancel:function(){return console.log(\"wcrme: onCancel - default impl\")},onRefresh:function(){return console.log(\"wcrme: onRefresh - default impl\")},treeOptions:{isSelectable:function(e){return e.concrete}},visibility:{appGroupSelector:!1,changeInitiativeSelector:!1,measurableSelector:!1}};function p(e,t){var a=(0,i.initialiseData)(this,u),l=function(e){t.loadAppData(r.CORE_API.MeasurableStore.findAll).then(function(t){a.measurables=n.default.filter(t.data,{categoryId:e}),a.nodes=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];return(0,o.buildHierarchies)(e,!1)}(a.measurables)}),t.loadViewData(r.CORE_API.MeasurableRelationshipStore.findByEntityReference,[a.parentEntityRef],{force:!0}).then(function(e){var t=n.default.chain(e.data).flatMap(function(e){var t=[];return\"MEASURABLE\"===e.a.kind&&t.push(e.a.id),\"MEASURABLE\"===e.b.kind&&t.push(e.b.id),t}).uniq().value();a.treeOptions.isSelectable=function(e){return e.concrete&&!n.default.includes(t,e.id)}})};a.$onInit=function(){t.loadViewData(r.CORE_API.MeasurableRelationshipStore.findByEntityReference,[a.parentEntityRef],{force:!0}).then(function(e){a.relationships=e.data,a.relatedEntityMap=n.default.chain(e.data).flatMap(function(e){return[e.a,e.b]}).keyBy(function(e){return(0,s.refToString)(e)}).value()});var e=n.default.startsWith(a.type.id,\"MEASURABLE\");if(e){a.visibility.measurableSelector=!0;var i=function(e){return+n.default.split(e,\"/\")[1]}(a.type.id);t.loadAppData(r.CORE_API.MeasurableCategoryStore.findAll).then(function(e){return a.categories=e.data,a.categories}).then(function(e){i&&(a.category=n.default.find(e,{id:i}),a.counterpartType=a.category.name)}),i&&l(i)}else switch(a.type.id){case\"CHANGE_INITIATIVE\":a.visibility.changeInitiativeSelector=!0,a.counterpartType=\"Change Initiative\";break;case\"APP_GROUP\":a.visibility.appGroupSelector=!0,a.counterpartType=\"Application Group\"}a.relationshipKindsKey=a.parentEntityRef.kind+\"-\"+(e?\"MEASURABLE\":a.type.id)},a.selectionFilterFn=function(e){var t=(0,s.refToString)(e);return null==a.relatedEntityMap[t]},a.onAppGroupSelection=function(e){a.form.counterpart=e},a.onChangeInitiativeSelection=function(e){a.form.counterpart=e},a.onMeasurableSelection=function(e){a.form.counterpart=(0,s.toEntityRef)(e,\"MEASURABLE\")},a.onMeasurableCategorySelection=function(e){l(e.id)},a.isFormValid=function(){var e=null!==a.form.counterpart,t=null!==a.form.relationshipKind;return e&&t},a.submit=function(){if(a.isFormValid()){var t=a.form,n={a:a.parentEntityRef,b:t.counterpart,relationshipKind:t.relationshipKind,description:t.description};c(n).then(function(){e.success(\"Relationship saved\"),a.onRefresh()}).catch(function(t){e.error(\"Could not save because: \"+t.message)})}};var c=function(e){return t.execute(r.CORE_API.MeasurableRelationshipStore.create,[e])}}p.$inject=[\"Notification\",\"ServiceBroker\"];var f={bindings:{parentEntityRef:\"<\",type:\"<\",onCancel:\"<\",onRefresh:\"<\"},template:c.default,controller:p};t.default={id:\"waltzCreateRelatedMeasurableEditor\",component:f}},1183:function(e,t,a){\"use strict\";Object.defineProperty(t,\"__esModule\",{value:!0});var n={code:\"RELATES_TO\",label:\"Relates To\"};t.availableRelationshipKinds={\"APP_GROUP-APP_GROUP\":[n],\"APP_GROUP-MEASURABLE\":[n],\"APP_GROUP-CHANGE_INITIATIVE\":[n],\"MEASURABLE-APP_GROUP\":[n],\"MEASURABLE-CHANGE_INITIATIVE\":[n,{code:\"DEPRECATES\",label:\"Is Deprecated By\"}],\"MEASURABLE-MEASURABLE\":[n],\"CHANGE_INITIATIVE-APP_GROUP\":[n],\"CHANGE_INITIATIVE-MEASURABLE\":[n,{code:\"DEPRECATES\",label:\"Deprecates\"}],\"CHANGE_INITIATIVE-CHANGE_INITIATIVE\":[n]}},1184:function(e,t){e.exports='<h4> Create New Relationship to <span ng-bind=$ctrl.counterpartType></span> </h4> <div> <div class=small> <form> <div class=form-group> <label>Relationship Kind</label> <select ng-model=$ctrl.form.relationshipKind ng-options=\"relationshipKind.code as relationshipKind.label for relationshipKind in $ctrl.availableRelationshipKinds[$ctrl.relationshipKindsKey]\" class=form-control> </select> <div class=help-block> The relationship kind describes the nature of the relationship between the entities. </div> </div> <div class=form-group ng-if=$ctrl.visibility.changeInitiativeSelector> <label class=control-label>Related Change Initiative</label> <waltz-entity-selector entity-kinds=\"[\\'CHANGE_INITIATIVE\\']\" on-select=$ctrl.onChangeInitiativeSelection required=true selection-filter=$ctrl.selectionFilterFn> </waltz-entity-selector> <div class=help-block> Search for the change initiative you wish to associate. You may search by name or code. </div> </div> <div class=form-group ng-if=$ctrl.visibility.appGroupSelector> <label class=control-label>Related Application Group</label> <waltz-entity-selector entity-kinds=\"[\\'APP_GROUP\\']\" on-select=$ctrl.onAppGroupSelection required=true selection-filter=$ctrl.selectionFilterFn> </waltz-entity-selector> <div class=help-block> Search for the application group you wish to associate. </div> </div> <div class=form-group ng-if=\"$ctrl.measurables.length === 0 && $ctrl.visibility.measurableSelector\"> <label>Viewpoint Category</label> <select ng-model=$ctrl.form.targetCategory ng-change=$ctrl.onMeasurableCategorySelection($ctrl.form.targetCategory) ng-options=\"category as category.name for category in $ctrl.categories | orderBy:\\'category.description\\'\" class=form-control> </select> <div class=help-block> Specify the category for the target viewpoint </div> </div> <div class=form-group ng-if=$ctrl.visibility.measurableSelector> <label class=control-label> Related <span ng-bind=$ctrl.counterpartType></span> </label> <treecontrol class=tree-light tree-model=$ctrl.nodes options=$ctrl.treeOptions on-selection=$ctrl.onMeasurableSelection(node) order-by=\"\\'-name\\'\"> <span>{{ node.name }}</span> </treecontrol> <div class=help-block> Select the <span ng-bind=$ctrl.counterpartType></span> entity you wish to associate. </div> </div> <div class=form-group> <label class=control-label>Description</label> <textarea class=form-control ng-model=$ctrl.form.description placeholder=\"Please provide any additional details here\" rows=6>\\n                </textarea> </div> <hr> <button class=\"btn btn-xs btn-success\" ng-click=$ctrl.submit() ng-disabled=\"! $ctrl.isFormValid()\"> Save </button> <a class=clickable ng-click=$ctrl.onCancel()> Cancel </a> </form> </div> </div> '},1185:function(e,t,a){\"use strict\";Object.defineProperty(t,\"__esModule\",{value:!0});var n=a(0),i=a(2),r=function(e){return e&&e.__esModule?e:{default:e}}(a(1186));var l={form:{description:null},onCancel:function(){return console.log(\"wurme: onCancel - default impl\")},onRefresh:function(){return console.log(\"wurme: onRefresh - default impl\")}};function o(e,t){var a=(0,n.initialiseData)(this,l);a.$onInit=function(){a.form.description=a.relationship.description,a.form.relationshipKind=a.relationship.relationship},a.$onChange=function(e){},a.isFormValid=function(){return!0},a.submit=function(){if(a.isFormValid()){var t=a.form,n={a:a.relationship.a,b:a.relationship.b,relationshipKind:a.relationship.relationship},i={relationshipKind:a.relationship.relationship,description:t.description};return r(n,i).then(function(){e.success(\"Relationship saved\"),a.onRefresh()}).catch(function(t){e.error(\"Could not save because: \"+t.message)})}};var r=function(e,a){return t.execute(i.CORE_API.MeasurableRelationshipStore.update,[e,a])}}o.$inject=[\"Notification\",\"ServiceBroker\"];var s={bindings:{relationship:\"<\",onCancel:\"<\",onRefresh:\"<\"},template:r.default,controller:o};t.default={id:\"waltzUpdateRelatedMeasurableEditor\",component:s}},1186:function(e,t){e.exports='<h4>Update Relationship</h4> <div> <div class=small> <form> <div class=form-group> <label class=control-label> Description </label> <textarea class=form-control ng-model=$ctrl.form.description placeholder=\"Please provide any additional details here\" rows=6>\\n                </textarea> </div> <hr> <button class=\"btn btn-xs btn-success\" ng-click=$ctrl.submit() ng-disabled=!$ctrl.isFormValid()> Save </button> <a class=clickable ng-click=$ctrl.onCancel()> Cancel </a> </form> </div> </div> '},1187:function(e,t,a){\"use strict\";Object.defineProperty(t,\"__esModule\",{value:!0});var n=function(e){return e&&e.__esModule?e:{default:e}}(a(1188)),i=a(0);var r={item:null,onDismiss:function(){return console.log(\"default on dismiss\")},onEdit:function(){return console.log(\"default on edit\")},onRemove:function(){return console.log(\"default on remove\")}};var l={template:n.default,controller:function(){(0,i.initialiseData)(this,r)},bindings:{item:\"<\",onDismiss:\"<\",onEdit:\"<\",onRemove:\"<\"}};t.default={component:l,id:\"waltzRelatedMeasurableItemView\"}},1188:function(e,t){e.exports='<h4 ng-if=!$ctrl.item.outbound> <span class=wrmp-relationship-heading> <span class=\"wrmp-pill wrmp-counterpart\"> <waltz-entity-link entity-ref=$ctrl.item.a></waltz-entity-link> </span> <span class=\"wrmp-pill wrmp-rel\"> <span ng-bind=\"$ctrl.item.relationship.relationship | toDisplayName:\\'relationshipKind\\'\"></span> </span> <span class=\"wrmp-pill wrmp-self\"> This </span> </span> <a class=\"clickable pull-right\" ng-click=$ctrl.onDismiss()> (x) </a> </h4> <h4 ng-if=$ctrl.item.outbound> <span class=wrmp-relationship-heading> <span class=\"wrmp-pill wrmp-self\"> This </span> <span class=\"wrmp-pill wrmp-rel\"> <span ng-bind=\"$ctrl.item.relationship.relationship | toDisplayName:\\'relationshipKind\\'\"> </span> </span> <span class=\"wrmp-pill wrmp-counterpart\"> <waltz-entity-link entity-ref=$ctrl.item.b></waltz-entity-link> </span> </span> <a class=\"clickable pull-right\" ng-click=$ctrl.onDismiss()> (x) </a> </h4> <br> <label>Description:</label> <div ng-if=$ctrl.item.relationship.description> <waltz-markdown text=$ctrl.item.relationship.description></waltz-markdown> </div> <div ng-if=!$ctrl.item.relationship.description class=text-muted> <strong>No description provided</strong> </div> <hr> <div waltz-has-role=CAPABILITY_EDITOR> <button class=\"btn btn-xs btn-primary\" ng-click=$ctrl.onEdit()> Edit </button> <button class=\"btn btn-xs btn-danger\" ng-click=$ctrl.onRemove($ctrl.item.relationship)> Delete </button> <a ng-click=$ctrl.onDismiss() class=clickable> Dismiss </a> <hr> </div> <div class=small> <waltz-last-updated entity=$ctrl.item.relationship> </waltz-last-updated> </div>'},1189:function(e,t,a){\"use strict\";Object.defineProperty(t,\"__esModule\",{value:!0});var n=d(a(1)),i=d(a(1190)),r=a(0),l=a(12),o=a(75),s=a(29),c=a(149);function d(e){return e&&e.__esModule?e:{default:e}}var u={rows:[],columnDefs:[{field:\"a.name\",name:\"From\"},{field:\"a.type\",name:\"(From Type)\"},{field:\"relationship.relationship\",name:\"Relationship\",cellFilter:\"toDisplayName:'relationshipKind'\"},{field:\"b.name\",name:\"To\"},{field:\"b.type\",name:\"(To Type)\"}],onRowSelect:function(e){return console.log(\"default on row select\",{row:e})}};var p={template:i.default,controller:function(){var e=(0,r.initialiseData)(this,u);e.isSelected=function(t){if(e.selectedRow){var a=(0,l.sameRef)(t.a,e.selectedRow.a,{skipChecks:!0}),n=(0,l.sameRef)(t.b,e.selectedRow.b,{skipChecks:!0});return a&&n}return!1},e.export=function(){var t=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],t=n.default.map(e,function(e){return[e.a.name,e.a.type,e.b.name,e.b.type,(0,s.getEnumName)(c.relationshipKind,e.relationship.relationship),e.relationship.description,e.relationship.lastUpdatedAt,e.relationship.lastUpdatedBy]});return[[\"From\",\"From type\",\"To\",\"To type\",\"Relationship\",\"Description\",\"Last Updated At\",\"Last Updated By\"]].concat(t)}(e.rows);(0,o.downloadTextFile)(t,\",\",\"related_viewpoints.csv\")}},bindings:{rows:\"<\",onRowSelect:\"<\",selectedRow:\"<\"}};t.default={component:p,id:\"waltzRelatedMeasurablesTable\"}},1190:function(e,t){e.exports=' <waltz-grid-with-search ng-if=\"$ctrl.rows.length > 0\" column-defs=$ctrl.columnDefs entries=$ctrl.rows on-row-select=$ctrl.onRowSelect search-placeholder-text=\"Search relationships...\"> </waltz-grid-with-search> <a ng-click=$ctrl.export() ng-if=!$ctrl.selectedRow class=\"clickable pull-right\" style=text-decoration:none role=button> <waltz-icon name=download></waltz-icon> Export </a> '},1191:function(e,t,a){\"use strict\";Object.defineProperty(t,\"__esModule\",{value:!0});var n=d(a(1192)),i=a(0),r=a(2),l=d(a(1)),o=a(12),s=a(24),c=a(39);function d(e){return e&&e.__esModule?e:{default:e}}var u={selectedNode:null,allRelationships:[],measurablesByCategory:{}};function p(){var e=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[],a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:[],n=l.default.keyBy(t,\"id\"),i=l.default.chain(e).flatMap(function(e){return[e.a,e.b]}).filter(function(e){return\"MEASURABLE\"===e.kind&&n[e.id]}).uniqBy(function(e){return e.id}).reject(function(e){return l.default.some(a,function(t){return(0,o.sameRef)(t,e,{skipChecks:!0})})}).map(function(e){return Object.assign({},n[e.id],{direct:!0})}).value(),r=l.default.map(i,\"id\"),s=l.default.chain(i).flatMap(function(e){for(var t=[],a=n[e.parentId];a;)t.push(a),a=n[a.parentId];return t}).uniqBy(function(e){return e.id}).reject(function(e){return l.default.includes(r,e.id)}).map(function(e){return Object.assign({},n[e.id],{direct:!1})}).value();return l.default.concat(i,s)}(arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],arguments.length>1&&void 0!==arguments[1]?arguments[1]:[]);return(0,s.buildHierarchies)(e,!1)}function f(e){var t=(0,i.initialiseData)(this,u),a=function(){t.treeData=p(t.allRelationships,t.measurablesByCategory[t.category.id]),t.expandedNodes=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];return(0,i.isEmpty)(e)?[]:l.default.concat(e,e[0].children)}(t.treeData),t.selectedNode=null};t.$onInit=function(){var n=e.loadViewData(r.CORE_API.MeasurableRelationshipStore.findByEntityReference,[t.parentEntityRef],{force:!0}).then(function(e){return t.allRelationships=e.data}),i=e.loadAppData(r.CORE_API.MeasurableStore.findAll).then(function(e){return t.measurablesByCategory=l.default.chain(e.data).map(function(e){return Object.assign({},e,{displayName:(0,c.truncateMiddle)(e.name,96)})}).groupBy(\"categoryId\").value()});n.then(function(){return i}).then(function(){return a()})},t.$onChanges=function(){t.allRelationships&&t.measurablesByCategory&&a()},t.onSelect=function(e){t.selectedNode=e}}f.$inject=[\"ServiceBroker\"];var m={controller:f,template:n.default,bindings:{parentEntityRef:\"<\",category:\"<\"}};t.default={id:\"waltzRelatedMeasurablesTree\",component:m}},1192:function(e,t){e.exports=' <treecontrol class=tree-light tree-model=$ctrl.treeData expanded-nodes=$ctrl.expandedNodes options=$ctrl.treeOptions on-selection=$ctrl.onSelect(node) order-by=\"\\'-name\\'\"> <span class=no-overflow> <span ng-bind=node.displayName uib-popover-template=\"\\'wrmt-popover.html\\'\" popover-trigger=mouseenter popover-append-to-body=true popover-placement=top popover-popup-delay=300 popover-enable=\"node.description.length > 0 || node.name.length > 96\" ng-class=\"{ \\'italics\\' : ! node.direct }\"> </span> </span> </treecontrol> <div ng-if=$ctrl.selectedNode> <hr> <h4> <span ng-bind=$ctrl.selectedNode.name></span> <small> <a ui-sref=\"main.measurable.view ({id: $ctrl.selectedNode.id })\"> Visit </a> </small> </h4> <div ng-bind=$ctrl.selectedNode.description></div> </div> <script type=text/ng-template id=wrmt-popover.html> <div class=\"small\">\\n        <strong ng-bind=\"node.name\"></strong>\\n        <hr>\\n        <waltz-markdown text=\"node.description\"></waltz-markdown>\\n    </div> <\\/script>'},1193:function(e,t,a){\"use strict\";Object.defineProperty(t,\"__esModule\",{value:!0});var n=function(){return function(e,t){if(Array.isArray(e))return e;if(Symbol.iterator in Object(e))return function(e,t){var a=[],n=!0,i=!1,r=void 0;try{for(var l,o=e[Symbol.iterator]();!(n=(l=o.next()).done)&&(a.push(l.value),!t||a.length!==t);n=!0);}catch(e){i=!0,r=e}finally{try{!n&&o.return&&o.return()}finally{if(i)throw r}}return a}(e,t);throw new TypeError(\"Invalid attempt to destructure non-iterable instance\")}}(),i=p(a(1)),r=a(0),l=a(12),o=a(2),s=a(80),c=a(29),d=a(398),u=p(a(1194));function p(e){return e&&e.__esModule?e:{default:e}}var f={categories:[],measurables:[],relationships:[],selectedCategory:null,selectedRow:null,gridData:[],visibility:{editor:!1,detailMode:\"table\",detailModeChanger:!1,createEditor:!1,updateEditor:!1}},m=function(){return!0};function g(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[],a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:[],n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:[],r=arguments.length>4&&void 0!==arguments[4]?arguments[4]:[],o=arguments.length>5&&void 0!==arguments[5]?arguments[5]:function(){return!0},d=i.default.keyBy(a,\"id\"),u=i.default.keyBy(n,\"id\"),p=i.default.keyBy(r,\"id\"),f=function(e,t){switch(e){case\"MEASURABLE\":return function(e){var t=u[d[e.id].categoryId];return Object.assign({},e,{type:t.name})}(t);case\"APP_GROUP\":return function(e){var t=p[e.id];return Object.assign({},e,{name:null!==t?t.name:\"\",type:\"App Group\"})}(t);default:return function(e){return Object.assign({},e,{type:(0,c.getEnumName)(s.entity,e.kind)})}(t)}};return i.default.chain(t).filter(o).map(function(t){return{outbound:(0,l.sameRef)(t.a,e,{skipChecks:!0}),a:f(t.a.kind,t.a),b:f(t.b.kind,t.b),relationship:t}}).filter(function(e){return null!==e}).sortBy([\"a.name\",\"b.name\"]).value()}function v(e,t,a,s){var c=this,u=function(){return g(c.parentEntityRef,c.relationships,c.measurables,c.categories,c.appGroups,c.selectionFilterFn)};c.onChangeDetailMode=function(e){c.visibility.detailMode=e},c.refresh=function(){c.cancelEditor(),p().then(function(){c.selectedRow&&(c.selectedRow=i.default.find(c.gridData||[],function(e){var t=(0,l.sameRef)(c.selectedRow.a,e.a,{skipChecks:!0}),a=(0,l.sameRef)(c.selectedRow.b,e.b,{skipChecks:!0}),n=c.selectedRow.relationship.relationship===e.relationship.relationship;return t&&a&&n}))})},c.selectCategory=function(e){return t(function(){c.selectedCategory=e,\"MEASURABLE_CATEGORY\"===i.default.get(e,\"ref.kind\")?c.visibility.detailModeChanger=!0:(c.visibility.detailMode=\"table\",c.visibility.detailModeChanger=!1),c.selectedRow=null,c.selectionFilterFn=e.relationshipFilter,c.gridData=u(),c.cancelEditor()})},c.clearCategory=function(){return t(function(){c.selectedCategory=null,c.selectedRow=null,c.selectionFilterFn=m,c.gridData=u(),c.visibility.detailMode=\"table\",c.visibility.detailModeChanger=!1})},c.selectRow=function(e){e===c.selectedRow?c.clearRowSelection():c.selectedRow=e,c.cancelEditor()},c.clearRowSelection=function(){c.selectedRow=null},c.removeRelationship=function(e){confirm(\"Are you sure you want to delete this relationship ?\")&&v(e).then(function(){s.warning(\"Relationship removed\"),c.clearRowSelection(),p()}).catch(function(e){s.error(\"Relationship could not be removed\",e)})},c.beginNewRelationship=function(){c.visibility.editor=!0,c.visibility.createEditor=!0,c.visibility.updateEditor=!1},c.cancelEditor=function(){c.visibility.editor=!1,c.visibility.createEditor=!1,c.visibility.updateEditor=!1},c.updateExistingRelationship=function(){c.visibility.editor=!0,c.visibility.createEditor=!1,c.visibility.updateEditor=!0},c.selectionFilterFn=m;var p=function(){return a.loadViewData(o.CORE_API.MeasurableRelationshipStore.findByEntityReference,[c.parentEntityRef],{force:!0}).then(function(e){c.relationships=(0,d.sanitizeRelationships)(e.data,c.measurables,c.categories),c.gridData=u()})},v=function(e){return a.execute(o.CORE_API.MeasurableRelationshipStore.remove,[e])};c.$onInit=function(){(0,r.initialiseData)(c,f),function(){var t=[a.loadAppData(o.CORE_API.MeasurableCategoryStore.findAll).then(function(e){return e.data}),a.loadAppData(o.CORE_API.MeasurableStore.findAll).then(function(e){return e.data}),a.loadAppData(o.CORE_API.AppGroupStore.findPublicGroups).then(function(e){return e.data}),a.loadAppData(o.CORE_API.AppGroupStore.findPrivateGroups).then(function(e){return e.data})];e.all(t).then(function(e){var t=n(e,4),a=t[0],r=t[1],l=t[2],o=t[3];c.categories=a,c.measurables=r,c.appGroups=i.default.union(l,o)}).then(p)}()}}v.$inject=[\"$q\",\"$timeout\",\"ServiceBroker\",\"Notification\"];var b={template:u.default,bindings:{parentEntityRef:\"<\"},controller:v};t.default=b},1194:function(e,t){e.exports='<div class=\"row waltz-related-measurables-panel\" ng-if=\"$ctrl.relationships.length == 0 && ! $ctrl.showAnyway\"> <div class=col-sm-12> <waltz-no-data> <message> <div> No explicit relationships defined to other viewpoints. </div> <div waltz-has-role=CAPABILITY_EDITOR> <div> <waltz-icon name=warning></waltz-icon> <strong>You</strong> have permission to create relationships. <a ng-click=\"$ctrl.showAnyway = true\" class=clickable> Show this </a> section to make changes. </div> </div> </message> </waltz-no-data> </div> </div> <div class=\"row waltz-related-measurables-panel\" ng-if=\"$ctrl.relationships.length > 0 || $ctrl.showAnyway\"> <div class=col-sm-5> <waltz-related-measurables-viz relationships=$ctrl.relationships on-category-select=$ctrl.selectCategory on-category-clear=$ctrl.clearCategory parent-entity-ref=$ctrl.parentEntityRef> </waltz-related-measurables-viz> </div> <div class=col-sm-7> <div ng-if=\"$ctrl.gridData.length > 0\" class=\"waltz-fade-if small\"> <div ng-if=$ctrl.selectedCategory> <h4> Selected Category: <span ng-bind=$ctrl.selectedCategory.name></span> <a class=\"clickable pull-right\" ng-click=$ctrl.clearCategory()> (x) </a> </h4> </div> <div ng-if=$ctrl.visibility.detailModeChanger> Show as <span ng-if=\"$ctrl.visibility.detailMode === \\'table\\'\"> table or <a ng-click=\"$ctrl.onChangeDetailMode(\\'tree\\')\" class=clickable> tree </a> </span> <span ng-if=\"$ctrl.visibility.detailMode === \\'tree\\'\"> <a ng-click=\"$ctrl.onChangeDetailMode(\\'table\\')\" class=clickable> table </a> or tree </span> </div> <span ng-if=\"$ctrl.visibility.detailMode === \\'tree\\'\" style=padding:8px> <waltz-related-measurables-tree parent-entity-ref=$ctrl.parentEntityRef category=$ctrl.selectedCategory.ref> </waltz-related-measurables-tree> </span> <span ng-if=\"$ctrl.visibility.detailMode === \\'table\\'\"> <waltz-related-measurables-table rows=$ctrl.gridData on-row-select=$ctrl.selectRow selected-row=$ctrl.selectedRow> </waltz-related-measurables-table> <div ng-if=\"$ctrl.selectedCategory && !$ctrl.visibility.editor && !$ctrl.selectedRow\" class=waltz-fade-if> Select a category or relationship to make changes. </div> <div ng-if=\"$ctrl.selectedRow && ! $ctrl.visibility.editor\" class=waltz-fade-if> <hr> <waltz-related-measurable-item-view item=$ctrl.selectedRow on-dismiss=$ctrl.clearRowSelection on-edit=$ctrl.updateExistingRelationship on-remove=$ctrl.removeRelationship> </waltz-related-measurable-item-view> </div> </span> </div> <div ng-if=\"$ctrl.gridData.length == 0 \" class=waltz-fade-if> <waltz-no-data> <message> <strong>No relationships</strong> have been defined. </message> </waltz-no-data> </div> <div ng-if=\"!$ctrl.visibility.editor && !$ctrl.selectedRow && $ctrl.selectedCategory\"> <br> <div waltz-has-role=CAPABILITY_EDITOR> <a class=clickable ng-click=$ctrl.beginNewRelationship()> Add new relationship... </a> </div> </div> <div ng-if=$ctrl.visibility.createEditor class=waltz-fade-if> <hr> <waltz-create-related-measurable-editor parent-entity-ref=$ctrl.parentEntityRef type=$ctrl.selectedCategory on-cancel=$ctrl.cancelEditor on-refresh=$ctrl.refresh> </waltz-create-related-measurable-editor> </div> <div ng-if=$ctrl.visibility.updateEditor class=waltz-fade-if> <hr> <waltz-update-related-measurable-editor relationship=$ctrl.selectedRow.relationship on-cancel=$ctrl.cancelEditor on-refresh=$ctrl.refresh> </waltz-update-related-measurable-editor> </div> </div> </div> '},1195:function(e,t,a){\"use strict\";Object.defineProperty(t,\"__esModule\",{value:!0});var n=f(a(1)),i=a(5),r=a(398),l=a(0),o=a(153),s=a(44),c=a(2),d=a(119),u=a(62),p=f(a(1196));function f(e){return e&&e.__esModule?e:{default:e}}var m={selectedCategoryId:null,categories:[],measurables:[],parentEntityRef:null,relationships:{},onCategorySelect:function(e){return console.log(\"wrmv: default on-category-select\",e)},onCategoryClear:function(){return console.log(\"wrmv: default on-category-clear\")}},g={width:460,height:460,centerNode:{r:75},outerNode:{distanceFromCenter:170,r:45},bridge:{w:2},nodeName:{dy:1},nodeDescription:{dy:16}},v=-.7,b=(0,u.transition)().ease(d.easeLinear).duration(300),h={centerNodes:\"wrmv-center-nodes\",centerNode:\"wrmv-center-node\",nodeName:\"wrmv-name\",nodeDetail:\"wrmv-detail\",outerNodes:\"wrmv-outer-nodes\",outerNode:\"wrmv-outer-node\",bridges:\"wrmv-bridges\",bridge:\"wrmv-bridge\",hasRelationships:\"has-relationships\",noRelationships:\"no-relationships\",selected:\"wrmv-selected\"};function y(e){var t=g.outerNode.distanceFromCenter;return{x:t*Math.cos(e)+g.width/2,y:t*Math.sin(e)+g.height/2}}function w(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[],a=arguments[2],i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:[],l=arguments[4];if(!a)return[];var o=n.default.groupBy(t,function(e){return e.categoryId}),s=n.default.keyBy(t,function(e){return e.id}),c=n.default.map(i,function(e){return(0,r.determineCounterpart)(a,e,{skipChecks:!0})}),d=n.default.countBy(c,function(e){return\"MEASURABLE\"===e.kind?\"MEASURABLE_CATEGORY/\"+s[e.id].categoryId:e.kind}),u=n.default.chain(e).map(function(e){var t=n.default.map(o[e.id]||[],function(e){return e.id}),i=\"MEASURABLE_CATEGORY/\"+e.id;return{id:i,ref:{id:e.id,kind:e.kind},name:e.name,relationshipFilter:function(e){var i=(0,r.determineCounterpart)(a,e,{skipChecks:!0});return\"MEASURABLE\"===i.kind&&n.default.includes(t,i.id)},count:d[i]||0,isSelected:l===i}}).filter(function(e){return e.count>0}).orderBy(\"name\").value();return u.push(function(e,t,a){var n=\"CHANGE_INITIATIVE\";return{id:n,name:\"Change Initiative\",relationshipFilter:function(t){return n===(0,r.determineCounterpart)(e,t).kind},count:t[n]||0,isSelected:a===n}}(a,d,l)),u.push(function(e,t,a){var n=\"APP_GROUP\";return{id:n,name:\"Application Group\",relationshipFilter:function(t){return n===(0,r.determineCounterpart)(e,t).kind},count:t[n]||0,isSelected:a===n}}(a,d,l)),u.push(function(e){var t=\"MEASURABLE\";return{id:t,name:\"Add Viewpoint\",relationshipFilter:function(){return!1},count:null,isSelected:e===t}}(l)),u}function $(e,t,a){if(e&&t.primaryEntity&&t.categories){var n=w(t.categories,t.measurables,t.primaryEntity,t.relationships,t.selectedCategoryId),r=function(e){return e*(2*Math.PI)/n.length+v};!function(e,t){if(e){var a=e.selectAll(\".\"+h.centerNode).data([t],function(e){return e.id}).enter().append(\"g\").classed(h.centerNode,!0);a.append(\"circle\").attr(\"cx\",g.width/2).attr(\"cy\",g.height/2).attr(\"r\",g.centerNode.r).attr(\"fill\",\"white\").attr(\"stroke\",\"red\"),a.append(\"text\").text(function(e){return e.name}).classed(h.nodeName,!0).attr(\"text-anchor\",\"middle\").attr(\"x\",g.width/2).attr(\"y\",g.height/2).attr(\"dy\",g.nodeName.dy),a.append(\"text\").text(function(e){return e.category.name}).classed(h.nodeDetail,!0).attr(\"text-anchor\",\"middle\").attr(\"x\",g.width/2).attr(\"y\",g.height/2).attr(\"dy\",g.nodeDescription.dy)}}(e.centerNodes,t.primaryEntity),function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[],a=arguments[2],n=arguments[3];if(e){var r=e.selectAll(\".\"+h.outerNode).data(t,function(e){return e.id}),l=r.enter().append(\"g\").classed(h.outerNode,!0).on(\"click\",function(e){n.onCategorySelect(e),(0,o.stopPropagation)(i.event)}).attr(\"transform\",\"translate(\"+g.width/2+\", \"+g.height/2+\")\");l.append(\"circle\").attr(\"stroke\",\"#ccc\").attr(\"fill\",\"white\"),l.append(\"text\").classed(h.nodeName,!0).text(function(e){return e.name}).attr(\"text-anchor\",\"middle\").attr(\"dy\",g.nodeName.dy),l.append(\"text\").classed(h.nodeDetail,!0);var s=l.merge(r);s.classed(h.selected,function(e){return e.isSelected}).classed(h.hasRelationships,function(e){return e.count>0}).classed(h.noRelationships,function(e){return 0===e.count}).transition(b).attr(\"transform\",function(e,t){var n=y(a(t));return\"translate(\"+n.x+\", \"+n.y+\")\"}),s.select(\"circle\").transition(b).attr(\"r\",function(e){var t=e.count>0?1:.8;return g.outerNode.r*t}),s.select(\".\"+h.nodeDetail).text(function(e){return e.count?e.count:\"-\"}).attr(\"text-anchor\",\"middle\").attr(\"dy\",g.nodeDescription.dy),r.exit().remove()}}(e.outerNodes,n,r,a),function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[],a=arguments[2];if(e){var n=e.selectAll(\".\"+h.bridge).data(t,function(e){return e.id});n.enter().append(\"line\").classed(h.bridge,!0).attr(\"x1\",g.width/2).attr(\"y1\",g.height/2).attr(\"stroke\",\"#aaa\").attr(\"stroke-width\",g.bridge.w).merge(n).each(function(e,t){var n=y(a(t)),r=n.x,l=n.y;(0,i.select)(this).attr(\"x2\",r).attr(\"y2\",l)}),n.exit().remove()}}(e.bridges,n,r)}}function S(e,t){return{onCategoryClear:function(){e.selectedCategoryId=null,e.onCategoryClear(),t(function(){return e.$onChanges()},0)},onCategorySelect:function(a){e.selectedCategoryId=a.id,e.onCategorySelect(a),t(function(){return e.$onChanges()},0)}}}function R(e){var t={};return t.categories=e.categories||[],t.measurables=e.measurables||[],t.relationships=(0,r.sanitizeRelationships)(e.relationships||[],t.measurables,t.categories),t.primaryEntity=e.primaryEntity||{name:\"Loading\",category:{name:\"...\"},id:-1,kind:\"ZZZ\"},t.selectedCategoryId=e.selectedCategoryId,t}function E(e,t,a,r){var o=this,d=function(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0],a=r.loadAppData(c.CORE_API.MeasurableStore.findAll,[],{force:e}).then(function(e){return o.measurables=e.data}),i=r.loadAppData(c.CORE_API.MeasurableCategoryStore.findAll,[],{force:e}).then(function(e){return o.categories=e.data});return t.all([a,i]).then(function(){return function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[],a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:[],i=arguments[3],r=e.kind;if(\"MEASURABLE\"===r){var l=n.default.find(t,{id:e.id}),o=n.default.find(a,{id:l.categoryId});return Promise.resolve({id:e.id,kind:e.kind,name:l.name,category:o})}return\"CHANGE_INITIATIVE\"===r?i.loadViewData(c.CORE_API.ChangeInitiativeStore.getById,[e.id]).then(function(t){return{id:e.id,kind:e.kind,name:t.data.name,category:{name:\"Change Initiative\"}}}):\"APP_GROUP\"===r?i.loadViewData(c.CORE_API.AppGroupStore.getById,[e.id]).then(function(t){return{id:e.id,kind:e.kind,name:t.data.appGroup.name,category:{name:\"Application Group\"}}}):Promise.reject(\"Cannot handle kind: \"+r)}(o.parentEntityRef,o.measurables,o.categories,r)}).then(function(e){return o.primaryEntity=e})},u=function(){},p={};o.$onInit=function(){(0,l.initialiseData)(o,m);var t=e.find(\"svg\")[0],n=S(o,a);p=function(e,t){var a=(0,i.select)(e).attr(\"width\",g.width).attr(\"height\",g.height).on(\"click\",function(){return t()}),n=a.append(\"g\").classed(h.bridges,!0);return{svg:a,centerNodes:a.append(\"g\").classed(h.centerNodes,!0),bridges:n,outerNodes:a.append(\"g\").classed(h.outerNodes,!0)}}(t,n.onCategoryClear),u=(0,s.responsivefy)(p.svg),d().then(function(){return $(p,R(o),n)})},o.$onChanges=function(){$(p,R(o),S(o,a))},o.$onDestroy=function(){u()}}E.$inject=[\"$element\",\"$q\",\"$timeout\",\"ServiceBroker\"];var A={template:p.default,bindings:{parentEntityRef:\"<\",relationships:\"<\",onCategorySelect:\"<\",onCategoryClear:\"<\"},controller:E};t.default=A},1196:function(e,t){e.exports=\"<div class=waltz-related-measurables-viz> <svg></svg> </div> \"},235:function(e,t,a){\"use strict\";function n(e,t){var a=t+\"/measurable-category\";return{findAll:function(){return e.get(a+\"/all\").then(function(e){return e.data})},getById:function(t){return e.get(a+\"/id/\"+t).then(function(e){return e.data})}}}Object.defineProperty(t,\"__esModule\",{value:!0}),n.$inject=[\"$http\",\"BaseApiUrl\"];var i=\"MeasurableCategoryStore\";t.default={serviceName:i,store:n};t.MeasurableCategoryStore_API={findAll:{serviceName:i,serviceFnName:\"findAll\",description:\"finds all categories\"},getById:{serviceName:i,serviceFnName:\"getById\",description:\"retrieves a single category\"}}},236:function(e,t,a){\"use strict\";Object.defineProperty(t,\"__esModule\",{value:!0}),t.MeasurableRatingStore_API=void 0;var n=a(8);function i(e,t){var a=t+\"/measurable-rating\";return{findByMeasurableSelector:function(t){return(0,n.checkIsIdSelector)(t),e.post(a+\"/measurable-selector\",t).then(function(e){return e.data})},findByAppSelector:function(t){return(0,n.checkIsIdSelector)(t),e.post(a+\"/app-selector\",t).then(function(e){return e.data})},findByCategory:function(t){return e.get(a+\"/category/\"+t).then(function(e){return e.data})},findForEntityReference:function(t){return(0,n.checkIsEntityRef)(t),e.get(a+\"/entity/\"+t.kind+\"/\"+t.id).then(function(e){return e.data})},countByMeasurable:function(){return e.get(a+\"/count-by/measurable\").then(function(e){return e.data})},countByMeasurableCategory:function(t){return e.get(a+\"/count-by/measurable/category/\"+t).then(function(e){return e.data})},statsByAppSelector:function(t){return(0,n.checkIsIdSelector)(t),e.post(a+\"/stats-by/app-selector\",t).then(function(e){return e.data})},statsForRelatedMeasurables:function(t){return(0,n.checkIsIdSelector)(t),e.post(a+\"/related-stats/measurable\",t).then(function(e){return e.data})},create:function(t,i){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:\"Z\",l=arguments.length>3&&void 0!==arguments[3]?arguments[3]:\"\",o=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null;return(0,n.checkIsEntityRef)(t),e.post(a+\"/entity/\"+t.kind+\"/\"+t.id+\"/\"+i,{rating:r,description:l,plannedDate:o}).then(function(e){return e.data})},update:function(t,i){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:\"Z\",l=arguments.length>3&&void 0!==arguments[3]?arguments[3]:\"\",o=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null;return(0,n.checkIsEntityRef)(t),e.put(a+\"/entity/\"+t.kind+\"/\"+t.id+\"/\"+i,{rating:r,description:l,plannedDate:o}).then(function(e){return e.data})},remove:function(t,i){return(0,n.checkIsEntityRef)(t),e.delete(a+\"/entity/\"+t.kind+\"/\"+t.id+\"/\"+i).then(function(e){return e.data})}}}i.$inject=[\"$http\",\"BaseApiUrl\"];var r=\"MeasurableRatingStore\";t.MeasurableRatingStore_API={findByMeasurableSelector:{serviceName:r,serviceFnName:\"findByMeasurableSelector\",description:\"finds measurables by measurable selector\"},findByAppSelector:{serviceName:r,serviceFnName:\"findByAppSelector\",description:\"finds measurables by app selector\"},findByCategory:{serviceName:r,serviceFnName:\"findByCategory\",description:\"finds measurable ratings for a given category id\"},findForEntityReference:{serviceName:r,serviceFnName:\"findForEntityReference\",description:\"find measurables for an entity reference\"},countByMeasurable:{serviceName:r,serviceFnName:\"countByMeasurable\",description:\"return a count by measurable\"},countByMeasurableCategory:{serviceName:r,serviceFnName:\"countByMeasurableCategory\",description:\"return a count by measurable category [categoryId]\"},statsByAppSelector:{serviceName:r,serviceFnName:\"statsByAppSelector\",description:\"return measurable stats by app selector\"},statsForRelatedMeasurables:{serviceName:r,serviceFnName:\"statsForRelatedMeasurables\",description:\"return stats for related measurables\"},create:{serviceName:r,serviceFnName:\"create\",description:\"create a measurable\"},update:{serviceName:r,serviceFnName:\"update\",description:\"update a measurable\"},remove:{serviceName:r,serviceFnName:\"remove\",description:\"remove a measurable\"}};t.default={serviceName:r,store:i}},237:function(e,t,a){\"use strict\";Object.defineProperty(t,\"__esModule\",{value:!0}),t.MeasurableRelationshipStore_API=t.serviceName=void 0,t.store=i;var n=a(8);function i(e,t){var a=t+\"/measurable-relationship\";return{findByEntityReference:function(t){return(0,n.checkIsEntityRef)(t),e.get(a+\"/\"+t.kind+\"/\"+t.id).then(function(e){return e.data})},tallyByEntityReference:function(t){return(0,n.checkIsEntityRef)(t),e.get(a+\"/\"+t.kind+\"/\"+t.id+\"/tally\").then(function(e){return e.data})},remove:function(t){(0,n.checkIsEntityRef)(t.a),(0,n.checkIsEntityRef)(t.b);var i=a+\"/\"+t.a.kind+\"/\"+t.a.id+\"/\"+t.b.kind+\"/\"+t.b.id+\"/\"+t.relationship;return e.delete(i).then(function(e){return e.data})},create:function(t){(0,n.checkIsEntityRef)(t.a),(0,n.checkIsEntityRef)(t.b);var i=a+\"/\"+t.a.kind+\"/\"+t.a.id+\"/\"+t.b.kind+\"/\"+t.b.id+\"/\"+t.relationshipKind;return e.post(i,t.description).then(function(e){return e.data})},update:function(t,i){(0,n.checkIsEntityRef)(t.a),(0,n.checkIsEntityRef)(t.b);var r=a+\"/\"+t.a.kind+\"/\"+t.a.id+\"/\"+t.b.kind+\"/\"+t.b.id+\"/\"+t.relationshipKind;return e.put(r,i).then(function(e){return e.data})}}}i.$inject=[\"$http\",\"BaseApiUrl\"];var r=t.serviceName=\"MeasurableRelationshipStore\";t.MeasurableRelationshipStore_API={findByEntityReference:{serviceName:r,serviceFnName:\"findByEntityReference\",description:\"finds relationships by given entity reference\"},tallyByEntityReference:{serviceName:r,serviceFnName:\"tallyByEntityReference\",description:\"tallies relationships by given entity reference\"},create:{serviceName:r,serviceFnName:\"create\",description:\"creates a relationship\"},update:{serviceName:r,serviceFnName:\"update\",description:\"updates a relationship (key, changes)\"},remove:{serviceName:r,serviceFnName:\"remove\",description:\"removes a relationship\"}}},238:function(e,t,a){\"use strict\";Object.defineProperty(t,\"__esModule\",{value:!0}),t.MeasurableStore_API=void 0;var n=a(8);function i(e,t){var a=t+\"/measurable\";return{findAll:function(){return e.get(a+\"/all\").then(function(e){return e.data})},findByExternalId:function(t){return e.get(a+\"/external-id/\"+t).then(function(e){return e.data})},findMeasurablesRelatedToPath:function(t){return(0,n.checkIsEntityRef)(t),e.get(a+\"/entity/\"+t.kind+\"/\"+t.id).then(function(e){return e.data})},findMeasurablesBySelector:function(t){return(0,n.checkIsIdSelector)(t),e.post(a+\"/measurable-selector\",t).then(function(e){return e.data})},search:function(t){return e.get(a+\"/search/\"+t).then(function(e){return e.data})}}}i.$inject=[\"$http\",\"BaseApiUrl\"];var r=\"MeasurableStore\";t.default={store:i,serviceName:r};t.MeasurableStore_API={findAll:{serviceName:r,serviceFnName:\"findAll\",description:\"findAll\"},findByExternalId:{serviceName:r,serviceFnName:\"findByExternalId\",description:\"saves an entity named note\"},search:{serviceName:r,serviceFnName:\"search\",description:\"executes search\"},findMeasurablesRelatedToPath:{serviceName:r,serviceFnName:\"findMeasurablesRelatedToPath\",description:\"executes findMeasurablesRelatedToPath\"},findMeasurablesBySelector:{serviceName:r,serviceFnName:\"findMeasurablesBySelector\",description:\"executes findMeasurablesBySelector\"}}},397:function(e,t,a){\"use strict\";Object.defineProperty(t,\"__esModule\",{value:!0}),t.mkTabs=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:[],i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:[],r=!(arguments.length>4&&void 0!==arguments[4])||arguments[4],l=n.default.groupBy(a,\"categoryId\");return n.default.chain(e).map(function(e){var a=l[e.id]||[],r=n.default.map(a,\"id\"),o=n.default.filter(i,function(e){return n.default.includes(r,e.measurableId)}),s=t[e.ratingSchemeId];return{category:e,ratingScheme:s,measurables:a,ratings:o}}).filter(function(e){return e.ratings.length>0||r}).sortBy(function(e){return e.category.name}).value()},t.determineStartingTab=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];return n.default.find(e,function(e){return e.ratings.length>0})||e[0]};var n=function(e){return e&&e.__esModule?e:{default:e}}(a(1))},398:function(e,t,a){\"use strict\";Object.defineProperty(t,\"__esModule\",{value:!0}),t.determineCounterpart=function(e,t){var a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{skipChecks:!1};a.skipChecks||(0,i.checkIsEntityRef)(e);return(0,r.sameRef)(e,t.a,a)?t.b:t.a},t.sanitizeRelationships=function(e,t,a){var i=n.default.keyBy(a,function(e){return e.id}),r=n.default.keyBy(t,function(e){return e.id}),l=function(e){return r[e]&&i[r[e].categoryId]};return n.default.filter(e,function(e){var t=n.default.some([{a:\"MEASURABLE\",b:\"APP_GROUP\"},{a:\"MEASURABLE\",b:\"CHANGE_INITIATIVE\"},{a:\"MEASURABLE\",b:\"MEASURABLE\"},{a:\"CHANGE_INITIATIVE\",b:\"APP_GROUP\"},{a:\"CHANGE_INITIATIVE\",b:\"CHANGE_INITIATIVE\"},{a:\"CHANGE_INITIATIVE\",b:\"MEASURABLE\"},{a:\"APP_GROUP\",b:\"APP_GROUP\"},{a:\"APP_GROUP\",b:\"CHANGE_INITIATIVE\"},{a:\"APP_GROUP\",b:\"MEASURABLE\"}],function(t){return t.a===e.a.kind&&t.b===e.b.kind}),a=\"MEASURABLE\"!==e.a.kind||l(e.a.id),i=\"MEASURABLE\"!==e.b.kind||l(e.b.id);return t&&a&&i})};var n=function(e){return e&&e.__esModule?e:{default:e}}(a(1)),i=a(8),r=a(12)},438:function(e,t,a){\"use strict\";Object.defineProperty(t,\"__esModule\",{value:!0}),a(439),a(641),a(643),a(645),a(647),a(649),a(650),a(652),a(653),a(654),a(656),a(657),a(659),a(663);var n=Ee(a(197)),i=Ee(a(665)),r=Ee(a(666)),l=Ee(a(668)),o=Ee(a(679)),s=Ee(a(680)),c=Ee(a(734)),d=Ee(a(753)),u=Ee(a(761)),p=Ee(a(767)),f=Ee(a(794)),m=Ee(a(808)),g=Ee(a(821)),v=Ee(a(831)),b=Ee(a(835)),h=Ee(a(880)),y=Ee(a(888)),w=Ee(a(897)),$=Ee(a(904)),S=Ee(a(928)),R=Ee(a(931)),E=Ee(a(942)),A=Ee(a(952)),C=Ee(a(953)),I=Ee(a(966)),k=Ee(a(969)),z=Ee(a(972)),M=Ee(a(977)),_=Ee(a(978)),P=Ee(a(1011)),B=Ee(a(1016)),x=Ee(a(1020)),D=Ee(a(1024)),N=Ee(a(1045)),O=Ee(a(1051)),T=Ee(a(1079)),j=Ee(a(1082)),V=Ee(a(1084)),U=Ee(a(1088)),F=Ee(a(1090)),G=Ee(a(1094)),L=Ee(a(1142)),K=Ee(a(1143)),H=Ee(a(1155)),q=Ee(a(1161)),W=Ee(a(1181)),Y=Ee(a(1197)),Z=Ee(a(1209)),X=Ee(a(1210)),J=Ee(a(1223)),Q=Ee(a(1225)),ee=Ee(a(1242)),te=Ee(a(1276)),ae=Ee(a(1298)),ne=Ee(a(1301)),ie=Ee(a(1320)),re=Ee(a(1323)),le=Ee(a(1327)),oe=Ee(a(1335)),se=Ee(a(1351)),ce=Ee(a(1367)),de=Ee(a(1368)),ue=Ee(a(1373)),pe=Ee(a(1383)),fe=Ee(a(1393)),me=Ee(a(1398)),ge=Ee(a(1435)),ve=Ee(a(1441)),be=Ee(a(1465)),he=Ee(a(1474)),ye=Ee(a(1481)),we=Ee(a(1485)),$e=Ee(a(1500)),Se=Ee(a(1502)),Re=Ee(a(1505));function Ee(e){return e&&e.__esModule?e:{default:e}}var Ae=[\"ui.bootstrap\",\"ui.router\",\"ui.select\",\"ui.grid\",\"ui.grid.autoResize\",\"ui.grid.exporter\",\"ui.grid.resizeColumns\",\"ui.grid.selection\",\"ui-notification\",\"ngAnimate\",\"ngSanitize\",\"ngTagsInput\",\"ng-showdown\",\"satellizer\",\"LocalStorageModule\",n.default,i.default,\"treeControl\",\"angular-loading-bar\",(0,r.default)(),(0,l.default)(),(0,o.default)(),(0,s.default)(),(0,c.default)(),(0,d.default)(),(0,u.default)(),(0,p.default)(),(0,f.default)(),(0,m.default)(),(0,g.default)(),(0,v.default)(),(0,b.default)(),(0,h.default)(),(0,y.default)(),(0,w.default)(),(0,$.default)(),(0,S.default)(),(0,R.default)(),(0,E.default)(),(0,A.default)(),(0,C.default)(),(0,I.default)(),(0,k.default)(),(0,z.default)(),(0,M.default)(),(0,_.default)(),(0,P.default)(),(0,B.default)(),(0,x.default)(),(0,D.default)(),(0,N.default)(),(0,O.default)(),(0,T.default)(),(0,j.default)(),(0,V.default)(),(0,U.default)(),(0,F.default)(),(0,G.default)(),(0,L.default)(),(0,K.default)(),(0,H.default)(),(0,q.default)(),(0,W.default)(),(0,Y.default)(),(0,Z.default)(),(0,X.default)(),(0,J.default)(),(0,Q.default)(),(0,ee.default)(),(0,te.default)(),(0,ae.default)(),(0,ne.default)(),(0,ie.default)(),(0,re.default)(),(0,le.default)(),(0,oe.default)(),(0,se.default)(),(0,ce.default)(),(0,de.default)(),(0,ue.default)(),(0,pe.default)(),(0,fe.default)(),(0,me.default)(),(0,ge.default)(),(0,ve.default)(),(0,be.default)(),(0,ye.default)(),(0,we.default)(),(0,$e.default)(),(0,he.default)(),(0,Se.default)(),(0,Re.default)()];t.default=Ae}}]);","extractedComments":[]}