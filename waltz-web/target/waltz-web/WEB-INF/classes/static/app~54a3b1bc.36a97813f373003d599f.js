(window.webpackJsonp=window.webpackJsonp||[]).push([[8],{1197:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=d(n(6)),a=n(7),o=d(n(1198)),r=d(n(1200)),l=d(n(1202)),s=d(n(1205)),c=d(n(1207));function d(e){return e&&e.__esModule?e:{default:e}}t.default=function(){var e=i.default.module("waltz.navbar",[]);return e.directive("waltzNavbar",l.default).directive("waltzNavbarRecentlyViewed",s.default).directive("waltzNavbarProfile",c.default),(0,a.registerComponents)(e,[o.default,r.default]),e.name}},1198:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=n(0),a=function(e){return e&&e.__esModule?e:{default:e}}(n(1199));var o={query:"",visibility:{overlay:!1}};function r(e){var t=(0,i.initialiseData)(this,o);t.dismissResults=function(n){return e(function(){return t.visibility.overlay=!1},200)},t.showSearch=function(){return t.visibility.overlay=!0}}r.$inject=["$timeout"];var l={bindings:{},controller:r,template:a.default};t.default={component:l,id:"waltzNavbarSearch"}},1199:function(e,t){e.exports='<ul class="nav navbar-nav navbar-right" style=padding-right:20px> <li> <a class=clickable ng-click=$ctrl.showSearch()> <waltz-icon name=search></waltz-icon> Search <b class=caret></b> </a> </li> <waltz-nav-search-overlay on-dismiss=$ctrl.dismissResults visible=$ctrl.visibility.overlay> </waltz-nav-search-overlay> </ul>'},1200:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=n(2),a=n(0),o=function(e){return e&&e.__esModule?e:{default:e}}(n(1201));var r=27,l={categories:["APPLICATION","PERSON","ACTOR","CHANGE_INITIATIVE","DATA_TYPE","APP_GROUP","ORG_UNIT","MEASURABLE","PHYSICAL_SPECIFICATION","LOGICAL_DATA_ELEMENT","ROADMAP"],selectedCategory:null,showActiveOnly:!0,results:{},filteredResults:[]};function s(e,t,n,o){var s=(0,a.initialiseData)(this,l),c=function(t){(function(e,t){for(var n=t.parentNode;null!=n;){if(n==e)return!0;n=n.parentNode}return!1})(e[0],t.target)||s.dismiss()};s.$onChanges=function(i){(i.visible&&(s.selectedCategory=null),s.visible)?(e.find("input")[0].focus(),n(function(){return t.on("click",c)},200),n(function(){return e.on("keydown",s.onOverlayKeypress)},200)):(t.off("click",c),e.off("keydown",s.onOverlayKeypress))},s.$onDestroy=function(){t.off("click",c)},s.dismiss=function(){s.onDismiss?s.onDismiss():console.log("No dismiss handler registered")},s.toggleCategory=function(e){0!==(s.results[e]||[]).length&&(s.selectedCategory===e?s.selectedCategory=null:s.selectedCategory=e)};var d=function(e,t){var n=s.showActiveOnly?[a.entityLifecycleStatuses.ACTIVE,a.entityLifecycleStatuses.PENDING]:[a.entityLifecycleStatuses.ACTIVE,a.entityLifecycleStatuses.PENDING,a.entityLifecycleStatuses.REMOVED],r={entityKinds:[t],entityLifecycleStatuses:n};return o.loadViewData(i.CORE_API.EntitySearchStore.search,[e,r]).then(function(e){return s.results[t]=e.data})};s.doSearch=function(){return function(e){e?(d(e,"APPLICATION"),d(e,"CHANGE_INITIATIVE"),d(e,"DATA_TYPE"),d(e,"PERSON"),d(e,"MEASURABLE"),d(e,"ORG_UNIT"),d(e,"ACTOR"),d(e,"PHYSICAL_SPECIFICATION"),d(e,"APP_GROUP"),d(e,"LOGICAL_DATA_ELEMENT"),d(e,"ROADMAP")):s.clearSearch()}(s.query)},s.clearSearch=function(){s.results={},s.query="",s.selectedCategory=null},s.onKeypress=function(e){e.keyCode===r&&(s.query?s.clearSearch():s.dismiss()),e.stopPropagation()},s.onOverlayKeypress=function(e){e.keyCode===r&&s.dismiss()},s.toggleActiveOnly=function(){s.showActiveOnly=!s.showActiveOnly,s.doSearch()}}s.$inject=["$element","$document","$timeout","ServiceBroker"];var c={template:o.default,bindings:{query:"@",onDismiss:"<",visible:"<"},controller:s};t.default={component:c,id:"waltzNavSearchOverlay"}},1201:function(e,t){e.exports='<div class="waltz-nav-search-overlay waltz-fade-if" ng-if=$ctrl.visible tabindex=100> <div class=wnso-main> <small class=pull-right> <a class=clickable ng-click=$ctrl.dismiss()> <waltz-icon name=close></waltz-icon> </a> </small> <div class=wnso-search-region> <waltz-icon name=search ng-class="{\n                    \'wnso-search-active\' : $ctrl.query.length > 0,\n                    \'wnso-search-inactive\' : $ctrl.query.length == 0\n                }"> </waltz-icon> <input type=search class=form-control ng-model=$ctrl.query ng-model-options="{ debounce: 250 }" ng-change=$ctrl.doSearch() autocomplete=off autofocus=autofocus placeholder=Search ng-keydown=$ctrl.onKeypress($event) /> </div> <div class=row> <div class=col-sm-4> <table class="table table-condensed"> <colgroup> <col width=85%> <col width=15%> </colgroup> <thead> <tr> <th colspan=2> Filter </th> </tr> </thead> <tr ng-repeat="category in $ctrl.categories" class=wnso-category ng-class="{\n                            \'clickable\' : $ctrl.results[category].length > 0,\n                            \'wnso-selected\': $ctrl.selectedCategory === category\n                        }" ng-click=$ctrl.toggleCategory(category)> <td> <span ng-class="{\'text-muted\' : ! $ctrl.results[category].length > 0}"> <waltz-icon fixed-width=true name="{{ category | toIconName:\'entity\' }}"> </waltz-icon> <span ng-bind="category | toDisplayName:\'entity\'"></span> </span> </td> <td> <span ng-if="$ctrl.results[category].length > 0" class=small ng-bind=$ctrl.results[category].length> </span> </td> </tr> </table> </div> <div class=col-sm-8> <table class="table table-condensed table-striped table-hover"> <thead> <tr> <th colspan=2> Results <waltz-toggle class=pull-right state=$ctrl.showActiveOnly on-toggle=$ctrl.toggleActiveOnly() label-on="Active only" label-off="Active only"> </waltz-toggle> </th> </tr> </thead> <tbody ng-repeat="category in $ctrl.categories" class=waltz-fade-if ng-if="$ctrl.selectedCategory === category || $ctrl.selectedCategory === null"> <tr ng-repeat="item in $ctrl.results[category]"> <td> <waltz-entity-link tooltip-placement=right ng-click=$ctrl.dismiss() entity-ref=item> </waltz-entity-link> </td> </tr> </tbody> </table> </div> </div> </div> </div> '},1202:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=r(n(1)),a=n(0),o=r(n(1203));function r(e){return e&&e.__esModule?e:{default:e}}var l=[{uiSref:"main.org-unit.list",icon:"sitemap",displayName:"Org Units",id:"navbar-org-units"},{uiSref:"main.person",icon:"users",displayName:"People",id:"navbar-people"},{uiSref:"main.data-type.list",icon:"qrcode",displayName:"Data",id:"navbar-data-types"},{uiSref:"main.measurable-category.index",icon:"puzzle-piece",displayName:"Other Viewpoints",id:"navbar-measurables"}],s={logoOverlayText:"",logoOverlayColor:"#444",navItemsForRole:[]};function c(e,t){var n=(0,a.initialiseData)(this,s);e.findOrDefault("ui.logo.overlay.text","").then(function(e){return n.logoOverlayText=e}),e.findOrDefault("ui.logo.overlay.color","").then(function(e){return n.logoOverlayColor=e}),t.whoami().then(function(e){n.navItemsForRole=function(e,t,n){return i.default.filter(n,function(n){return!n.role||e.hasRole(t,n.role)})}(t,e,l)})}c.$inject=["SettingsService","UserService"],t.default=function(){return{restrict:"E",template:o.default,controller:c,scope:{},controllerAs:"ctrl"}}},1203:function(e,t,n){e.exports='<nav class="navbar navbar-default navbar-fixed-top"> <div class=navbar-header> <a class=navbar-brand ui-sref=main.home> <img height=30px style=position:relative;top:-6px src='+n(1204)+'> </a> <span ng-bind=ctrl.logoOverlayText style=display:inline;position:absolute;left:72px;top:30px;font-weight:700;font-style:italic;white-space:nowrap ng-style=" { \'color\': ctrl.logoOverlayColor }"> </span> </div> <div class=nav-bar-collapse> <ul class="nav navbar-nav navbar-left"> <li ui-sref-active=active ng-repeat="item in ctrl.navItemsForRole" id="{{ item.id }}"> <a ui-sref="{{ item.uiSref }}"> <waltz-icon name="{{ item.icon }}"></waltz-icon> <span ng-bind=item.displayName> </span> </a> </li> </ul> <waltz-navbar-profile logo-overlay-text=ctrl.logoOverlayText> </waltz-navbar-profile> <waltz-navbar-recently-viewed> </waltz-navbar-recently-viewed> <waltz-navbar-search> </waltz-navbar-search> </div> </nav> '},1205:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=o(n(1)),a=o(n(1206));function o(e){return e&&e.__esModule?e:{default:e}}var r={history:[]};function l(e){var t=i.default.defaultsDeep(this,r);t.refreshHistory=function(){return t.history=e.get("history_2")||[]}}l.$inject=["localStorageService"];var s={restrict:"E",replace:!0,scope:{},bindToController:{},controllerAs:"ctrl",controller:l,template:a.default};t.default=function(){return s}},1206:function(e,t){e.exports='<ul class="nav navbar-nav navbar-right"> <li class=dropdown uib-dropdown> <a class=clickable ng-click=ctrl.refreshHistory() uib-dropdown-toggle> <waltz-icon name=history></waltz-icon> Recent <b class=caret></b> </a> <ul class="dropdown-menu no-overflow" uib-dropdown-menu style=width:250px;margin-right:8px role=menu> <li style=margin:4px class=no-overflow ng-repeat="item in ctrl.history"> <a ui-sref="{{ ::item.state }} ({{ ::item.stateParams }})"> <waltz-icon class="text-muted small" fixed-width=true name="{{ item.kind | toIconName:\'entity\' }}"></waltz-icon> <span ng-bind=::item.name></span> </a> </li> <li class=text-muted ng-if="ctrl.history.length == 0"> <span style=margin:4px> Recently viewed items will be added as you navigate through Waltz </span> </li> </ul> </li> </ul> '},1207:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=l(n(1)),a=n(2),o=l(n(1208)),r=l(n(53));function l(e){return e&&e.__esModule?e:{default:e}}var s={logoOverlayText:"",user:null,showSysAdminMenuItem:!1,notificationCountTotal:null,notificationsCountsByKind:{}};function c(e,t,n){e.ok=function(){var n={userName:e.username,password:e.password};t.close(n)},e.username="",e.password="",e.logoOverlayText=n||"",e.cancel=function(){return t.dismiss("cancel")}}function d(e,t,n,o,l,d){var u=i.default.defaultsDeep(this,s);l.findOrDefault("web.authentication","").then(function(e){u.allowDirectLogin="waltz"===e}),d.whoami(!0).then(function(e){return u.user=e}).then(function(){return u.showSysAdminMenuItem=d.hasRole(u.user,r.default.ADMIN)||d.hasRole(u.user,r.default.USER_ADMIN)});var p=function(e){"REFRESH"===e.eventType&&(0,a.getApiReference)(e.serviceName,e.serviceFnName)===a.CORE_API.NotificationStore.findAll&&f()},f=function(){return o.loadAppData(a.CORE_API.NotificationStore.findAll,[],{cacheRefreshListener:{componentId:"waltzNavbarProfile",fn:p}}).then(function(e){var t=e.data;u.notificationCountTotal=i.default.sumBy(t,"count"),u.notificationsCountsByKind=i.default.keyBy(t,"kind")})};f().then(function(){e(function(){return o.loadAppData(a.CORE_API.NotificationStore.findAll,[],{force:!0})},3e5)});var m=function(){return t.reload()},v=function(){return alert("Invalid username/password")};u.logout=function(){return d.logout().then(m)},u.login=function(){n.open({animation:!0,templateUrl:"navbar/modal-login.html",controller:c,resolve:{logoOverlayText:function(){return u.logoOverlayText}},size:"sm"}).result.then(function(e){return d.login(e).then(m,v)},function(){return console.log("Login dismissed at: "+new Date)})}}c.$inject=["$scope","$uibModalInstance","logoOverlayText"],d.$inject=["$interval","$state","$uibModal","ServiceBroker","SettingsService","UserService"];var u={restrict:"E",replace:!0,scope:{},bindToController:{logoOverlayText:"<"},controllerAs:"ctrl",controller:d,template:o.default};t.default=function(){return u}},1208:function(e,t){e.exports='<ul class="nav navbar-nav navbar-right waltz-navbar-profile" style=padding-right:60px> <li class=dropdown uib-dropdown> <a class=clickable uib-dropdown-toggle> <span waltz-if-anonymous=true> <waltz-icon name=user></waltz-icon> Anonymous <b class=caret></b> </span> <span waltz-if-anonymous=false> <waltz-icon name=user></waltz-icon> Profile <span class="badge wnp-badge" ng-if="ctrl.notificationCountTotal > 0" ng-bind=ctrl.notificationCountTotal> </span> <b class=caret></b> </span> </a> <ul class="dropdown-menu no-overflow" uib-dropdown-menu style=width:250px;margin-right:8px role=menu> <li style=margin:4px class=no-overflow> <span waltz-if-anonymous=false> <a ui-sref="main.profile.view ({userId: ctrl.user.userName})" ng-bind=ctrl.user.userName></a> </span> <span waltz-if-anonymous=true>Anonymous</span> </li> <li style=margin:4px ng-if=ctrl.allowDirectLogin class=no-overflow> <span waltz-if-anonymous=true> <a class=clickable ng-click=ctrl.login()> <waltz-icon name=sign-in></waltz-icon> <span>Login</span> </a> </span> <span waltz-if-anonymous=false> <a class=clickable ng-click=ctrl.logout()> <waltz-icon name=sign-out></waltz-icon> Logout </a> </span> </li> <li style=margin:4px ui-sref-active=side-active class=no-overflow> <span> <a ui-sref=main.attestation.instance.user> <waltz-icon class="text-muted small" fixed-width=true name=check-square-o></waltz-icon> Attestations <span class="badge wnp-badge" ng-if="ctrl.notificationsCountsByKind[\'ATTESTATION\'].count > 0" ng-bind="ctrl.notificationsCountsByKind[\'ATTESTATION\'].count"> </span> </a> </span> </li> <li style=margin:4px ui-sref-active=side-active class=no-overflow> <span waltz-has-role=APP_EDITOR> <a ui-sref=main.app.registration> <waltz-icon class="text-muted small" fixed-width=true name=gift></waltz-icon> Register App </a> </span> </li> <li style=margin:4px ui-sref-active=side-active class=no-overflow> <span> <a ui-sref=main.source-data-ratings> <waltz-icon class="text-muted small" fixed-width=true name=map-signs></waltz-icon> Source Data Ratings </a> </span> </li> <li style=margin:4px ui-sref-active=side-active class=no-overflow> <span> <a ui-sref=main.survey.instance.user> <waltz-icon class="text-muted small" fixed-width=true name=wpforms></waltz-icon> Surveys <span class="badge wnp-badge" ng-if="ctrl.notificationsCountsByKind[\'SURVEY_INSTANCE\'].count > 0" ng-bind="ctrl.notificationsCountsByKind[\'SURVEY_INSTANCE\'].count"> </span> </a> </span> </li> <li style=margin:4px ui-sref-active=side-active class=no-overflow> <span ng-show=ctrl.showSysAdminMenuItem> <a ui-sref=main.system.list> <waltz-icon class="text-muted small" fixed-width=true name=wrench></waltz-icon> System Admin </a> </span> </li> </ul> <script type=text/ng-template id=navbar/modal-login.html> <div class="modal-header">\n                <h3 class="modal-title">\n                    Login to Waltz\n                    <small ng-bind="logoOverlayText"></small>\n                </h3>\n            </div>\n\n            <div class="modal-body">\n                <form>\n                    <label>Username</label>\n                    <input class=\'form-control input-sm\'\n                           ng-model="username"\n                           autofocus\n                           placeholder="username">\n\n                    <label>Password</label>\n                    <input class=\'form-control input-sm\'\n                           type="password"\n                           ng-model="password"\n                           placeholder="password">\n                </form>\n            </div>\n\n            <div class="modal-footer">\n                <button class="btn btn-primary"\n                        type="button"\n                        ng-click="ok()">\n                    OK\n                </button>\n                <button class="btn btn-warning"\n                        type="button"\n                        ng-click="cancel()">\n                    Cancel\n                </button>\n            </div> <\/script> </li> </ul>'},1209:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=function(e){return e&&e.__esModule?e:{default:e}}(n(6)),a=n(7),o=function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n]);return t.default=e,t}(n(239));t.default=function(){var e=i.default.module("waltz.notification",[]);return(0,a.registerStores)(e,[o]),e.name}},1210:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=d(n(6)),a=n(7),o=function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n]);return t.default=e,t}(n(240)),r=d(n(1211)),l=d(n(1213)),s=d(n(1215)),c=d(n(1217));function d(e){return e&&e.__esModule?e:{default:e}}t.default=function(){var e=i.default.module("waltz.org.units",[]);return e.config(c.default),(0,a.registerStores)(e,[o]),(0,a.registerComponents)(e,[r.default,l.default,s.default]),e.name}},1211:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=d(n(1)),a=n(152),o=n(111),r=n(24),l=n(2),s=d(n(1212)),c=n(0);function d(e){return e&&e.__esModule?e:{default:e}}var u={visibility:{childDisplayMode:"LIST"}};function p(e){var t=(0,c.initialiseData)(this,u);t.$onInit=function(){var n={entityReference:t.parentEntityRef,scope:"CHILDREN"};e.loadViewData(l.CORE_API.ApplicationStore.findBySelector,[n]).then(function(e){return t.apps=e.data}),e.loadViewData(l.CORE_API.AssetCostStore.findTotalCostForAppSelector,[n]).then(function(e){return t.totalCost=e.data}),e.loadViewData(l.CORE_API.ComplexityStore.findBySelector,[n]).then(function(e){return t.complexitySummary=(0,o.calcComplexitySummary)(e.data)}),e.loadViewData(l.CORE_API.LogicalFlowStore.calculateStats,[n]).then(function(e){return t.flowStats=e.data}),e.loadViewData(l.CORE_API.TechnologyStatisticsService.findBySelector,[n]).then(function(e){return t.enrichedServerStats=(0,a.enrichServerStats)(e.data.serverStats)}),e.loadAppData(l.CORE_API.OrgUnitStore.findAll).then(function(e){var n=(0,r.populateParents)(e.data,!0);t.orgUnit=i.default.find(n,{id:t.parentEntityRef.id}),t.parentOrgUnits=i.default.reverse((0,r.getParents)(t.orgUnit)),t.childOrgUnits=i.default.get(t,"orgUnit.children",[]),t.descendantOrgUnitTree=(0,r.switchToParentIds)([t.orgUnit])})}}p.$inject=["ServiceBroker"];var f={bindings:{parentEntityRef:"<"},template:s.default,controller:p};t.default={component:f,id:"waltzOrgUnitOverview"}},1212:function(e,t){e.exports='<div class="waltz-page-summary waltz-page-summary-attach"> <div class=row> <div class=col-sm-12> <div ng-if=$ctrl.orgUnit> <div class=row> <div class="col-sm-2 waltz-display-field-label"> Description </div> <div class="col-sm-10 text-muted"> <waltz-markdown text=$ctrl.orgUnit.description ng-if=$ctrl.orgUnit.description> </waltz-markdown> <span ng-if=!$ctrl.orgUnit.description> Description not provided </span> </div> </div> <hr> <div class=container-fluid> <div class=row> <div class=col-sm-4> <waltz-apps-by-investment-pie applications=$ctrl.apps size=70> </waltz-apps-by-investment-pie> </div> <div class=col-sm-4> <waltz-apps-by-lifecycle-phase-pie applications=$ctrl.apps size=70> </waltz-apps-by-lifecycle-phase-pie> </div> <div class=col-sm-4> <waltz-basic-info-tile waltz-jump-to=logical-flows-section icon=random name="Logical Data Flows"> <waltz-flow-cloud-diagram width=230 height=180 stats=$ctrl.flowStats> </waltz-flow-cloud-diagram> </waltz-basic-info-tile> </div> </div> <div class=row> <div class=col-sm-4> <waltz-basic-info-tile name="Portfolio Cost" description="Cumulative value of infra and app dev costs" waltz-jump-to=costs-section icon=money> <span style=font-size:x-large> <waltz-currency-amount amount=$ctrl.totalCost.amount simplify=true> </waltz-currency-amount> </span> </waltz-basic-info-tile> </div> <div class=col-sm-4> <waltz-basic-info-tile name=Complexity description="Derived from functions, connections and servers" class=clickable waltz-jump-to=complexity-section icon=rocket> <div style=font-size:x-large> &Sigma; <span ng-bind="$ctrl.complexitySummary.cumulativeScore | toFixed:1"> </span> </div> <div class="small text-muted"> <span ng-bind="$ctrl.complexitySummary.averageScore | toFixed:2"> </span> per app </div> </waltz-basic-info-tile> </div> <div class=col-sm-4> <waltz-basic-info-tile name=Servers description="Number of servers supporting this org unit" icon=server> <div> <div style=font-size:x-large> # <span ng-bind=$ctrl.enrichedServerStats.total></span> </div> <div class="small text-muted"> <span ng-bind=$ctrl.enrichedServerStats.virtualPercentage></span>% virtual </div> </div> </waltz-basic-info-tile> </div> </div> </div> <hr> <div class=row style=padding:1em ng-if=$ctrl.orgUnit> <div class=col-md-4> <strong>Parents</strong> <waltz-entity-link-list list=$ctrl.parentOrgUnits> </waltz-entity-link-list> </div> <div class=col-md-8> <div ng-if="$ctrl.childOrgUnits.length > 0"> <strong> Children </strong> <a class=clickable style=font-weight:lighter ng-if="$ctrl.visibility.childDisplayMode == \'TREE\'" ng-click="$ctrl.visibility.childDisplayMode = \'LIST\'"> (switch to list) </a> <a class=clickable style=font-weight:lighter ng-if="$ctrl.visibility.childDisplayMode == \'LIST\'" ng-click="$ctrl.visibility.childDisplayMode = \'TREE\'"> (switch to tree) </a> <div ng-if="$ctrl.visibility.childDisplayMode == \'LIST\'"> <waltz-entity-link-list list=$ctrl.childOrgUnits> </waltz-entity-link-list> </div> <div ng-if="$ctrl.visibility.childDisplayMode == \'TREE\'"> <waltz-org-unit-tree tree=$ctrl.descendantOrgUnitTree on-selection=$ctrl.nodeSelected> </waltz-org-unit-tree> </div> </div> </div> </div> </div> <waltz-no-data ng-if=!$ctrl.orgUnit> <message>No information for this organisation unit</message> </waltz-no-data> </div> </div> </div> '},1213:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=r(n(1)),a=n(0),o=r(n(1214));function r(e){return e&&e.__esModule?e:{default:e}}var l={nodeChildren:"children",equality:function(e,t){return e&&t&&e.id===t.id}};function s(){var e=this;e.expandedNodes=[],e.treeOptions=l,e.hasOwnApps=function(e){return e.appCount&&e.appCount>0},e.hasAnyApps=function(e){return e.totalAppCount&&e.totalAppCount>0},e.hasInheritedApps=function(e){return e.childAppCount&&e.childAppCount>0},e.hasOwnEndUserApps=function(e){return e.endUserAppCount&&e.endUserAppCount>0},e.hasAnyEndUserApps=function(e){return e.totalEndUserAppCount&&e.totalEndUserAppCount>0},e.hasInheritedEndUserApps=function(e){return e.childEndUserAppCount&&e.childEndUserAppCount>0},e.$onChanges=function(t){t.tree&&i.default.each(function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];if(!(0,a.isEmpty)(e))return i.default.concat(e,e[0].children)}(e.tree),function(t){return e.expandedNodes.push(t)})}}s.$inject=[];var c={bindings:{tree:"<"},template:o.default,controller:s};t.default={component:c,id:"waltzOrgUnitTree"}},1214:function(e,t){e.exports='<div> <treecontrol class=tree-light tree-model=$ctrl.tree order-by="\'-name\'" expanded-nodes=$ctrl.expandedNodes options=$ctrl.treeOptions> <span class=waltz-visibility-parent> <a ui-sref="main.org-unit.view ({id: node.id })"> <span> <span ng-if=$ctrl.hasOwnApps(node) ng-bind=node.name> </span> <i ng-bind=node.name ng-if="! $ctrl.hasOwnApps(node)"> </i> </span> <span class=waltz-visibility-child-50 title="Applications owned by this unit (direct / inherited)"> <span ng-if=$ctrl.hasAnyApps(node) class="small waltz-app-tally-count"> <span ng-if=$ctrl.hasOwnApps(node)> <span ng-bind=node.appCount></span> </span> <i ng-if=$ctrl.hasInheritedApps(node)> (<span ng-bind=node.totalAppCount></span>) </i> <span class=small> &nbsp; Apps </span> </span> </span> &nbsp; <span class=waltz-visibility-child-50 title="End User Applications owned by this unit (direct / inherited)"> <span ng-if=$ctrl.hasAnyEndUserApps(node) class="small waltz-end-user-app-tally-count"> <span ng-if=$ctrl.hasOwnEndUserApps(node) title="End user apps owned directly by this unit"> <span ng-bind=node.endUserAppCount></span> </span> <i ng-if=$ctrl.hasInheritedEndUserApps(node) title="Inherited from sub units"> (<span ng-bind=node.totalEndUserAppCount></span>) </i> <span class=small> &nbsp; End User Apps </span> </span> </span> </a> </span> </treecontrol> </div>'},1215:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=function(){return function(e,t){if(Array.isArray(e))return e;if(Symbol.iterator in Object(e))return function(e,t){var n=[],i=!0,a=!1,o=void 0;try{for(var r,l=e[Symbol.iterator]();!(i=(r=l.next()).done)&&(n.push(r.value),!t||n.length!==t);i=!0);}catch(e){a=!0,o=e}finally{try{!i&&l.return&&l.return()}finally{if(a)throw o}}return n}(e,t);throw new TypeError("Invalid attempt to destructure non-iterable instance")}}(),a=u(n(1)),o=u(n(1216)),r=n(0),l=n(2),s=n(12),c=n(112),d=n(110);function u(e){return e&&e.__esModule?e:{default:e}}var p={view:"view",edit:"edit"},f={currentlySelected:null,relationships:[],editable:!1,mode:p.view};function m(e,t,n,o){var u=(0,r.initialiseData)(this,f),m=function(){return function(e,t,n){var o=t.loadViewData(l.CORE_API.EntityRelationshipStore.findForEntity,[n,"ANY"],{force:!0}).then(function(e){return e.data}),r=t.loadViewData(l.CORE_API.OrgUnitStore.findRelatedByEntityRef,[n],{force:!0}).then(function(e){return a.default.reject(e.data,function(e){return(0,s.sameRef)(e,n,{skipChecks:!0})})});return e.all([o,r]).then(function(e){var t=i(e,2),o=t[0],r=t[1],l=a.default.keyBy(r,"id");return a.default.chain(o).map(function(e){return(0,s.sameRef)(n,e.a,{skipChecks:!0})?{counterpartRef:e.b,side:"TARGET",relationship:e}:{counterpartRef:e.a,side:"SOURCE",relationship:e}}).filter(function(e){return"ORG_UNIT"===e.counterpartRef.kind}).map(function(e){return Object.assign({},e,{counterpart:l[e.counterpartRef.id]})}).filter(function(e){return null!==e.counterpart}).uniqBy(function(e){return e.counterpart.id}).orderBy("counterpart.name").value()})}(e,n,u.parentEntityRef).then(function(e){return u.relationships=e})};u.$onInit=function(){m(),function(e,t){var n=t.kind;switch(n){case"ROADMAP":var i=(0,c.getEditRoleForEntityKind)(n);return e.whoami().then(function(t){return e.hasRole(t,i)});default:return Promise.resolve(!1)}}(o,u.parentEntityRef).then(function(e){return u.editable=e})},u.selectionFilter=function(e){return function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],t=arguments[1],n=arguments[2],i=t.id;return!a.default.some(e,function(e){return e.counterpart.id===i})&&!(0,s.sameRef)(t,n)}(u.relationships,e,u.parentEntityRef)},u.onRemove=function(e){return n.execute(l.CORE_API.EntityRelationshipStore.remove,[e]).then(function(){t.info("Relationship removed"),m()}).catch(function(e){return t.error("Failed to remove! "+e.message)})},u.onAdd=function(){if(null!==u.currentlySelected){var e=(0,d.mkRel)(u.parentEntityRef,"RELATES_TO",u.currentlySelected);return n.execute(l.CORE_API.EntityRelationshipStore.create,[e]).then(function(){t.info("Relationship created"),u.currentlySelected=null,m()}).catch(function(e){return t.error("Failed to add! "+e.message)})}},u.onSelected=function(e){return u.currentlySelected=e},u.onEdit=function(){return u.mode=p.edit},u.onCancel=function(){return u.mode=p.view}}m.$inject=["$q","Notification","ServiceBroker","UserService"];var v={controller:m,bindings:{parentEntityRef:"<"},template:o.default};t.default={id:"waltzRelatedOrgUnitSection",component:v}},1216:function(e,t){e.exports='<div> <waltz-section-actions ng-if=$ctrl.editable> <button ng-click=$ctrl.onEdit(true) class="btn btn-xs btn-primary" ng-if="$ctrl.mode === \'view\'"> Edit </button> <button ng-click=$ctrl.onCancel(true) class="btn btn-xs btn-info" ng-if="$ctrl.mode === \'edit\'"> View </button> </waltz-section-actions> <div class=row> <div class=col-md-12> <div ng-if="$ctrl.relationships.length > 0"> <table class="table table-condensed small table-hover"> <colgroup> <col width=35%> <col width=50%> <col width=15%> </colgroup> <thead> <tr> <th>Name</th> <th>Description</th> <th> <span ng-if="$ctrl.mode === \'edit\'"> Actions </span> </th> </tr> </thead> <tbody> <tr ng-repeat="rel in $ctrl.relationships" class=waltz-visibility-parent> <td> <span ng-if="$ctrl.mode === \'edit\'"> <span ng-bind=rel.counterpart.name></span> </span> <span ng-if="$ctrl.mode === \'view\'"> <a ui-sref="main.org-unit.view ({id: rel.counterpart.id})" class=clickable> <span ng-bind=rel.counterpart.name></span> </a> </span> </td> <td> <span ng-bind="rel.counterpart.description | limitTo: 50"></span> </td> <td> <span ng-if="$ctrl.mode === \'edit\'"> <a ng-click=$ctrl.onRemove(rel.relationship) class="waltz-visibility-child-30 clickable"> Remove </a> </span> </td> </tr> </tbody> </table> </div> <div ng-if="$ctrl.mode === \'edit\'"> <div class=help-block> Add related Organisation Units by searching for them here. </div> <waltz-entity-selector on-select=$ctrl.onSelected current-selection=$ctrl.currentlySelected entity-kinds="[\'ORG_UNIT\']" selection-filter=$ctrl.selectionFilter> </waltz-entity-selector> <a class="btn btn-primary" ng-click=$ctrl.onAdd()> Add </a> </div> <waltz-no-data ng-if="$ctrl.relationships.length == 0 && $ctrl.mode == \'view\'"> <message> <strong>No Organisational Units have been associated with this <span ng-bind="::$ctrl.parentEntityRef.kind | toDisplayName:\'entity\'"></span> </strong> </message> </waltz-no-data> </div> </div> </div> '},1217:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=n(1218),a=r(n(1219)),o=r(n(1221));function r(e){return e&&e.__esModule?e:{default:e}}var l={resolve:{appTallies:i.appTalliesResolver,endUserAppTallies:i.endUserAppTalliesResolver,orgUnits:i.orgUnitsResolver}},s={url:"org-units",views:{"content@":a.default}},c={url:"org-units/{id:int}",views:{"content@":o.default}};function d(e){e.state("main.org-unit",l).state("main.org-unit.list",s).state("main.org-unit.view",c)}d.$inject=["$stateProvider"],t.default=d},1218:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.orgUnitResolver=a,t.appTalliesResolver=o,t.endUserAppTalliesResolver=r,t.orgUnitsResolver=l;var i=function(e){return e&&e.__esModule?e:{default:e}}(n(1));function a(e,t){return i.default.find(e,{id:t.id})}function o(e){return e.countByOrganisationalUnit()}function r(e){return e.countByOrganisationalUnit()}function l(e){return e.findAll()}a.$inject=["orgUnits","$stateParams"],o.$inject=["ApplicationStore"],r.$inject=["EndUserAppStore"],l.$inject=["OrgUnitStore"]},1219:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=c(n(1)),a=c(n(6)),o=n(0),r=n(24),l=n(151),s=c(n(1220));function c(e){return e&&e.__esModule?e:{default:e}}var d=["name","description"];function u(e,t,n){e.findByGroup("ORG_UNIT").then(function(e){return t.diagrams=e}),t.blockProcessor=function(e){return function(t){t.block.onclick=function(){return e.go("main.org-unit.view",{id:t.value})},a.default.element(t.block).addClass("clickable")}}(n)}function p(e,t,n,a,s){var c=this;u(a,c,s),c.filteredOrgUnits=[],c.trees=function(e,t,n){var a=i.default.keyBy(e,"id"),o=function(e,t){i.default.each(e,function(e){var n=a[e.id];n&&(n[t]=e.count)})};o(t,"appCount"),o(n,"endUserAppCount");var s=(0,r.buildHierarchies)(e),c=(0,l.buildPropertySummer)("appCount","totalAppCount","childAppCount"),d=(0,l.buildPropertySummer)("endUserAppCount","totalEndUserAppCount","childEndUserAppCount");return i.default.each(s,c),i.default.each(s,d),s}(e,t,n),c.orgUnits=e,c.doSearch=function(t){!t||t.length<3?c.clearSearch():c.filteredOrgUnits=(0,o.termSearch)(e,t,d)},c.clearSearch=function(e){return c.filteredOrgUnits=[]}}p.$inject=["orgUnits","appTallies","endUserAppTallies","SvgDiagramStore","$state"],t.default={template:s.default,controller:p,controllerAs:"ctrl"}},1220:function(e,t){e.exports='<div> <waltz-page-header name="Organisational Units" icon=sitemap> <ol class=waltz-breadcrumbs> <li><a ui-sref=main>Home</a></li> <li>Organisational Units</li> </ol> </waltz-page-header> <div class=row> <div class=col-md-12> <div class="waltz-page-summary waltz-page-summary-attach"> <blockquote> The structure of the organisational hierarchy. An application is assigned to one of the organisational units and the unit inherits the characteristics of the assigned application. The organisational hierarchy allow applications statistics and capabilities to be aggregated up the tree. </blockquote> <waltz-svg-diagrams diagrams=ctrl.diagrams block-processor=ctrl.blockProcessor> </waltz-svg-diagrams> </div> </div> </div> <br> <div class=row> <div class=col-md-12> <waltz-static-panels group-key=HOME.ORG_UNIT> </waltz-static-panels> </div> </div> <waltz-section name="Organisational Units" icon=sitemap id=organisational-units-section> <waltz-section-actions> <waltz-data-extract-link name=Export extract=org-units filename=org-units.csv> </waltz-data-extract-link> &nbsp; <button class="btn btn-xs waltz-btn-transparent" ng-click="ctrl.visibility.sourceDataRatings = ! ctrl.visibility.sourceDataRatings"> <waltz-icon name=map-signs> </waltz-icon> </button> </waltz-section-actions> <waltz-source-data-overlay visible=ctrl.visibility.sourceDataRatings entities="[\'ORG_UNIT\']"> </waltz-source-data-overlay> <div class=row> <div class=col-sm-8> <waltz-org-unit-tree tree=ctrl.trees> </waltz-org-unit-tree> <br> <p class=text-muted> The tree below describes the organisational structure. Each unit in the tree may show a count of the number of applications (blue) and end user applications (green) owned by the unit. The two numbers show the direct ownership count and the indirect (inherited) count (in parentheses). </p> </div> <div class=col-sm-4> <waltz-search clear=ctrl.clearSearch search=ctrl.doSearch></waltz-search> <div ng-if="ctrl.filteredOrgUnits.length > 0"> <table class="table table-condensed table-striped small"> <colgroup> <col width=30%> <col width=70%> </colgroup> <tbody> <tr ng-repeat="node in ctrl.filteredOrgUnits"> <td> <a ui-sref="main.org-unit.view ({ id: node.id })" class=waltz-org-unit-name ng-bind=node.name> </a> </td> <td> <span class=small ng-bind=node.description> </span> </td> </tr> </tbody> </table> </div> </div> </div> </waltz-section> </div> '},1221:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=n(0),a=function(e){return e&&e.__esModule?e:{default:e}}(n(1222)),o=n(2);var r={availableSections:[],parentEntityRef:{},sections:[]},l=function(e,t){t&&e.put(t.name,"ORG_UNIT","main.org-unit.view",{id:t.id})};function s(e,t,n,a,s){var c=(0,i.initialiseData)(this,r);c.$onInit=function(){var i=e.id;c.parentEntityRef={kind:"ORG_UNIT",id:i},c.availableSections=t.findAvailableSectionsForKind("ORG_UNIT"),c.sections=t.findUserSectionsForKind("ORG_UNIT"),a.loadViewData(o.CORE_API.OrgUnitStore.getById,[i]).then(function(e){return c.orgUnit=e.data}).then(function(){return l(n,c.orgUnit)}).then(function(){return function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return e.initialiseForKey("main.org-unit.view",!0).then(function(e){return t.tour=e})}(s,c)})},c.addSection=function(e){return c.sections=t.openSection(e,"ORG_UNIT")},c.removeSection=function(e){return c.sections=t.removeSection(e,"ORG_UNIT")}}s.$inject=["$stateParams","DynamicSectionManager","HistoryStore","ServiceBroker","TourService"],t.default={template:a.default,controller:s,controllerAs:"ctrl"}},1222:function(e,t){e.exports=' <div> <waltz-page-header name="{{ ctrl.orgUnit.name }}" icon=sitemap tour=ctrl.tour small="Organisational Unit"> <ol class=waltz-breadcrumbs> <li><a ui-sref=main>Home</a></li> <li><a ui-sref=main.org-unit.list>Organisational Units</a></li> <li><span ng-bind=ctrl.orgUnit.name></span></li> </ol> </waltz-page-header> <waltz-org-unit-overview parent-entity-ref=ctrl.parentEntityRef> </waltz-org-unit-overview> <div class="waltz-page-summary waltz-page-summary-attach" ng-if=ctrl.orgUnit> <waltz-dynamic-section-navigation available-sections=ctrl.availableSections open-sections=ctrl.sections on-select=ctrl.addSection offset=650> </waltz-dynamic-section-navigation> </div> <br> <waltz-dynamic-sections-view ng-if=ctrl.orgUnit sections=ctrl.sections parent-entity-ref=ctrl.parentEntityRef on-remove=ctrl.removeSection> </waltz-dynamic-sections-view> </div> '},1223:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=o(n(6)),a=o(n(1224));function o(e){return e&&e.__esModule?e:{default:e}}t.default=function(){var e=i.default.module("waltz.orphan",[]);return e.service("OrphanStore",a.default),e.name}},1224:function(e,t,n){"use strict";function i(e,t){var n=t+"/orphan";return{findAppsWithNonExistentOrgUnits:function(){return e.get(n+"/application-non-existing-org-unit").then(function(e){return e.data})},findOrphanMeasurableRatings:function(){return e.get(n+"/measurable-rating").then(function(e){return e.data})},findOrphanAuthoritativeSourcesByApp:function(){return e.get(n+"/authoritative-source/application").then(function(e){return e.data})},findOrphanAuthoritativeSourcesByOrgUnit:function(){return e.get(n+"/authoritative-source/org-unit").then(function(e){return e.data})},findOrphanAuthoritativeSourcesByDataType:function(){return e.get(n+"/authoritative-source/data-type").then(function(e){return e.data})},findOrphanChangeInitiatives:function(){return e.get(n+"/change-initiative").then(function(e){return e.data})},findOrphanLogicalFlows:function(){return e.get(n+"/logical-flow").then(function(e){return e.data})},findOrphanPhysicalFlows:function(){return e.get(n+"/physical-flow").then(function(e){return e.data})},findOrphanAttestations:function(){return e.get(n+"/attestation").then(function(e){return e.data})}}}Object.defineProperty(t,"__esModule",{value:!0}),i.$inject=["$http","BaseApiUrl"],t.default=i},1225:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=f(n(6)),a=n(7),o=f(n(241)),r=f(n(1226)),l=f(n(1228)),s=f(n(1230)),c=f(n(1232)),d=f(n(1237)),u=f(n(1238)),p=f(n(1240));function f(e){return e&&e.__esModule?e:{default:e}}t.default=function(){var e=i.default.module("waltz.person",[]);return e.config(c.default),e.directive("waltzPersonLink",d.default).directive("waltzManagerList",u.default).directive("waltzPersonDirectsList",p.default),(0,a.registerStore)(e,o.default),(0,a.registerComponents)(e,[l.default,s.default,r.default]),e.name}},1226:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=n(111),a=function(e){return e&&e.__esModule?e:{default:e}}(n(1227)),o=n(0),r=n(2),l=n(17);var s={scope:"CHILDREN",organisationalUnit:null};function c(e){var t=(0,o.initialiseData)(this,s);t.$onInit=function(){var n=(0,l.mkSelectionOptions)(t.parentEntityRef);e.loadViewData(r.CORE_API.PersonStore.getById,[t.parentEntityRef.id]).then(function(n){return t.person=n.data,e.loadAppData(r.CORE_API.OrgUnitStore.getById,[t.person.organisationalUnitId])}).then(function(e){return t.organisationalUnit=Object.assign({},e.data,{kind:"ORG_UNIT"})}),e.loadViewData(r.CORE_API.ApplicationStore.findBySelector,[n]).then(function(e){return t.applications=e.data})},t.$onChanges=function(){if(t.parentEntityRef){var n=(0,l.mkSelectionOptions)(t.parentEntityRef);e.loadViewData(r.CORE_API.ComplexityStore.findBySelector,[n]).then(function(e){t.complexitySummary=(0,i.calcComplexitySummary)(e.data)}),e.loadViewData(r.CORE_API.AssetCostStore.findTotalCostForAppSelector,[n]).then(function(e){return t.totalCost=e.data})}}}c.$inject=["ServiceBroker"];var d={controller:c,template:a.default,bindings:{parentEntityRef:"<"}};t.default={component:d,id:"waltzPersonSummary"}},1227:function(e,t){e.exports='<div class="waltz-page-summary-attach waltz-page-summary"> <div class=waltz-display-section ng-class="{\'ws-inactive\': $ctrl.person.isRemoved}"> <div class=row> <div class="col-sm-2 waltz-display-field-label"> Title </div> <div class="col-sm-4 waltz-visibility-parent"> <span ng-bind=$ctrl.person.title></span> <span class=waltz-visibility-child-30 ng-bind="$ctrl.person.personKind | toDisplayName:\'PersonKind\'"> </span> <strong class=waltz-visibility-child-30 ng-if=$ctrl.person.isRemoved>[ Inactive ]</strong> </div> <div class="col-sm-2 waltz-display-field-label"> e-mail </div> <div class=col-sm-4> <waltz-mail-to person=$ctrl.person></waltz-mail-to> </div> </div> <div class=row> <div class="col-sm-2 waltz-display-field-label"> Tel (Office) </div> <div class=col-sm-4> <waltz-phone-link number="{{ $ctrl.person.officePhone }}"></waltz-phone-link> </div> <div class="col-sm-2 waltz-display-field-label"> Tel (Mobile) </div> <div class=col-sm-4> <waltz-phone-link number="{{ $ctrl.person.mobilePhone }}"></waltz-phone-link> </div> </div> <div class=row> <div class="col-sm-2 waltz-display-field-label"> Organisational Unit </div> <div class=col-sm-4> <waltz-entity-link entity-ref=$ctrl.organisationalUnit></waltz-entity-link> </div> <div class="col-sm-2 waltz-display-field-label"> Waltz Profile </div> <div class=col-sm-4> <a ui-sref="main.profile.view ({userId: $ctrl.person.userId})"> View </a> </div> </div> <div class=row style="border-top:2px dotted #eee;padding:6px;margin-top:16px"> <div class=col-sm-4> <waltz-apps-by-investment-pie applications=$ctrl.applications size=70> </waltz-apps-by-investment-pie> </div> <div class=col-sm-4> <waltz-basic-info-tile name="Portfolio Cost" description="Cumulative value of infra and app dev costs" waltz-jump-to=costs-section icon=money> <span style=font-size:x-large> <waltz-currency-amount amount=$ctrl.totalCost.amount simplify=true> </waltz-currency-amount> </span> </waltz-basic-info-tile> </div> <div class=col-sm-4> <waltz-basic-info-tile name=Complexity description="Derived from functions, connections and servers" class=clickable waltz-jump-to=complexity-section icon=rocket> <div style=font-size:x-large> &Sigma; <span ng-bind="$ctrl.complexitySummary.cumulativeScore | toFixed:1"> </span> </div> <div class="small text-muted"> <span ng-bind="$ctrl.complexitySummary.averageScore | toFixed:2"> </span> per app </div> </waltz-basic-info-tile> </div> </div> </div> </div> '},1228:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=c(n(1)),a=n(0),o=n(2),r=n(75),l=n(8),s=c(n(1229));function c(e){return e&&e.__esModule?e:{default:e}}var d={itApps:[],endUserApps:[],direct:[],indirect:[]};function u(e){var t=(0,a.initialiseData)(this,d);function n(n){var a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[];return e.loadAppData(o.CORE_API.InvolvementKindStore.findAll).then(function(e){return t.involvementKinds=e.data}).then(function(){return e.loadViewData(o.CORE_API.InvolvementStore.findByEmployeeId,[n.employeeId])}).then(function(e){var n=i.default.groupBy(e.data,"entityReference.kind"),o=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[],n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:[],a=i.default.keyBy(e,"id"),o=i.default.keyBy(n,"id"),r=i.default.chain(t).map("entityReference.id").uniq().value(),l=i.default.map(e,"id"),s=i.default.difference(l,r);return{direct:i.default.chain(t).groupBy("entityReference.id").map(function(e,t){var n=a[t];return n=i.default.assign(n,{roles:i.default.map(e,function(e){return o[e.kindId].name})})}).value(),indirect:i.default.map(s,function(e){return a[e]}),all:e}}(a,i.default.concat(n.APPLICATION||[],n.END_USER_APPLICATION||[]),t.involvementKinds);t.direct=o.direct,t.indirect=o.indirect})}function s(n){var a=Object.assign({},function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"CHILDREN";return(0,l.checkIsEntityRef)(e),{entityReference:e,scope:t}}(n),{desiredKind:"END_USER_APPLICATION"});return e.loadViewData(o.CORE_API.InvolvementStore.findEndUserAppsByIdSelector,[a]).then(function(e){t.endUserApps=i.default.map(e.data,function(e){return Object.assign({},e,{management:"End User",platform:e.kind,kind:"EUC",overallRating:"Z"})})})}t.$onInit=function(){var a=s(t.parentEntityRef),r=e.loadViewData(o.CORE_API.PersonStore.getById,[t.parentEntityRef.id]).then(function(n){return t.person=n.data,function(n){return e.loadViewData(o.CORE_API.InvolvementStore.findAppsForEmployeeId,[n.employeeId]).then(function(e){return t.itApps=i.default.map(e.data,function(e){return Object.assign({},e,{management:"IT"})})})}(t.person)});a.then(function(){return r}).then(function(){t.allApps=i.default.union(t.itApps,t.endUserApps),n(t.person,t.allApps)})},t.exportApps=function(){var e=i.default.chain(t.allApps).map(function(e){return[e.name,e.assetCode||"",e.kind||"",e.overallRating||"",e.riskRating||"",e.businessCriticality||"",e.lifecyclePhase||"",i.default.join(e.roles,", ")]}).value(),n=[["Application","Asset Code","Kind","Overall Rating","Risk Rating","Business Criticality","Lifecycle Phase","Roles"]].concat(e);(0,r.downloadTextFile)(n,",","apps_"+t.person.employeeId+".csv")}}u.$inject=["ServiceBroker"];var p={template:s.default,bindings:{parentEntityRef:"<"},controller:u};t.default={component:p,id:"waltzPersonAppsSection"}},1229:function(e,t){e.exports='<div> <waltz-source-data-section-addon entities="[\'APPLICATION\', \'END_USER_APPLICATION\', \'INVOLVEMENT\']"> <a class="btn btn-xs btn-primary" ng-click=$ctrl.exportApps() ng-if="$ctrl.allApps.length > 0"> <waltz-icon name=cloud-download></waltz-icon> Export </a> </waltz-source-data-section-addon> <waltz-no-data ng-if="$ctrl.allApps.length === 0"> <message> <strong>No applications</strong> for this person </message> </waltz-no-data> <div ng-if="$ctrl.allApps.length > 0"> <uib-tabset> <uib-tab heading=Summary> <waltz-app-summary apps=$ctrl.itApps end-user-apps=$ctrl.endUserApps> </waltz-app-summary> </uib-tab> <uib-tab select="showDirectTab = true" heading=Direct ng-if="$ctrl.direct.length > 0"> <div ng-if=showDirectTab> <h4> Direct Involvements </h4> <waltz-app-table applications=$ctrl.direct> </waltz-app-table> </div> </uib-tab> <uib-tab select="showOversightTab=true" heading=Oversight ng-if="$ctrl.indirect.length > 0"> <div ng-if=showOversightTab> <h4> Oversight Involvements <small>(Inferred via direct reports)</small></h4> <waltz-app-table applications=$ctrl.indirect> </waltz-app-table> </div> </uib-tab> </uib-tabset> </div> </div>'},1230:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=l(n(1231)),a=n(0),o=n(2),r=l(n(1));function l(e){return e&&e.__esModule?e:{default:e}}var s={cumulativeCount:null,kindCount:null,kindKeys:null};function c(e){var t=(0,a.initialiseData)(this,s);t.$onInit=function(){e.loadViewData(o.CORE_API.PersonStore.getById,[t.parentEntityRef.id]).then(function(e){return e.data.employeeId}).then(function(n){e.loadViewData(o.CORE_API.PersonStore.findDirects,[n]).then(function(e){return t.directs=e.data}),e.loadViewData(o.CORE_API.PersonStore.findManagers,[n]).then(function(e){return t.managers=e.data}),e.loadViewData(o.CORE_API.PersonStore.countCumulativeReportsByKind,[n]).then(function(e){t.kindKeys=r.default.keys(e.data),t.kindCounts=e.data,t.cumulativeCount=r.default.sum(r.default.values(e.data))})})}}c.$inject=["ServiceBroker"];var d={bindings:{parentEntityRef:"<"},template:i.default,controller:c};t.default={id:"waltzPersonHierarchySection",component:d}},1231:function(e,t){e.exports='<div> <div ng-if="$ctrl.managers.length > 0"> <h4>Managers</h4> <waltz-person-directs-list directs=$ctrl.managers></waltz-person-directs-list> </div> <div ng-if="$ctrl.directs.length > 0"> <h4> Directs <small uib-popover-template="\'wphs-popover.html\'" popover-trigger=mouseenter popover-append-to-body=true popover-placement=top-left popover-popup-delay=300 popover-enable=$ctrl.cumulativeCount> <span ng-bind=$ctrl.directs.length></span> : <span ng-bind=$ctrl.cumulativeCount></span> </small> </h4> <waltz-person-directs-list directs=$ctrl.directs></waltz-person-directs-list> </div> </div> <script type=text/ng-template id=wphs-popover.html> <div class="small">\n        <strong>Reportees</strong>\n        <br>\n        <br>\n        <table class="table table-condensed small">\n            <tr ng-repeat="key in $ctrl.kindKeys">\n                <td><span ng-bind="key | toDisplayName:\'PersonKind\'"></span></td>\n                <td><span ng-bind="$ctrl.kindCounts[key]"></span></td>\n            </tr>\n        </table>\n    </div> <\/script> '},1232:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=r(n(1233)),a=r(n(1235)),o=n(2);function r(e){return e&&e.__esModule?e:{default:e}}function l(e,t){return t.loadViewData(o.CORE_API.PersonStore.getByEmployeeId,[e.empId]).then(function(e){return e.data})}function s(e,t){return t.loadViewData(o.CORE_API.PersonStore.getById,[e.id]).then(function(e){return e.data})}l.$inject=["$stateParams","ServiceBroker"],s.$inject=["$stateParams","ServiceBroker"];var c={url:"person",views:{"content@":i.default}},d={url:"/:empId",views:{"content@":a.default},resolve:{person:l}},u={url:"/id/:id",views:{"content@":a.default},resolve:{person:s}};function p(e){e.state("main.person",c).state("main.person.view",d).state("main.person.id",u)}p.$inject=["$stateProvider"],t.default=p},1233:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=r(n(6)),a=n(2),o=r(n(1234));function r(e){return e&&e.__esModule?e:{default:e}}var l={person:null};function s(e,t){var n=Object.assign(this,l);n.$onInit=function(){t.loadAppData(a.CORE_API.SvgDiagramStore.findByGroup,["ORG_TREE"]).then(function(e){return n.diagrams=e.data})},n.blockProcessor=function(t){t.block.onclick=function(){return e.go("main.person.view",{empId:t.value})},i.default.element(t.block).addClass("clickable")},n.goToPerson=function(t){e.go("main.person.id",{id:t.id})}}s.$inject=["$state","ServiceBroker"];var c={template:o.default,controllerAs:"ctrl",controller:s};t.default=c},1234:function(e,t){e.exports='<div> <waltz-page-header name=People small=search icon=users> <ol class=waltz-breadcrumbs> <li><a ui-sref=main>Home</a></li> <li>People</li> </ol> </waltz-page-header> <div class=row> <div class=col-md-12> <div class="waltz-page-summary waltz-page-summary-attach"> <waltz-svg-diagrams diagrams=ctrl.diagrams block-processor=ctrl.blockProcessor> </waltz-svg-diagrams> <waltz-static-panels render-mode=chromeless group-key=HOME.PERSON> </waltz-static-panels> </div> </div> </div> <br> <waltz-section name=Search icon=search> <div class=row> <div class=col-md-8> <label>Search by name, role etc</label> <waltz-entity-selector on-select=ctrl.goToPerson entity-kinds="[\'PERSON\']"> </waltz-entity-selector> </div> </div> </waltz-section> </div> '},1235:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=n(0),a=n(12),o=function(e){return e&&e.__esModule?e:{default:e}}(n(1236));var r={availableSections:[],sections:[]};function l(e,t,n){var o=(0,i.initialiseData)(this,r);o.$onInit=function(){e&&(o.person=e,o.entityRef=(0,a.toEntityRef)(e,"PERSON"),o.availableSections=t.findAvailableSectionsForKind("PERSON"),o.sections=t.findUserSectionsForKind("PERSON"),n.put(e.displayName,"PERSON","main.person.view",{empId:e.employeeId}))},o.addSection=function(e){return o.sections=t.openSection(e,"PERSON")},o.removeSection=function(e){return o.sections=t.removeSection(e,"PERSON")}}l.$inject=["person","DynamicSectionManager","HistoryStore"],t.default={template:o.default,controller:l,controllerAs:"ctrl"}},1236:function(e,t){e.exports='<div> <waltz-page-header icon=user tour=ctrl.tour name="{{ ctrl.person.displayName }}"> <ol class=waltz-breadcrumbs> <li><a ui-sref=main>Home</a></li> <li><a ui-sref=main.person>People</a></li> <li><span ng-bind=ctrl.person.displayName></span></li> </ol> </waltz-page-header> <waltz-person-summary parent-entity-ref=ctrl.entityRef ng-if=ctrl.entityRef> </waltz-person-summary> <div class="waltz-page-summary waltz-page-summary-attach"> <waltz-dynamic-section-navigation available-sections=ctrl.availableSections open-sections=ctrl.sections on-select=ctrl.addSection ng-if=ctrl.entityRef> </waltz-dynamic-section-navigation> <waltz-no-data ng-if=!ctrl.entityRef> <message>No information for this person</message> </waltz-no-data> </div> <br> <waltz-dynamic-sections-view sections=ctrl.sections parent-entity-ref=ctrl.entityRef on-remove=ctrl.removeSection ng-if=ctrl.entityRef> </waltz-dynamic-sections-view> </div>'},1237:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(){return{replace:!0,restrict:"E",scope:{person:"="},template:'<a ui-sref="main.person.view ({empId: person.employeeId})"> {{person.displayName}} </a>'}}},1238:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=function(e){return e&&e.__esModule?e:{default:e}}(n(1239));t.default=function(){return{replace:!0,restrict:"E",scope:{},bindToController:{managers:"="},controllerAs:"ctrl",controller:function(){},template:i.default}}},1239:function(e,t){e.exports='<ul style=display:inline-block class=list-inline> <li ng-repeat="manager in ctrl.managers"> <waltz-person-link person=manager> </waltz-person-link> <span ng-if="! $last"> &raquo; </span> </li> </ul>'},1240:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=function(e){return e&&e.__esModule?e:{default:e}}(n(1241));t.default=function(){return{replace:!0,restrict:"E",scope:{},bindToController:{directs:"="},controllerAs:"ctrl",controller:function(){},template:i.default}}},1241:function(e,t){e.exports='<div> <table class="table table-condensed table-hover"> <colgroup> <col width=20%> <col width=20%> <col width=20%> <col width=20%> <col width=20%> </colgroup> <tr ng-repeat="direct in ctrl.directs track by direct.id" class=waltz-visibility-parent> <td> <waltz-person-link person=direct></waltz-person-link> </td> <td> <span class=waltz-visibility-child-30 ng-bind="direct.personKind | toDisplayName:\'PersonKind\'"> </span> </td> <td> <span ng-bind=direct.title></span> </td> <td> <waltz-mail-to person=direct></waltz-mail-to> </td> <td> <waltz-phone-link number="{{ direct.officePhone }}"></waltz-phone-link> </td> </tr> </table> </div> '},1242:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=b(n(6)),a=n(7),o=b(n(1243)),r=b(n(1245)),l=b(n(1247)),s=function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n]);return t.default=e,t}(n(242)),c=b(n(1249)),d=b(n(1251)),u=b(n(1253)),p=b(n(1256)),f=b(n(1258)),m=b(n(1260)),v=b(n(1262)),g=b(n(1265)),y=b(n(1270)),h=b(n(1272)),w=b(n(1274));function b(e){return e&&e.__esModule?e:{default:e}}t.default=function(){var e=i.default.module("waltz.physical.flows",[]);return e.config(g.default),(0,a.registerStore)(e,s),e.component("waltzPhysicalFlowTable",y.default).component("waltzPhysicalFlowExportButtons",h.default),(0,a.registerComponents)(e,[o.default,r.default,l.default,d.default,c.default,u.default,p.default,f.default,m.default,v.default,w.default]),e.name}},1243:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=s(n(1)),a=n(6),o=n(2),r=n(0),l=s(n(1244));function s(e){return e&&e.__esModule?e:{default:e}}var c="physical-flow-upload-mapping",d={currentStep:1,columnMappings:null,loadedMappings:null,mappingsComplete:!1,sourceData:[],sourceColumns:[],targetColumns:[{key:"name",name:"Name",required:!0,description:"A description name for the flow, could be the file that is transferred"},{key:"source",name:"Source",required:!0,description:"The source of the flow"},{key:"target",name:"Target",required:!0,description:"The target of the flow"},{key:"format",name:"Format",required:!0,description:"The file format"},{key:"frequency",name:"Frequency",required:!0,description:"Frequency of the sent flow, i.e. Daily, Weekly, Monthly etc."},{key:"transport",name:"Transport",required:!0,description:"The transport type of the flow"},{key:"criticality",name:"Criticality",required:!0,description:"The flow's criticality"},{key:"basisOffset",name:"Basis Offset",required:!0,description:"How current is the data transmitted in the flow i.e. T+1 means that the data in the flow is delayed by one day"},{key:"dataType",name:"Data Type",required:!0,description:"The flow's data type"},{key:"externalId",name:"Physical Flow External Id",required:!1,description:"The flow's external identifier, if imported from an existing system of record (if available)"},{key:"description",name:"Physical Flow Description",required:!1,description:"A description of the flow (if available)"},{key:"specExternalId",name:"Specification External Id",required:!1,description:"The Physical Specification's external identifier, if imported from an existing system of record (if available)"},{key:"specDescription",name:"Specification Description",required:!1,description:"A description of the Physical Specification (if available)"}],uploadCmds:[]};function u(e){var t=(0,r.initialiseData)(this,d);t.backVisible=function(){return t.currentStep>1&&t.currentStep<4},t.back=function(){t.currentStep--,3===t.currentStep&&t.parseFlows()},t.nextVisible=function(){return t.currentStep<4},t.canGoNext=function(){switch(t.currentStep){case 1:return t.sourceData.length>0&&t.sourceColumns.length>0;case 2:return!i.default.isEmpty(t.columnMappings)&&t.mappingsComplete;case 3:return t.uploadCmds.length>0;default:throw"Unrecognised step number: "+t.currentStep}},t.next=function(){t.currentStep++,3===t.currentStep&&(!function(e,t,n,i){var r=(0,a.toJson)({sourceColumns:t,targetColumns:n});e.loadViewData(o.CORE_API.SharedPreferenceStore.generateKeyRoute,[r],{force:!0}).then(function(t){return e.execute(o.CORE_API.SharedPreferenceStore.save,[t.data,c,(0,a.toJson)(i)]).then(function(e){return e.data})})}(e,t.sourceColumns,t.targetColumns,t.columnMappings),t.parseFlows()),4===t.currentStep&&t.uploadFlows()},t.spreadsheetLoaded=function(n){t.sourceData=n.rowData,t.sourceColumns=i.default.map(n.columnDefs,"name"),function(e,t,n){var i=(0,a.toJson)({sourceColumns:t,targetColumns:n});return e.loadViewData(o.CORE_API.SharedPreferenceStore.generateKeyRoute,[i],{force:!0}).then(function(t){return e.execute(o.CORE_API.SharedPreferenceStore.getByKeyAndCategory,[t.data,c]).then(function(e){return e.data}).then(function(e){return e?JSON.parse(e.value):void 0})})}(e,t.sourceColumns,t.targetColumns).then(function(e){t.loadedMappings=e})},t.onMappingsChanged=function(e){t.columnMappings=e.mappings,t.mappingsComplete=e.isComplete()},t.parserInitialised=function(e){t.parseFlows=e.parseFlows},t.parseComplete=function(e){e.isComplete()&&(t.uploadCmds=i.default.chain(e.data).filter(function(e){return"SUCCESS"===e.outcome&&null===e.entityReference}).map("originalCommand").value())},t.uploaderInitialised=function(e){t.uploadFlows=e.uploadFlows},t.uploadComplete=function(){}}u.$inject=["ServiceBroker"];var p={template:l.default,bindings:{},controller:u};t.default={component:p,id:"waltzBulkPhysicalFlowLoaderWizard"}},1244:function(e,t){e.exports='<div class=waltz-bulk-physical-flow-loader-wizard> <h4>Bulk Insert Physical Flows</h4> <div ng-show="$ctrl.currentStep === 1"> <waltz-static-panels group-key=BULK-UPLOAD.PHYSICAL-FLOW render-mode=chromeless> </waltz-static-panels> <waltz-spreadsheet-loader on-spreadsheet-loaded=$ctrl.spreadsheetLoaded> </waltz-spreadsheet-loader> </div> <div ng-show="$ctrl.currentStep === 2"> <waltz-column-mapper source-columns=$ctrl.sourceColumns target-columns=$ctrl.targetColumns existing-mappings=$ctrl.loadedMappings on-change=$ctrl.onMappingsChanged> </waltz-column-mapper> </div> <div ng-show="$ctrl.currentStep === 3"> <waltz-bulk-physical-flow-parser column-mappings=$ctrl.columnMappings source-data=$ctrl.sourceData on-initialise=$ctrl.parserInitialised on-parse-complete=$ctrl.parseComplete> </waltz-bulk-physical-flow-parser> </div> <div ng-show="$ctrl.currentStep === 4"> <waltz-bulk-physical-flow-uploader flow-commands=$ctrl.uploadCmds on-initialise=$ctrl.uploaderInitialised on-upload-complete=$ctrl.uploadComplete> </waltz-bulk-physical-flow-uploader> </div> <div class=text-right> <br> <hr/> <a class=clickable ng-click=$ctrl.back() ng-if=$ctrl.backVisible()> Back </a> <button class="btn btn-xs btn-success" ng-click=$ctrl.next() ng-if=$ctrl.nextVisible() ng-disabled=!$ctrl.canGoNext()> Next </button> </div> </div>'},1245:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=d(n(1)),a=n(2),o=n(0),r=n(12),l=n(0),s=n(75),c=d(n(1246));function d(e){return e&&e.__esModule?e:{default:e}}var u={columnDefs:[],columnMappings:{},errorMessage:null,filterCriteria:null,filteredData:[],loading:!1,parsedData:[],sourceData:[],summary:{},onInitialise:function(e){return console.log("default onInitialise handler for bulk-physical-flow-parser: ",e)},onParseComplete:function(e){return console.log("default onParseComplete handler for bulk-physical-flow-parser: ",e)}};function p(e,t){return{field:"parsedFlow."+t+".name",displayName:e,cellTemplate:'\n            <div class="ui-grid-cell-contents">\n                <waltz-entity-link ng-if="row.entity.parsedFlow.'+t+'"\n                                   entity-ref="row.entity.parsedFlow.'+t+'"\n                                   target="_blank">\n                </waltz-entity-link>\n                <span ng-if="row.entity.errors.'+t+'"\n                      class="text-danger bg-danger">\n                    <strong ng-bind="row.entity.errors.'+t+'"></strong>\n                </span>\n            </div>'}}function f(e,t){return{field:"parsedFlow."+t,displayName:e,cellTemplate:'\n            <div class="ui-grid-cell-contents">\n                <span ng-if="row.entity.parsedFlow.'+t+'"\n                      ng-bind="row.entity.parsedFlow.'+t+'">\n                </span>\n                <span ng-if="row.entity.errors.'+t+'"\n                      class="text-danger bg-danger">\n                    <strong ng-bind="row.entity.errors.'+t+'"></strong>\n                </span>\n            </div>'}}function m(e){switch(e){case"ERROR":return function(e){return"FAILURE"===e.outcome};case"NEW":return function(e){return"SUCCESS"===e.outcome&&null===e.entityReference};case"EXISTING":return function(e){return"SUCCESS"===e.outcome&&null!==e.entityReference};default:return function(e){return!0}}}function v(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];return i.default.sumBy(e,function(e){return i.default.chain(e.errors).keys().filter(function(e){return"owner"!==e}).value().length})}function g(e,t){var n=(0,o.initialiseData)(this,u);n.columnDefs=[p("Source","source"),p("Target","target"),Object.assign({},f("Name","name"),{width:"30%"}),f("Format","format"),f("Frequency","frequency"),f("Basis Offset","basisOffset"),f("Transport","transport"),f("Criticality","criticality"),p("Data Type","dataType"),f("External ID","externalId"),{field:"entityReference",displayName:"",width:"5%",cellTemplate:'\n                <div class="ui-grid-cell-contents" \n                     ng-if="!row.entity.hasParseErrors">\n                    <span ng-if="COL_FIELD === null"\n                          class="label label-success">New</span>\n                    <a ng-if="COL_FIELD"\n                       target="_blank"\n                       ui-sref="main.physical-flow.view ({ id:COL_FIELD.id })"\n                       class="label label-warning">Exists</a>\n                </div>'}];var c=function(){return 0===v(n.parsedData)},d=function(e){return n.filterCriteria=e,i.default.filter(n.parsedData,m(e))},g=function(){if(n.columnMappings&&n.sourceData){var e=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[],n=i.default.keys(e);return i.default.map(t,function(t){var a={};return i.default.forEach(n,function(n){var i=e[n];a[n]=t[i]}),a.owner=a.owner||a.source,a.description=a.description||"",a})}(n.columnMappings,n.sourceData);return t.execute(a.CORE_API.PhysicalFlowStore.validateUpload,[e]).then(function(e){return e.data})}},y=function(){return n.loading=!0,n.errorMessage=null,n.parsedData=[],n.summary={},g().then(function(e){n.loading=!1;var t=i.default.some(e,function(e){return"FAILURE"===e.outcome});n.parsedData=i.default.map(e,function(e){return Object.assign({},e,{hasParseErrors:t})}),n.filteredData=d(),n.summary=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],t=Object.assign({total:e.length,newFlows:0,existingFlows:0,missingEntities:v(e),circularFlows:0,nonCircularFlows:e.length},i.default.countBy(e,function(e){return"SUCCESS"===e.outcome&&null===e.entityReference?"newFlows":"existingFlows"}),i.default.countBy(e,function(e){return e.parsedFlow.source&&e.parsedFlow.target&&(0,r.sameRef)(e.parsedFlow.source,e.parsedFlow.target)?"circularFlows":"nonCircularFlows"}));return t.errors=t.missingEntities+t.circularFlows,t}(n.parsedData);var a={data:n.parsedData,isComplete:c};(0,l.invokeFunction)(n.onParseComplete,a)}).catch(function(e){n.loading=!1,n.errorMessage=e.data.message,console.error("error resolving flows: ",e,n.errorMessage)})};n.$onInit=function(){var e={parseFlows:y};(0,l.invokeFunction)(n.onInitialise,e)},n.$onChanges=function(e){},n.applyFilter=function(e){n.filteredData=d(e)},n.exportParseErrors=function(){var e=function(e,t,n){return i.default.get(e.parsedFlow,t)||i.default.get(e.errors,n||t)},t=i.default.chain(n.filteredData).filter(m("ERROR")).map(function(t){return[e(t,"source.name","source"),e(t,"target.name","target"),e(t,"name"),e(t,"format"),e(t,"frequency"),e(t,"basisOffset"),e(t,"transport"),e(t,"criticality"),e(t,"externalId")]}).value(),a=[["Source","Target","Name","Format","Frequency","Basis Offset","Transport","Criticality","External ID"]].concat(t);(0,s.downloadTextFile)(a,",","physical_flow_errors.csv")}}g.$inject=["$scope","ServiceBroker"];var y={template:c.default,bindings:{columnMappings:"<",sourceData:"<",onInitialise:"<",onParseComplete:"<"},controller:g};t.default={component:y,id:"waltzBulkPhysicalFlowParser"}},1246:function(e,t){e.exports='<div class=waltz-bulk-logical-flow-parser> <div class=text-center> <waltz-loading-notification show=$ctrl.loading name=Loading> </waltz-loading-notification> </div> <div ng-if=$ctrl.errorMessage> <div> <p>Could not parse input data</p> <p> <span class=text-danger ng-bind=$ctrl.errorMessage> </span> </p> <p>Please go back and check input data and mappings.</p> </div> </div> <div ng-if="$ctrl.parsedData.length > 0"> <div> <h4>Summary</h4> <div ng-if=!$ctrl.summary.errors class=text-success> <p> <span ng-bind=$ctrl.summary.total></span> physical flows parsed, <span ng-bind=$ctrl.summary.newFlows></span> physical flows are <a class="clickable wbas-inline-link" ng-click="$ctrl.applyFilter(\'NEW\')">new</a> and <span ng-bind=$ctrl.summary.existingFlows></span> already <a class="clickable wbas-inline-link" ng-click="$ctrl.applyFilter(\'EXISTING\')">exist</a>. <a class=clickable ng-if=$ctrl.filterCriteria ng-click=$ctrl.applyFilter(null)> show all </a> </p> <p> Ready to save these flows? Click next upload these flows. </p> </div> <div ng-if="$ctrl.summary.errors > 0" class=text-danger> <span ng-bind=$ctrl.summary.errors></span> <a class="clickable wbas-inline-link" ng-click="$ctrl.applyFilter(\'ERROR\')"> error<span ng-if="$ctrl.summary.errors > 1">s</span> </a> found in the imported data. Please review below and correct and re-upload file. <a class=clickable ng-if=$ctrl.filterCriteria ng-click=$ctrl.applyFilter(null)> show all </a> <div class=pull-right> <a class=clickable ng-click=$ctrl.exportParseErrors()> <waltz-icon name=cloud-download></waltz-icon> Export errors </a> </div> </div> </div> <br> <waltz-grid-with-search ng-if="$ctrl.filteredData.length > 0" scope-provider=$ctrl column-defs=$ctrl.columnDefs entries=$ctrl.filteredData searchplaceholdertext=Search on-initialise=$ctrl.onGridInitialise> </waltz-grid-with-search> </div> </div>'},1247:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=s(n(1)),a=n(2),o=n(0),r=n(0),l=s(n(1248));function s(e){return e&&e.__esModule?e:{default:e}}var c={columnDefs:[],loading:!1,uploadedFlows:[],onInitialise:function(e){return console.log("default onInitialise handler for bulk-physical-flow-uploader: ",e)},onUploadComplete:function(){return console.log("default onUploadComplete handler for bulk-physical-flow-uploader")}};function d(e,t){return{field:"parsedFlow."+t+".name",displayName:e,cellTemplate:'\n            <div class="ui-grid-cell-contents">\n                <waltz-entity-link ng-if="row.entity.parsedFlow.'+t+'"\n                                   entity-ref="row.entity.parsedFlow.'+t+'"\n                                   target="_blank">\n                </waltz-entity-link>\n                <span ng-if="row.entity.errors.'+t+'"\n                      class="text-danger bg-danger">\n                    <strong ng-bind="row.entity.errors.'+t+'"></strong>\n                </span>\n            </div>'}}function u(e,t){return{field:"parsedFlow."+t,displayName:e,cellTemplate:'\n            <div class="ui-grid-cell-contents">\n                <span ng-if="row.entity.parsedFlow.'+t+'"\n                      ng-bind="row.entity.parsedFlow.'+t+'">\n                </span>\n                <span ng-if="row.entity.errors.'+t+'"\n                      class="text-danger bg-danger">\n                    <strong ng-bind="row.entity.errors.'+t+'"></strong>\n                </span>\n            </div>'}}function p(e){var t=(0,o.initialiseData)(this,c),n=function(){t.flowCommands&&!i.default.isEmpty(t.flowCommands)&&(t.loading=!0,e.execute(a.CORE_API.PhysicalFlowStore.upload,[t.flowCommands]).then(function(e){t.loading=!1,t.uploadedFlows=e.data}).then(function(){return(0,r.invokeFunction)(t.onUploadComplete,t.uploadedFlows)}))};t.$onInit=function(){t.columnDefs=[{field:"parsedFlow.name",displayName:"Name",width:"25%",cellTemplate:'\n                <div class="ui-grid-cell-contents">\n                    <a ng-if="row.entity.entityReference.id"\n                       ng-bind="row.entity.parsedFlow.name"\n                       ui-sref="main.physical-flow.view ({ id: row.entity.entityReference.id })"\n                       target="_blank"></a>\n                </div>'},d("Source","source"),d("Target","target"),u("Format","format"),u("Frequency","frequency"),u("Basis Offset","basisOffset"),u("Transport","transport"),u("Criticality","criticality"),d("Data Type","dataType"),u("External ID","externalId")];var e={uploadFlows:n};(0,r.invokeFunction)(t.onInitialise,e)}}p.$inject=["ServiceBroker"];var f={template:l.default,bindings:{flowCommands:"<",onInitialise:"<",onUploadComplete:"<"},controller:p};t.default={component:f,id:"waltzBulkPhysicalFlowUploader"}},1248:function(e,t){e.exports='<div class=waltz-bulk-physical-flow-uploader> <div class=text-center> <waltz-loading-notification show=$ctrl.loading name=Loading> </waltz-loading-notification> </div> <div ng-if="!$ctrl.loading && $ctrl.uploadedFlows.length > 0"> <h4>Upload Summary</h4> <div> <span ng-bind=$ctrl.uploadedFlows.length></span> Physical Data Flows were successfully uploaded into Waltz. </div> <br> <waltz-grid-with-search ng-if="$ctrl.uploadedFlows.length > 0" scope-provider=$ctrl column-defs=$ctrl.columnDefs entries=$ctrl.uploadedFlows searchplaceholdertext=Search on-initialise=$ctrl.onGridInitialise> </waltz-grid-with-search> </div> </div>'},1249:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=function(e){return e&&e.__esModule?e:{default:e}}(n(1250)),a=n(0),o=n(2),r=n(12);var l={};function s(e,t){var n=(0,a.initialiseData)(this,l),i=function(){t.loadViewData(o.CORE_API.PhysicalFlowStore.getById,[n.parentEntityRef.id],{force:!0}).then(function(e){return n.physicalFlow=e.data})};n.$onInit=function(){return i()};var s=function(a,l){var s=function(e,t){return{entityReference:(0,r.toEntityRef)(n.physicalFlow,"PHYSICAL_FLOW"),name:e,value:t}}(a,l);return t.execute(o.CORE_API.PhysicalFlowStore.updateAttribute,[n.physicalFlow.id,s]).then(function(t){return e.success("Updated"),i()}).catch(function(t){return e.error("Could not update value")})};n.onSaveCriticality=function(e,t){return s("criticality",e)},n.onSaveFrequency=function(e,t){return s("frequency",e)},n.onSaveTransport=function(e,t){return s("transport",e)},n.onSaveBasisOffset=function(e,t){return s("basisOffset",t.newVal)},n.onSaveDescription=function(e,t){return s("description",t.newVal)}}s.$inject=["Notification","ServiceBroker"];var c={template:i.default,controller:s,bindings:{parentEntityRef:"<"}};t.default={component:c,id:"waltzPhysicalFlowEditor"}},1250:function(e,t){e.exports="<div class=waltz-physical-flow-editor> <table class=waltz-field-table style=width:100%> <colgroup> <col width=30%> <col width=70%> </colgroup> <tr> <td class=wft-label> <label>Criticality</label> </td> <td> <waltz-editable-enum initial-val=$ctrl.physicalFlow.criticality enum-kind=physicalFlowCriticality on-save=$ctrl.onSaveCriticality edit-role=LOGICAL_DATA_FLOW_EDITOR> </waltz-editable-enum> </td> </tr> <tr> <td class=wft-label> <label>Transport</label> </td> <td> <waltz-editable-enum initial-val=$ctrl.physicalFlow.transport enum-kind=transportKind on-save=$ctrl.onSaveTransport edit-role=LOGICAL_DATA_FLOW_EDITOR> </waltz-editable-enum> </td> </tr> <tr> <td class=wft-label> <label>Frequency</label> </td> <td> <waltz-editable-enum initial-val=$ctrl.physicalFlow.frequency enum-kind=frequencyKind on-save=$ctrl.onSaveFrequency edit-role=LOGICAL_DATA_FLOW_EDITOR> </waltz-editable-enum> </td> </tr> <tr> <td class=wft-label> <label>Basis Offset</label> </td> <td> <waltz-editable-field on-save=$ctrl.onSaveBasisOffset field-type=text initial-val=$ctrl.physicalFlow.basisOffset> </waltz-editable-field> </td> </tr> <tr> <td class=wft-label> <label>Description</label> </td> <td> <waltz-editable-field on-save=$ctrl.onSaveDescription field-type=textarea initial-val=$ctrl.physicalFlow.description> </waltz-editable-field> </td> </tr> </table> </div>"},1251:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=function(){return function(e,t){if(Array.isArray(e))return e;if(Symbol.iterator in Object(e))return function(e,t){var n=[],i=!0,a=!1,o=void 0;try{for(var r,l=e[Symbol.iterator]();!(i=(r=l.next()).done)&&(n.push(r.value),!t||n.length!==t);i=!0);}catch(e){a=!0,o=e}finally{try{!i&&l.return&&l.return()}finally{if(a)throw o}}return n}(e,t);throw new TypeError("Invalid attempt to destructure non-iterable instance")}}(),a=d(n(1252)),o=d(n(1)),r=n(0),l=n(2),s=n(12),c=n(399);function d(e){return e&&e.__esModule?e:{default:e}}var u=2,p={inbound:[],outbound:[],visibility:{search:!1}};function f(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];return o.default.orderBy(e,["logical.target.name","specification.name"])}function m(e,t,n){var a=(0,r.initialiseData)(this,p);a.$onInit=function(){var r=n.loadViewData(l.CORE_API.LogicalFlowStore.findByEntityReference,[a.parentEntityRef]).then(function(e){return e.data}),d=n.loadViewData(l.CORE_API.PhysicalFlowStore.findByEntityReference,[a.parentEntityRef]).then(function(e){return e.data}),p=n.loadViewData(l.CORE_API.PhysicalSpecificationStore.findByEntityReference,[a.parentEntityRef]).then(function(e){return e.data});e.all([r,d,p]).then(function(e){var n=i(e,3),r=n[0],l=n[1],d=n[2],p=(0,c.combinePhysicalWithLogical)(l,r,d,t),m=o.default.partition(p,function(e){return(0,s.sameRef)(e.logical.source,a.parentEntityRef)}),v=i(m,2),g=v[0],y=v[1];a.inbound=f(y),a.outbound=f(g),a.visibility.search=a.outbound.length>u})},a.onSelect=function(e){a.onClone(e)}}m.$inject=["$q","DisplayNameService","ServiceBroker"];var v={controller:m,bindings:{parentEntityRef:"<",onDismiss:"<",onClone:"<"},template:a.default};t.default={id:"waltzPhysicalFlowCloneSelector",component:v}},1252:function(e,t){e.exports='<div class="row small" ng-if=$ctrl.visibility.search> <div class="col-sm-6 col-sm-offset-2"> <div class="input-group input-group-sm"> <span class=input-group-addon> <waltz-icon name=search></waltz-icon> </span> <input type=search class=form-control ng-model=$ctrl.qry placeholder=Search...> </div> <br> </div> </div> <table class="table table-condensed small table-hover table-striped"> <colgroup> <col width=4%> <col width=18%> <col width=18%> <col width=14%> <col width=14%> <col width=14%> <col width=18%> </colgroup> <thead> <tr> <th></th> <th>Target</th> <th>Name</th> <th>Format</th> <th>Transport</th> <th>Frequency</th> <th>Ext Id</th> </tr> </thead> <tbody> <tr ng-repeat="flow in $ctrl.outbound | filter:$ctrl.qry" ng-click=$ctrl.onSelect(flow) class=clickable> <td> <waltz-icon name=clone></waltz-icon> </td> <td> <span ng-bind=flow.logical.target.name> </span> </td> <td> <span ng-bind=flow.specification.name> </span> </td> <td> <span ng-bind=flow.specification.formatName> </span> </td> <td> <span ng-bind=flow.physical.transportName> </span> </td> <td> <span ng-bind=flow.physical.frequencyName> </span> </td> <td> <span ng-bind=flow.specification.externalId> </span> </td> </tr> </tbody> </table> <div> <div class=row> <div class="col-md-offset-8 col-md-4"> <a class=clickable ng-click=$ctrl.onDismiss()> Cancel </a> </div> </div> </div>'},1253:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=function(e){return e&&e.__esModule?e:{default:e}}(n(1254)),a=n(0),o=n(113),r=n(1255),l=n(2),s=n(12);var c={hasCriticalityMismatch:!1};function d(e){var t=(0,a.initialiseData)(this,c);t.$onInit=function(){!function(){var n=e.loadViewData(l.CORE_API.PhysicalFlowStore.getById,[t.parentEntityRef.id],{force:!0}).then(function(e){return t.physicalFlow=e.data}),i=n.then(function(n){return e.loadViewData(l.CORE_API.LogicalFlowStore.getById,[t.physicalFlow.logicalFlowId])}).then(function(e){return t.logicalFlow=e.data});n.then(function(t){return e.loadViewData(l.CORE_API.PhysicalSpecificationStore.getById,[t.specificationId])}).then(function(e){t.specification=e.data,t.specificationReference=(0,s.toEntityRef)(e.data,"PHYSICAL_SPECIFICATION")}),i.then(function(){"APPLICATION"===t.logicalFlow.source.kind&&(0,o.resolveSourceAndTarget)(e,t.logicalFlow).then(function(e){-1===(0,r.compareCriticalities)(e.source.businessCriticality,t.physicalFlow.criticality)?(t.hasCriticalityMismatch=!0,t.criticalityMismatchMessage="Criticality mismatch: this flow has a higher criticality rating than the source"):t.hasCriticalityMismatch=!1})})}()}}d.$inject=["ServiceBroker"];var u={template:i.default,controller:d,bindings:{parentEntityRef:"<"}};t.default={component:u,id:"waltzPhysicalFlowOverview"}},1254:function(e,t){e.exports='<div class=waltz-physical-flow-overview> <div class=row> <div class=col-md-12> <table> <tr> <td class="wpfo-entity-col wpfo-owning-entity"> <div> <waltz-entity-link entity-ref=$ctrl.logicalFlow.source></waltz-entity-link> </div> </td> <td class=wpfo-arrow-col> <span>&rarr;</span> </td> <td class=wpfo-specification-col> <div> <div class=wpfo-specification-title ng-bind=$ctrl.specification.name></div> <div class="small text-muted" ng-bind=$ctrl.specification.description></div> <hr> <div class="row small"> <div class=col-sm-12> <table class="waltz-field-table small"> <tr ng-class="{\n                                        \'wft-danger\' : $ctrl.hasCriticalityMismatch\n                                    }" uib-popover="{{$ctrl.criticalityMismatchMessage }}" popover-trigger=mouseenter> <td class=wft-label> <span> Criticality: </span> </td> <td> <waltz-enum-value type="\'physicalFlowCriticality\'" key=$ctrl.physicalFlow.criticality show-icon=false show-popover=false> </waltz-enum-value> <span ng-show=$ctrl.hasCriticalityMismatch> <waltz-icon name=warning></waltz-icon> </span> </td> </tr> <tr> <td class=wft-label> <span>Format:</span> </td> <td> <span ng-bind="$ctrl.specification.format | toDisplayName:\'dataFormatKind\'"></span> </td> </tr> <tr> <td class=wft-label> <span> Transport: </span> </td> <td> <span ng-bind="$ctrl.physicalFlow.transport | toDisplayName:\'transportKind\'"></span> </td> </tr> <tr> <td class=wft-label> <span>Frequency:</span> </td> <td> <span ng-bind="$ctrl.physicalFlow.frequency | toDisplayName:\'frequencyKind\'"></span> </td> </tr> <tr> <td class=wft-label> <span>Basis Offset:</span> </td> <td> <span ng-bind="$ctrl.physicalFlow.basisOffset | toBasisOffset"></span> </td> </tr> </table> <div ng-if=$ctrl.physicalFlow.description> <hr> <waltz-markdown class="small text-muted" text=$ctrl.physicalFlow.description> </waltz-markdown> </div> </div> </div> </div> </td> <td class=wpfo-arrow-col> <span>&rarr;</span> </td> <td class="wpfo-entity-col wpfo-target-entity" ng-class="{\n                    \'wpfo-entity-application\' : $ctrl.logicalFlow.target.kind == \'APPLICATION\',\n                    \'wpfo-entity-actor\' : $ctrl.logicalFlow.target.kind == \'ACTOR\'\n                }"> <div> <waltz-entity-link entity-ref=$ctrl.logicalFlow.target></waltz-entity-link> </div> </td> </tr> </table> </div> </div> <br> <div class=row> <div class=col-md-12> <waltz-entity-link entity-ref="{\n                        kind: \'LOGICAL_DATA_FLOW\',\n                        id: $ctrl.logicalFlow.id,\n                        name: \'More about this logical flow &raquo;\'}" class=pull-right> </waltz-entity-link> </div> </div> </div>'},1256:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=n(0),a=function(e){return e&&e.__esModule?e:{default:e}}(n(1257));var o={onSpecificationFocus:function(){return console.log("No onSpecificationFocus handler defined for physical-flow-edit-overview")},onFlowAttributesFocus:function(){return console.log("No onFlowAttributesFocus handler defined for physical-flow-edit-overview")},onTargetFocus:function(){return console.log("No onTargetFocus handler defined for physical-flow-edit-overview")}};function r(){(0,i.initialiseData)(this,o)}r.$inject=[];var l={template:a.default,bindings:{sourceEntity:"<",specification:"<",targetLogicalFlow:"<",flowAttributes:"<",onSpecificationFocus:"<",onFlowAttributesFocus:"<",onTargetFocus:"<",onClone:"<"},controller:r};t.default={component:l,id:"waltzPhysicalFlowEditOverview"}},1257:function(e,t){e.exports='<div class="waltz-physical-flow-overview waltz-physical-flow-edit-overview"> <table> <tr> <td class="wpfo-entity-col wpfo-owning-entity"> <div> <waltz-entity-icon-label entity-ref=$ctrl.sourceEntity></waltz-entity-icon-label> </div> </td> <td class=wpfo-arrow-col> <span>&rarr;</span> </td> <td class=wpfo-specification-col> <div> <div class="clickable wpfeo-highlight-on-hover" ng-class="{\n                            \'wpfeo-okay\': $ctrl.specification,\n                            \'wpfeo-missing\': !$ctrl.specification\n                         }" ng-click=$ctrl.onSpecificationFocus()> <div ng-if=!$ctrl.specification> <code>Specify Specification</code> </div> <div ng-if=$ctrl.specification> <div class=wpfo-specification-title ng-bind=$ctrl.specification.name> </div> <div> <label class=text-muted>Format:</label> <span ng-bind="$ctrl.specification.format | toDisplayName:\'dataFormatKind\'"></span> </div> <div class="small text-muted" ng-bind=$ctrl.specification.description> </div> </div> </div> <hr> <div class="small clickable wpfeo-highlight-on-hover" ng-class="{\n                            \'wpfeo-okay\': $ctrl.flowAttributes,\n                            \'wpfeo-missing\': !$ctrl.flowAttributes\n                         }" ng-click=$ctrl.onFlowAttributesFocus()> <div ng-if=!$ctrl.flowAttributes> <code>Specify Flow Attributes</code> </div> <div class=row ng-if=$ctrl.flowAttributes> <div class=col-sm-12> <label class=text-muted>Transport:</label> <span ng-bind="$ctrl.flowAttributes.transport | toDisplayName:\'transportKind\'"></span> <br> <label class=text-muted>Frequency:</label> <span ng-bind="$ctrl.flowAttributes.frequency | toDisplayName:\'frequencyKind\'"></span> <br> <label class=text-muted>Basis Offset:</label> <span ng-bind="$ctrl.flowAttributes.basisOffset | toBasisOffset"></span> <br> <label class=text-muted>Criticality:</label> <waltz-enum-value type="\'physicalFlowCriticality\'" key=$ctrl.flowAttributes.criticality show-icon=false> </waltz-enum-value> </div> </div> </div> </div> </td> <td class=wpfo-arrow-col> <span>&rarr;</span> </td> <td class="wpfo-entity-col wpfo-target-entity" ng-class="{\n                    \'wpfo-entity-application\' : $ctrl.targetLogicalFlow.target.kind == \'APPLICATION\',\n                    \'wpfo-entity-actor\' : $ctrl.targetLogicalFlow.target.kind == \'ACTOR\'\n                }"> <div class="clickable wpfeo-highlight-on-hover" ng-class="{\n                            \'wpfeo-okay\': $ctrl.targetLogicalFlow,\n                            \'wpfeo-missing\': !$ctrl.targetLogicalFlow\n                         }" ng-click=$ctrl.onTargetFocus()> <span ng-if=!$ctrl.targetLogicalFlow> <code>Specify Target</code> </span> <waltz-entity-icon-label entity-ref=$ctrl.targetLogicalFlow.target></waltz-entity-icon-label> </div> </td> </tr> <tr> <td colspan=2></td> <td align=center> <div> <span class=small uib-popover="Base this new flow on an existing flow" popover-trigger=mouseenter popover-append-to-body=true popover-placement=right> <a class=clickable ng-click=$ctrl.onClone()> <waltz-icon name=copy></waltz-icon> Clone and modify existing physical flow </a> </span> </div> </td> <td></td> </tr> </table> </div>'},1258:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=n(0),a=function(e){return e&&e.__esModule?e:{default:e}}(n(1259));var o={outboundLogicalFlows:[],onChange:function(e){return console.log("pfetlf::onChange",e)}};function r(){(0,i.initialiseData)(this,o)}r.$inject=["ActorStore"];var l={bindings:{outboundLogicalFlows:"<",onChange:"<"},template:a.default,controller:r};t.default={component:l,id:"waltzPhysicalFlowEditTargetLogicalFlow"}},1259:function(e,t){e.exports='<div class=waltz-physical-flow-edit-target-entity> <div class=row> <div class=col-md-12 style="border-right:1px solid #ccc"> <h4> Select from existing targets </h4> <ul class=list-unstyled style=margin-left:16px ng-if="$ctrl.outboundLogicalFlows.length > 0"> <li ng-repeat="flow in $ctrl.outboundLogicalFlows"> <a ng-click=$ctrl.onChange(flow) class=clickable> <waltz-entity-icon-label entity-ref=flow.target> </waltz-entity-icon-label> </a> </li> </ul> </div> </div> </div>'},1260:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=c(n(1)),a=n(0),o=n(12),r=n(264),l=n(29),s=c(n(1261));function c(e){return e&&e.__esModule?e:{default:e}}var d=6,u={visibility:{showAddButton:!0,search:!1},form:{name:"",description:"",externalId:"",format:""},validation:{canSubmit:!1,message:null},formatOptions:(0,l.toOptions)(r.dataFormatKind,!0)};function p(){var e=(0,a.initialiseData)(this,u);e.select=function(t){e.cancelAddNew(),e.selected=t,e.current&&e.selected.id===e.current.id&&e.cancel(),e.onChange(e.selected)},e.doAddNew=function(){e.onChange(Object.assign({},e.form,{owningEntity:(0,o.toEntityRef)(e.owningEntity),lastUpdatedBy:"ignored, server will set"}))},e.cancel=function(){return e.onDismiss()},e.showAddNewForm=function(){e.selected=null,e.visibility.showAddButton=!1,e.validateForm()},e.cancelAddNew=function(){e.visibility.showAddButton=!0},e.validateForm=function(){var t=i.default.trim(e.form.name),n=i.default.map(e.candidates,"name"),a=i.default.size(t)>0,o=!i.default.includes(n,t),r=i.default.size(e.form.format)>0,l=(a?"":"Name cannot be empty. ")+(o?"":"Name must be unique. ")+(r?"":"Format must be supplied");e.validation={canSubmit:a&&o&&r,message:l}},e.$onInit=function(){e.visibility.search=e.candidates.length>d}}p.$inject=[];var f={template:s.default,bindings:{candidates:"<",current:"<",onDismiss:"<",onChange:"<",owningEntity:"<",selected:"<"},controller:p};t.default={component:f,id:"waltzPhysicalFlowEditSpecification"}},1261:function(e,t){e.exports='<div class=waltz-physical-flow-edit-specification> <div class="row small" ng-if=$ctrl.visibility.search> <div class="col-sm-6 col-sm-offset-2"> <div class="input-group input-group-sm"> <span class=input-group-addon> <waltz-icon name=search></waltz-icon> </span> <input type=search class=form-control ng-model=$ctrl.qry placeholder=Search...> </div> <br> </div> </div> <div class=wpfes-table> <div class="row wpfes-header"> <div class=col-md-3>Name</div> <div class=col-md-2>External Id</div> <div class=col-md-2>Format</div> <div class=col-md-5>Description</div> </div> <div class="row wpfes-existing-row" ng-repeat="candidate in $ctrl.candidates | orderBy:\'name\' | filter:$ctrl.qry" ng-class="{\n                \'wpfes-current\': candidate.id == $ctrl.current.id\n             }" ng-click=$ctrl.select(candidate)> <div class=col-md-3><span ng-bind=candidate.name></span></div> <div class=col-md-2><span ng-bind=candidate.externalId></span></div> <div class=col-md-2><span ng-bind=candidate.format></span></div> <div class=col-md-5><span ng-bind=candidate.description></span></div> </div> <div class=row ng-if=$ctrl.visibility.showAddButton> <div class=col-md-3> <a ng-click=$ctrl.showAddNewForm() class=clickable> <waltz-icon name=plus></waltz-icon> Add new </a> </div> </div> <div ng-if=!$ctrl.visibility.showAddButton class=wpfes-addNewForm> <div class=row> <div class=col-md-3> <input type=text ng-model=$ctrl.form.name ng-change=$ctrl.validateForm() required=required placeholder=Name class="form-control input-sm"> </div> <div class=col-md-2> <input type=text name=externalId ng-model=$ctrl.form.externalId placeholder="External Id" class="form-control input-sm"> </div> <div class=col-md-2> <select ng-model=$ctrl.form.format ng-change=$ctrl.validateForm() name=format> <option ng-repeat="format in $ctrl.formatOptions" value={{format.code}} ng-bind=format.name> </option> </select> </div> <div class=col-md-5> <textarea rows=4 name=description ng-model=$ctrl.form.description placeholder=Description class="form-control input-sm">\n                    </textarea> </div> </div> </div> </div> <hr> <div ng-if=!$ctrl.visibility.showAddButton> <div class=row> <div class="col-md-offset-8 col-md-4"> <button type=submit class="btn btn-sm btn-primary" ng-click=$ctrl.doAddNew() ng-disabled="! $ctrl.validation.canSubmit"> <waltz-icon name=check></waltz-icon> Add and select </button> &nbsp; <a class=clickable ng-click=$ctrl.cancelAddNew()> Cancel </a> <div ng-if=$ctrl.validation.message class=wpfes-error ng-bind=$ctrl.validation.message> </div> </div> </div> </div> <div ng-if=$ctrl.visibility.showAddButton> <div class=row> <div class="col-md-offset-8 col-md-4"> <a class=clickable ng-click=$ctrl.cancel()> Cancel </a> </div> </div> </div> </div>'},1262:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=s(n(1)),a=n(0),o=n(1263),r=n(2),l=s(n(1264));function s(e){return e&&e.__esModule?e:{default:e}}var c={onDismiss:function(){return console.log("No dismiss handler for physical flow attribute editor")},onChange:function(e){return console.log("No dismiss handler for physical flow attribute editor: ",e)}};function d(e){var t=(0,a.initialiseData)(this,c),n=[{className:"row",fieldGroup:[{className:"col-sm-6",fieldGroup:[o.transportField]},{className:"col-sm-6",fieldGroup:[o.frequencyField]}]},{className:"row",fieldGroup:[{className:"col-sm-6",fieldGroup:[o.basisOffsetSelectField]},{className:"col-sm-6",fieldGroup:[o.basisOffsetInputField]}]},{className:"row",fieldGroup:[{className:"col-sm-6",fieldGroup:[o.criticalityField]}]}];t.fields=n;var l=i.default.map(o.basisOffsetSelectField.templateOptions.options,"code");t.$onInit=function(){e.loadAppData(r.CORE_API.EnumValueStore.findAll).then(function(e){var t=i.default.chain(e.data).filter({type:"physicalFlowCriticality"}).map(function(e){return{code:e.key,name:e.name}}).keyBy("code").value();o.criticalityField.templateOptions.options=[t.VERY_HIGH,t.HIGH,t.MEDIUM,t.LOW]})},t.$onChanges=function(e){if(t.current){var n=!i.default.includes(l,t.current.basisOffset);t.model={transport:t.current.transport,frequency:t.current.frequency,criticality:t.current.criticality,basisOffsetSelect:n?"OTHER":t.current.basisOffset,basisOffsetInput:n?t.current.basisOffset:void 0}}},t.onSubmit=function(){var e=t.model,n=e.frequency,i=e.transport,o=e.criticality,r=function(e,t){if(e&&"OTHER"!==e)return Number(e);if(t){var n=/^(?:T|t)?((?:\+?|-)\d+)$/g.exec(t);if(null!==n&&n[1])return Number(n[1]);throw"Could not parse basis offset: "+t}throw"No valid Basis Offset value supplied"}(t.model.basisOffsetSelect,t.model.basisOffsetInput);(0,a.invokeFunction)(t.onChange,{frequency:n,transport:i,basisOffset:r,criticality:o})},t.onCancel=function(){(0,a.invokeFunction)(t.onDismiss)}}d.$inject=["ServiceBroker"];var u={bindings:{current:"<",onDismiss:"<",onChange:"<"},template:l.default,controller:d};t.default={component:u,id:"waltzPhysicalFlowAttributeEditor"}},1263:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.criticalityField=t.basisOffsetInputField=t.basisOffsetSelectField=t.frequencyField=t.transportField=void 0;var i=n(265),a=n(268),o=n(29);t.transportField={type:"select",key:"transport",templateOptions:{valueProp:"code",labelProp:"name",options:(0,o.toOptions)(a.transportKind,!0),label:"Transport",placeholder:"",required:!0}},t.frequencyField={type:"select",key:"frequency",templateOptions:{valueProp:"code",labelProp:"name",options:(0,o.toOptions)(i.frequencyKind,!0),label:"Frequency",placeholder:"",required:!0}},t.basisOffsetSelectField={type:"select",key:"basisOffsetSelect",templateOptions:{valueProp:"code",labelProp:"name",options:[{code:"-30",name:"T-30"},{code:"-10",name:"T-10"},{code:"-7",name:"T-7"},{code:"-5",name:"T-5"},{code:"-3",name:"T-3"},{code:"-1",name:"T-1"},{code:"0",name:"T"},{code:"1",name:"T+1"},{code:"3",name:"T+3"},{code:"5",name:"T+5"},{code:"7",name:"T+7"},{code:"10",name:"T+10"},{code:"30",name:"T+30"},{code:"OTHER",name:"Other (Please specify)"}],label:"Basis Offset",placeholder:"",required:!0}},t.basisOffsetInputField={type:"input",key:"basisOffsetInput",templateOptions:{label:"Custom Offset",placeholder:"please specify basis offset in (+/-)n format",required:!0},validators:{basisOffset:{expression:function(e,t){return/^(?:T|t)?((?:\+?|-)\d+)$/.test(t||e)},message:'$viewValue + " is not a valid basis offset"'}},hideExpression:'model.basisOffsetSelect !== "OTHER"'},t.criticalityField={type:"select",key:"criticality",templateOptions:{valueProp:"code",labelProp:"name",options:[],label:"Criticality",placeholder:"",required:!0}}},1264:function(e,t){e.exports='<div class=waltz-physical-flow-attribute-editor> <form ng-submit=$ctrl.onSubmit() name=$ctrl.form novalidate> <formly-form form=$ctrl.form model=$ctrl.model fields=$ctrl.fields> <hr> <div class=row> <div class="col-md-offset-8 col-md-4"> <button type=submit class="btn btn-primary btn-sm" style=margin-left:12px ng-disabled=$ctrl.form.$invalid> Save </button> <a class=clickable ng-click=$ctrl.onCancel()> <span>Cancel</span> </a> </div> </div> </formly-form> </form> </div>'},1265:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=o(n(1266)),a=o(n(1268));function o(e){return e&&e.__esModule?e:{default:e}}var r={},l={url:"physical-flow/{id:int}",views:{"content@":i.default}},s={url:"physical-flow/registration/{kind:string}/{id:int}?{targetLogicalFlowId:int}",views:{"content@":a.default}};function c(e){e.state("main.physical-flow",r).state("main.physical-flow.registration",s).state("main.physical-flow.view",l)}c.$inject=["$stateProvider"],t.default=c},1266:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=function(){return function(e,t){if(Array.isArray(e))return e;if(Symbol.iterator in Object(e))return function(e,t){var n=[],i=!0,a=!1,o=void 0;try{for(var r,l=e[Symbol.iterator]();!(i=(r=l.next()).done)&&(n.push(r.value),!t||n.length!==t);i=!0);}catch(e){a=!0,o=e}finally{try{!i&&l.return&&l.return()}finally{if(a)throw o}}return n}(e,t);throw new TypeError("Invalid attempt to destructure non-iterable instance")}}(),a=n(0),o=d(n(1)),r=d(n(1267)),l=n(31),s=n(12),c=n(2);function d(e){return e&&e.__esModule?e:{default:e}}var u={logicalDataElements:[],physicalFlow:null,selected:{entity:null,incoming:[],outgoing:[]},specification:null,selectedSpecDefinition:{},selectableSpecDefinitions:[],tour:[],visibility:{diagramEditor:!1,overviewEditor:!1},bookmarksSection:l.dynamicSections.bookmarksSection,changeLogSection:l.dynamicSections.changeLogSection,entityNamedNotesSection:l.dynamicSections.entityNamedNotesSection,entityDiagramsSection:l.dynamicSections.entityDiagramsSection};function p(e,t){return{name:t.name,kind:"PHYSICAL_FLOW",state:"main.physical-flow.view",stateParams:{id:e.id}}}function f(e,t){var n=t.getAll()[0];n?e.go(n.state,n.stateParams):e.go("main.home")}function m(e,t,n,r,l,d,m,v,g,y,h,w){var b=(0,a.initialiseData)(this,u),S=n.id;b.entityReference={id:S,kind:"PHYSICAL_FLOW"};var I=h.loadViewData(c.CORE_API.PhysicalFlowStore.getById,[S]).then(function(e){return b.physicalFlow=e.data});I.then(function(e){return h.loadViewData(c.CORE_API.LogicalFlowStore.getById,[b.physicalFlow.logicalFlowId])}).then(function(e){return b.logicalFlow=e.data});var D=I.then(function(e){return h.loadViewData(c.CORE_API.PhysicalSpecificationStore.getById,[e.specificationId])}).then(function(e){b.specification=e.data,b.specificationReference=(0,s.toEntityRef)(e.data,"PHYSICAL_SPECIFICATION")}),A=function(){var t=arguments.length>0&&void 0!==arguments[0]&&arguments[0];return m.findForSpecificationId(b.physicalFlow.specificationId).then(function(e){b.selectedSpecDefinition.def=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;return t?o.default.keyBy(e,"id")[t]:o.default.find(e,function(e){return"ACTIVE"===e.status})}(e,b.physicalFlow.specificationDefinitionId),b.selectableSpecDefinitions=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],t=arguments[1];return t?o.default.filter(e,function(e){return e.id!==t.id}):e}(e,b.selectedSpecDefinition.def)}).then(function(){if(b.selectedSpecDefinition.def){var n=v.findForSpecDefinitionId(b.selectedSpecDefinition.def.id),a=g.findForSpecDefinitionId(b.selectedSpecDefinition.def.id),o={scope:"EXACT",entityReference:{kind:"PHYSICAL_SPECIFICATION",id:b.selectedSpecDefinition.def.specificationId}},r=h.loadViewData(c.CORE_API.LogicalDataElementStore.findBySelector,[o],{force:t}).then(function(e){return e.data});e.all([n,a,r]).then(function(e){var t=i(e,3),n=t[0],a=t[1],o=t[2];b.selectedSpecDefinition.fields=n,b.selectedSpecDefinition.sampleFile=a,b.logicalDataElements=o})}})};D.then(function(){return A()}),D.then(function(){return w.initialiseForKey("main.physical-flow.view",!0)}).then(function(e){return b.tour=e}).then(function(){return function(e,t,n){if(t&&n){var i=p(t,n);e.put(i.name,i.kind,i.state,i.stateParams)}}(r,b.physicalFlow,b.specification)});var $=function(e){if("SUCCESS"===e.outcome)if(l.success("Physical flow deleted"),function(e,t,n){if(t&&n){var i=p(t,n);e.remove(i.name,i.kind,i.state,i.stateParams)}}(r,b.physicalFlow,b.specification),e.isSpecificationUnused||e.isLastPhysicalFlow){var n="The specification "+b.specification.name+" is no longer referenced by any physical flow. Do you want to delete the specification?",i="The logical flow described by this physical flow between "+b.logicalFlow.source.name+" and "+b.logicalFlow.target.name+" has no other physical flows. Do you want to delete the logical flow?";e.isSpecificationUnused&&confirm(n)&&y.deleteById(b.specification.id).then(function(e){"SUCCESS"===e.outcome?l.success("Specification "+b.specification.name+" deleted"):l.error(e.message),f(t,r)}),e.isLastPhysicalFlow&&confirm(i)&&h.execute(c.CORE_API.LogicalFlowStore.removeFlow,[b.physicalFlow.logicalFlowId]).then(function(e){"SUCCESS"===e.outcome?l.success("Logical Flow between "+b.logicalFlow.source.name+" and "+b.logicalFlow.target.name+" deleted"):l.error(e.message),f(t,r)})}else f(t,r);else l.error(e.message)};b.deleteFlow=function(){confirm("Are you sure you want to delete this flow ?")&&d.deleteById(S).then(function(e){return $(e)})},b.updateSpecDefinitionId=function(e){confirm("Are you sure you want to change the specification definition version used by this flow ?")&&d.updateSpecDefinitionId(S,{newSpecDefinitionId:e.id}).then(function(t){b.physicalFlow.specificationDefinitionId=e.id,A(),l.success("Specification definition version updated successfully")})},b.updateFieldDescription=function(e,t){var n={newDescription:t.newVal};h.execute(c.CORE_API.PhysicalSpecDefinitionFieldStore.updateDescription,[e,n]).then(function(e){e?(l.success("Updated description for field"),A(!0)):l.error("Could not update field description")})},b.updateLogicalDataElement=function(e,t){var n={newLogicalDataElement:t.newVal};h.execute(c.CORE_API.PhysicalSpecDefinitionFieldStore.updateLogicalElement,[e,n]).then(function(e){e?(l.success("Updated logical data element for field"),A(!0)):l.error("Could not update logical data element")})}}m.$inject=["$q","$state","$stateParams","HistoryStore","Notification","PhysicalFlowStore","PhysicalSpecDefinitionStore","PhysicalSpecDefinitionFieldStore","PhysicalSpecDefinitionSampleFileStore","PhysicalSpecificationStore","ServiceBroker","TourService"],t.default={template:r.default,controller:m,controllerAs:"ctrl"}},1267:function(e,t){e.exports='<div class=container-fluid> <waltz-page-header name="{{ ctrl.specification.name }}" small="{{ ctrl.logicalFlow.source.name }} {{ ctrl.logicalFlow ? \'&rarr;\' : \'\' }} {{ ctrl.logicalFlow.target.name }}" tour=ctrl.tour icon=qrcode> <ol class=waltz-breadcrumbs> <li><a ui-sref=main>Home</a></li> <li ng-if=ctrl.logicalFlow> <waltz-entity-link entity-ref=ctrl.logicalFlow.source></waltz-entity-link> </li> <li ng-if=!ctrl.logicalFlow>physical Flow</li> <li ng-bind="ctrl.specification.name | truncateMiddle:50"></li> </ol> </waltz-page-header> <div class="waltz-page-summary waltz-page-summary-attach"> <div ng-if=ctrl.logicalFlow> <waltz-section-actions> <div waltz-has-role=LOGICAL_DATA_FLOW_EDITOR> <button class="btn btn-xs btn-danger" ng-disabled="! (ctrl.mentions | isEmpty)" ng-click="(ctrl.mentions | isEmpty) && ctrl.deleteFlow()"> Delete </button> <waltz-icon name=exclamation-circle ng-if="! (ctrl.mentions | isEmpty)" class=small uib-popover="This flow cannot be deleted as it is being used in a lineage" popover-trigger=mouseenter style=color:#777;vertical-align:text-top> </waltz-icon> </div> </waltz-section-actions> <div class=row> <div class=col-md-7> <waltz-sub-section name=Overview> <content> <div class=waltz-sub-section-content> <div ng-if="! ctrl.visibility.overviewEditor"> <waltz-physical-flow-overview parent-entity-ref=ctrl.entityReference class=waltz-highlight-if> </waltz-physical-flow-overview> </div> <div ng-if=ctrl.visibility.overviewEditor class=waltz-highlight-if> <waltz-physical-flow-editor parent-entity-ref=ctrl.entityReference> </waltz-physical-flow-editor> </div> </div> <div class=waltz-sub-section-controls waltz-has-role=LOGICAL_DATA_FLOW_EDITOR> <span> <a ng-click="ctrl.visibility.overviewEditor = true" ng-if="! ctrl.visibility.overviewEditor" class=clickable> Edit </a> <a ng-click="ctrl.visibility.overviewEditor = false" ng-if=ctrl.visibility.overviewEditor class=clickable> Done </a> </span> </div> </content> </waltz-sub-section> </div> <div class=col-md-5> <waltz-data-type-usage-panel parent-entity-ref=ctrl.specificationReference help-text="Data types referenced by the specification"> </waltz-data-type-usage-panel> </div> </div> <div class="small text-muted" ng-if="ctrl.physicalFlow.lastUpdatedBy && ctrl.physicalFlow.lastUpdatedAt"> Last updated by <span ng-bind=ctrl.physicalFlow.lastUpdatedBy></span> (<waltz-from-now timestamp=ctrl.physicalFlow.lastUpdatedAt></waltz-from-now>) </div> </div> <waltz-no-data ng-if=!ctrl.physicalFlow> <message>No information for this physical flow</message> </waltz-no-data> </div> <br> <waltz-dynamic-section-wrapper ng-if=ctrl.logicalFlow section=ctrl.entityNamedNotesSection parent-entity-ref=ctrl.entityReference> </waltz-dynamic-section-wrapper> <waltz-section name="Specification Definition" icon=file-code-o id=specification-definition-section ng-if=ctrl.logicalFlow> <waltz-section-actions> <div waltz-has-role=LOGICAL_DATA_FLOW_EDITOR> <a ui-sref="main.physical-specification.view ({id: ctrl.specification.id})" class="btn btn-xs btn-primary"> Manage </a> </div> </waltz-section-actions> <div class=row> <div class=col-sm-12> <label>Current Definition</label> <waltz-physical-spec-definition-panel spec-definition=ctrl.selectedSpecDefinition logical-data-elements=ctrl.logicalDataElements selectable-definitions=ctrl.selectableSpecDefinitions on-definition-select=ctrl.updateSpecDefinitionId on-update-field-description=ctrl.updateFieldDescription on-update-logical-data-element=ctrl.updateLogicalDataElement> <no-data-message> <strong>No <i>active</i> definition</strong> for this physical specification. </no-data-message> </waltz-physical-spec-definition-panel> </div> </div> </waltz-section> <waltz-dynamic-section-wrapper ng-if=ctrl.logicalFlow section=ctrl.entityDiagramsSection parent-entity-ref=ctrl.entityReference> </waltz-dynamic-section-wrapper> <waltz-dynamic-section-wrapper ng-if=ctrl.logicalFlow section=ctrl.bookmarksSection parent-entity-ref=ctrl.entityReference> </waltz-dynamic-section-wrapper> <waltz-dynamic-section-wrapper ng-if=ctrl.logicalFlow section=ctrl.changeLogSection parent-entity-ref=ctrl.entityReference> </waltz-dynamic-section-wrapper> </div>'},1268:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=d(n(1)),a=n(0),o=n(74),r=d(n(1269)),l=n(2),s=n(12),c=n(399);function d(e){return e&&e.__esModule?e:{default:e}}var u={cancelLink:"#/",existingSpecifications:[],flowAttributes:null,sourceEntity:null,specification:null,targetLogicalFlow:null,existingTargets:[],existingFlowsByTarget:{},similarFlows:[],validation:{messages:[],canSave:!1},visibility:{editor:"",loading:!1,similarFlows:!1}};function p(e,t,n,r,d,p){var f=(0,a.initialiseData)(this,u);p.setupWarningDialog(e,function(){return h()}),f.similarFlowDefs=[{field:"specification.name",displayName:"Name",width:"10%"},{field:"specification.format",displayName:"Format",width:"10%",cellFilter:'toDisplayName:"dataFormatKind"'},{field:"physicalFlow.transport",displayName:"Transport",width:"14%",cellFilter:'toDisplayName:"transportKind"'},{field:"physicalFlow.frequency",displayName:"Frequency",width:"10%",cellFilter:'toDisplayName:"frequencyKind"'},{field:"physicalFlow.basisOffset",displayName:"Basis",width:"10%",cellFilter:"toBasisOffset"},{field:"specification.description",displayName:"Description"}];var m={id:n.id,kind:n.kind},v=n.targetLogicalFlowId;v&&d.loadViewData(l.CORE_API.LogicalFlowStore.getById,[v]).then(function(e){return f.targetChanged(e.data)});var g=(0,o.kindToViewState)(m.kind);f.cancelLink=t.href(g,{id:m.id});var y=function(){return f.visibility.similarFlows=!1,function(e,t,n){var a=[];return a.push(e?null:"Missing specification. "),a.push(t?null:"Missing attributes. "),a.push(n?null:"Missing target. "),{canSave:e&&t&&n,messages:i.default.reject(a,function(e){return null==e})}}(f.specification,f.flowAttributes,f.targetLogicalFlow)},h=function(){return f.specification||f.flowAttributes||f.targetLogicalFlow};f.focusSpecification=function(){f.visibility.editor="SPECIFICATION"},f.focusFlowAttributes=function(){f.visibility.editor="FLOW-ATTRIBUTES"},f.focusTarget=function(){f.visibility.editor="TARGET-LOGICAL-FLOW"},f.focusClone=function(){f.visibility.editor="CLONE",f.visibility.loading=!0,console.log("focusClone",{vm:f})},f.attributesChanged=function(e){f.flowAttributes=e,f.editorDismiss()},f.targetChanged=function(e){f.targetLogicalFlow=e,f.editorDismiss()},f.specificationChanged=function(e){f.specification=e,f.editorDismiss()},f.editorDismiss=function(){f.visibility.editor="",f.validation=y()},f.onClone=function(e){f.specification=(0,c.removeEnrichments)(e.specification),f.flowAttributes=function(e){return{transport:e.transport,frequency:e.frequency,criticality:e.criticality,basisOffset:e.basisOffset}}(e.physical),f.targetLogicalFlow=e.logical,f.editorDismiss(),r.info("Flow has been cloned, please make some changes before saving.")},f.doSave=function(){var e=y();if(e.canSave){var n={specification:f.specification,flowAttributes:f.flowAttributes,logicalFlowId:f.targetLogicalFlow.id};d.execute(l.CORE_API.PhysicalFlowStore.create,[n]).then(function(e){var n=e.data;"SUCCESS"==n.outcome?r.info("Created new flow"):"FAILURE"==n.outcome&&r.warning(n.message+", redirected to existing."),n.entityReference&&(f.specification=null,f.flowAttributes=null,f.targetLogicalFlow=null,t.go("main.physical-flow.view",{id:n.entityReference.id}))})}else{var a=i.default.join(e.messages,"<br> - ");r.warning("Cannot save: <br> - "+a)}},(0,s.loadEntity)(d,m).then(function(e){return f.sourceEntity=e}),d.loadViewData(l.CORE_API.PhysicalSpecificationStore.findByEntityReference,[m]).then(function(e){return f.existingSpecifications=e.data}),d.loadViewData(l.CORE_API.LogicalFlowStore.findByEntityReference,[m]).then(function(e){return f.outboundLogicalFlows=i.default.chain(e.data).filter(function(e){return e.source.kind===m.kind&&e.source.id===m.id}).orderBy("target.name").value()})}p.$inject=["$scope","$state","$stateParams","Notification","ServiceBroker","PreventNavigationService"],t.default={template:r.default,controller:p,controllerAs:"ctrl"}},1269:function(e,t){e.exports='<div> <waltz-page-header name="Register new Physical Flow" small="From: {{ ctrl.sourceEntity.name }}" icon=dot-circle-o> <ol class=waltz-breadcrumbs> <li><a ui-sref=main>Home</a></li> <li> <waltz-entity-link entity-ref=ctrl.sourceEntity></waltz-entity-link> </li> <li>Register Physical Flow</li> </ol> </waltz-page-header> <div class="waltz-page-summary waltz-page-summary-attach"> <div> <waltz-physical-flow-edit-overview source-entity=ctrl.sourceEntity specification=ctrl.specification target-logical-flow=ctrl.targetLogicalFlow flow-attributes=ctrl.flowAttributes on-specification-focus=ctrl.focusSpecification on-flow-attributes-focus=ctrl.focusFlowAttributes on-target-focus=ctrl.focusTarget on-clone=ctrl.focusClone> </waltz-physical-flow-edit-overview> </div> <hr> <waltz-physical-flow-attribute-editor ng-if="ctrl.visibility.editor === \'FLOW-ATTRIBUTES\'" current=ctrl.flowAttributes on-change=ctrl.attributesChanged on-dismiss=ctrl.editorDismiss> </waltz-physical-flow-attribute-editor> <waltz-physical-flow-edit-target-logical-flow ng-if="ctrl.visibility.editor === \'TARGET-LOGICAL-FLOW\'" outbound-logical-flows=ctrl.outboundLogicalFlows on-change=ctrl.targetChanged> </waltz-physical-flow-edit-target-logical-flow> <waltz-physical-flow-edit-specification ng-if="ctrl.visibility.editor === \'SPECIFICATION\'" owning-entity=ctrl.sourceEntity candidates=ctrl.existingSpecifications current=ctrl.specification on-dismiss=ctrl.editorDismiss on-change=ctrl.specificationChanged> </waltz-physical-flow-edit-specification> <waltz-physical-flow-clone-selector ng-if="ctrl.visibility.editor === \'CLONE\'" on-clone=ctrl.onClone on-dismiss=ctrl.editorDismiss parent-entity-ref=ctrl.sourceEntity> </waltz-physical-flow-clone-selector> <div ng-if="ctrl.visibility.editor == \'\' && ctrl.similarFlows.length === 0"> <div class=row> <div class="col-md-offset-6 col-md-2"> <button class="btn btn-success" ng-click=ctrl.doSave() ng-disabled=!ctrl.validation.canSave> <waltz-icon name=check></waltz-icon> Save </button> &nbsp; <a ng-href="{{ ctrl.cancelLink }}" class=clickable> Cancel </a> </div> <div class=col-md-2> <ul class="list-unstyled small text-muted"> <li ng-repeat="message in ctrl.validation.messages"> <span ng-bind=message class=error></span> </li> </ul> </div> </div> </div> <div ng-if="ctrl.visibility.editor == \'\' && ctrl.similarFlows.length > 0"> <div class=row ng-hide=ctrl.visibility.similarFlows> <div class="col-md-offset-8 col-md-2"> <strong class=text-warning>Similar flows exist!</strong> <button class="btn btn-warning" ng-click="ctrl.visibility.similarFlows = true"> Show </button> </div> </div> <div ng-if=ctrl.visibility.similarFlows> <h4> Existing flows from <waltz-entity-icon-label entity-ref=ctrl.sourceEntity></waltz-entity-icon-label> to <waltz-entity-icon-label entity-ref=ctrl.targetEntity></waltz-entity-icon-label> </h4> <waltz-grid column-defs=ctrl.similarFlowDefs row-data=ctrl.similarFlows class=small> </waltz-grid> <div class=row> <div class="col-md-offset-8 col-md-2"> <button class="btn btn-success" ng-click=ctrl.doSave() ng-disabled=!ctrl.validation.canSave> <waltz-icon name=check></waltz-icon> Save anyway </button> &nbsp; <a ng-href="{{ ctrl.cancelLink }}" class=clickable> Cancel </a> </div> </div> </div> </div> </div> </div>'},1270:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=function(){return function(e,t){if(Array.isArray(e))return e;if(Symbol.iterator in Object(e))return function(e,t){var n=[],i=!0,a=!1,o=void 0;try{for(var r,l=e[Symbol.iterator]();!(i=(r=l.next()).done)&&(n.push(r.value),!t||n.length!==t);i=!0);}catch(e){a=!0,o=e}finally{try{!i&&l.return&&l.return()}finally{if(a)throw o}}return n}(e,t);throw new TypeError("Invalid attempt to destructure non-iterable instance")}}(),a=c(n(1)),o=n(0),r=n(27),l=n(2),s=c(n(1271));function c(e){return e&&e.__esModule?e:{default:e}}var d={columnDefs:[],tableData:[]};function u(e,t){var n=(0,o.initialiseData)(this,d);n.columnDefs=[Object.assign((0,r.mkLinkGridCell)("Name","specification.name","physicalFlow.id","main.physical-flow.view"),{width:"20%"}),{field:"specification.externalId",displayName:"Ext. Id",width:"10%"},{field:"specification.format",displayName:"Format",width:"8%",cellFilter:'toDisplayName:"dataFormatKind"'},{field:"physicalFlow.transport",displayName:"Transport",width:"14%",cellFilter:'toDisplayName:"transportKind"'},{field:"physicalFlow.frequency",displayName:"Frequency",width:"10%",cellFilter:'toDisplayName:"frequencyKind"'},{field:"physicalFlow.criticality",displayName:"Criticality",width:"10%",cellFilter:'toDisplayName:"physicalFlowCriticality"'},{field:"specification.description",displayName:"Description",width:"23%"}],n.$onInit=function(){n.selector={entityReference:n.parentEntityRef,scope:"EXACT"};var o=t.loadViewData(l.CORE_API.PhysicalFlowStore.findBySelector,[n.selector]).then(function(e){return e.data}),r=t.loadViewData(l.CORE_API.PhysicalSpecificationStore.findBySelector,[n.selector]).then(function(e){return e.data});e.all([o,r]).then(function(e){var t=i(e,2),o=t[0],r=t[1];console.log("gt: ",{flows:o,specs:r}),n.tableData=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[],n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:[];if(!e)return[];var i=a.default.keyBy(t,"id");return a.default.map(n,function(e){return{physicalFlow:e,specification:i[e.specificationId]}})}(n.parentEntityRef,r,o),console.log("table data: ",n.tableData)})},n.$onChanges=function(e){},n.onGridInitialise=function(e){n.gridApi=e},n.exportGrid=function(){n.gridApi.exportFn("physical_flows.csv")},(0,o.invokeFunction)(n.onInitialise,{export:n.exportGrid})}u.$inject=["$q","ServiceBroker"];var p={bindings:{parentEntityRef:"<",onInitialise:"<"},template:s.default,controller:u};t.default=p},1271:function(e,t){e.exports='<div> <div ng-if="$ctrl.tableData.length > 0"> <waltz-grid-with-search column-defs=$ctrl.columnDefs entries=$ctrl.tableData on-initialise=$ctrl.onGridInitialise class=small> </waltz-grid-with-search> </div> <waltz-no-data ng-if="$ctrl.tableData.length == 0"> <message> <strong>No Physical Flow</strong> detail available for this <span ng-bind="$ctrl.primaryRef.kind | toDisplayName:\'entity\'"> </span> </message> </waltz-no-data> </div>'},1272:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i={template:function(e){return e&&e.__esModule?e:{default:e}}(n(1273)).default,bindings:{exportConsumes:"<",exportProduces:"<",exportUnused:"<"}};t.default=i},1273:function(e,t){e.exports='<div class=btn-group uib-dropdown> <button type=button class="btn btn-xs btn-primary" uib-dropdown-toggle> <waltz-icon name=cloud-download></waltz-icon> Export <span class=caret></span> </button> <ul class=dropdown-menu uib-dropdown-menu style=min-width:50px role=menu> <li role=menuitem> <a href="" ng-click=$ctrl.exportProduces() class=small> <waltz-icon name=download></waltz-icon> Produces </a> </li> <li role=menuitem> <a href="" ng-click=$ctrl.exportConsumes() class=small> <waltz-icon name=download></waltz-icon> Consumes </a> </li> <li role=menuitem> <a href="" ng-click=$ctrl.exportUnused() class=small> <waltz-icon name=download></waltz-icon> Unused </a> </li> </ul> </div> '},1274:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=n(0),a=function(e){return e&&e.__esModule?e:{default:e}}(n(1275));var o={};function r(){var e=(0,i.initialiseData)(this,o);e.$onInit=function(){},e.$onChanges=function(e){}}r.$inject=[];var l={template:a.default,bindings:{parentEntityRef:"<"},controller:r};t.default={component:l,id:"waltzPhysicalFlowSection"}},1275:function(e,t){e.exports='<waltz-section name="Physical Flows" icon=qrcode id=physical-flows-section collapsible=false> <waltz-physical-flow-table parent-entity-ref=$ctrl.parentEntityRef> </waltz-physical-flow-table> </waltz-section> '},1276:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=S(n(6)),a=n(7),o=b(n(243)),r=b(n(247)),l=b(n(244)),s=b(n(245)),c=b(n(246)),d=S(n(1277)),u=S(n(1279)),p=S(n(1281)),f=S(n(1283)),m=S(n(1286)),v=S(n(1288)),g=S(n(1290)),y=S(n(1292)),h=S(n(1294)),w=S(n(1296));function b(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n]);return t.default=e,t}function S(e){return e&&e.__esModule?e:{default:e}}t.default=function(){var e=i.default.module("waltz.physical.specification",[]);return e.config(f.default),(0,a.registerComponents)(e,[d.default,u.default,p.default]),e.component("waltzPhysicalDataSection",m.default).component("waltzPhysicalSpecDefinitionCreatePanel",v.default).component("waltzPhysicalSpecificationOverview",g.default).component("waltzPhysicalSpecificationConsumers",y.default).component("waltzPhysicalSpecificationMentions",h.default).component("waltzPhysicalSpecDefinitionPanel",w.default),(0,a.registerStores)(e,[o,l,r,s,c]),e.name}},1277:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=n(0),a=n(2),o=function(e){return e&&e.__esModule?e:{default:e}}(n(1278));var r={dataTypes:[]};function l(e){var t=(0,i.initialiseData)(this,r);t.$onChanges=function(){var n={entityReference:t.parentEntityRef,scope:"EXACT"};e.loadViewData(a.CORE_API.PhysicalSpecDataTypeStore.findBySpecificationSelector,[n]).then(function(e){return t.dataTypes=e.data})}}l.$inject=["ServiceBroker"],t.default={component:{template:o.default,bindings:{parentEntityRef:"<"},controller:l},id:"waltzPhysicalSpecDataTypeList"}},1278:function(e,t){e.exports='<label>Data Types</label> <div ng-if="$ctrl.specDataTypes.length > 0"> <ul class="waltz-keyword-list small"> <li ng-repeat="specDataType in $ctrl.specDataTypes" class=wkl-keyword> <span ng-bind="specDataType.dataTypeId  | toDisplayName:\'dataType\'"> </span> </li> </ul> <br> </div> <waltz-no-data ng-if="$ctrl.specDataTypes.length === 0"> <message><strong>No Data Types</strong> registered against this physical specification</message> </waltz-no-data>'},1279:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=l(n(1)),a=n(0),o=n(2),r=l(n(1280));function l(e){return e&&e.__esModule?e:{default:e}}var s={dataTypes:[],allDataTypes:[],checkedItemIds:[],originalSelectedItemIds:[],expandedItemIds:[],editing:!1};function c(e,t){var n=(0,a.initialiseData)(this,s),r=function(){var e=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];return i.default.map(e,"dataTypeId")}(n.dataTypes);n.checkedItemIds=e,n.originalSelectedItemIds=e,n.expandedItemIds=e},l=function(e){var i={entityReference:n.parentEntityRef,scope:"EXACT"};return t.loadViewData(o.CORE_API.PhysicalSpecDataTypeStore.findBySpecificationSelector,[i],{force:e}).then(function(e){return n.dataTypes=e.data})};t.loadAppData(o.CORE_API.DataTypeStore.findAll,[]).then(function(e){return n.allDataTypes=e.data}),n.typeChecked=function(e){n.checkedItemIds=i.default.union(n.checkedItemIds,[e])},n.toggleTypeChecked=function(e){i.default.some(n.checkedItemIds,function(t){return t===e})?n.typeUnchecked(e):n.typeChecked(e)},n.typeUnchecked=function(e){n.checkedItemIds=i.default.without(n.checkedItemIds,e)},n.startEdit=function(){n.editing=!0},n.save=function(){var a=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[],n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:[];return{specificationId:e,addedDataTypeIds:i.default.difference(t,n),removedDataTypeIds:i.default.difference(n,t)}}(n.parentEntityRef.id,n.checkedItemIds,n.originalSelectedItemIds);t.execute(o.CORE_API.PhysicalSpecDataTypeStore.save,[n.parentEntityRef.id,a]).then(function(e){return l(!0)}).then(function(){r(),n.editing=!1,e.success("Data types saved successfully")})},n.cancel=function(){n.editing=!1},l().then(r)}c.$inject=["Notification","ServiceBroker"],t.default={component:{template:r.default,bindings:{parentEntityRef:"<"},controller:c},id:"waltzPhysicalSpecDataTypeSection"}},1280:function(e,t){e.exports='<waltz-section name="Data Types" small="( {{ $ctrl.originalSelectedItemIds.length }} )" icon=qrcode id=specification-data-types-section> <waltz-section-actions> <div waltz-has-role=LOGICAL_DATA_FLOW_EDITOR> <button type=button class="btn btn-xs btn-primary" ng-if="! $ctrl.editing" ng-click=$ctrl.startEdit()> Edit </button> </div> </waltz-section-actions> <div ng-if=$ctrl.editing> <waltz-multi-select-tree-control items=$ctrl.allDataTypes on-click=$ctrl.toggleTypeChecked on-check=$ctrl.typeChecked on-uncheck=$ctrl.typeUnchecked checked-item-ids=$ctrl.checkedItemIds expanded-item-ids=$ctrl.expandedItemIds> <strong ng-bind=node.name> </strong> <span class="text-muted small" ng-bind=node.description> </span> </waltz-multi-select-tree-control> <br> <div style=padding-left:40px> <button class="btn btn-sm btn-success" ng-click=$ctrl.save()> Save </button> <a class=clickable ng-click=$ctrl.cancel()> Cancel </a> </div> </div> <div ng-if="! $ctrl.editing"> <waltz-physical-spec-data-type-list parent-entity-ref=$ctrl.parentEntityRef> </waltz-physical-spec-data-type-list> </div> </waltz-section>'},1281:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=function(){return function(e,t){if(Array.isArray(e))return e;if(Symbol.iterator in Object(e))return function(e,t){var n=[],i=!0,a=!1,o=void 0;try{for(var r,l=e[Symbol.iterator]();!(i=(r=l.next()).done)&&(n.push(r.value),!t||n.length!==t);i=!0);}catch(e){a=!0,o=e}finally{try{!i&&l.return&&l.return()}finally{if(a)throw o}}return n}(e,t);throw new TypeError("Invalid attempt to destructure non-iterable instance")}}(),a=s(n(1)),o=n(2),r=n(0),l=s(n(1282));function s(e){return e&&e.__esModule?e:{default:e}}var c={logicalDataElements:[],selectedSpecDefinition:{},specDefinitions:[],specDefinitionCreate:{creating:!1}};function d(e){return{newStatus:e}}function u(e,t,n){var l=(0,r.initialiseData)(this,c);l.$onInit=function(){},l.$onChanges=function(e){l.parentEntityRef&&(n.loadViewData(o.CORE_API.PhysicalSpecificationStore.getById,[l.parentEntityRef.id]).then(function(e){return e.data}).then(function(e){return l.specification=e}).then(function(e){return n.loadViewData(o.CORE_API.ApplicationStore.getById,[e.owningEntity.id])}).then(function(e){return e.data}).then(function(e){return l.owningEntity=e}).then(function(e){return n.loadViewData(o.CORE_API.OrgUnitStore.getById,[e.organisationalUnitId])}).then(function(e){return e.data}).then(function(e){return l.organisationalUnit=e}).then(function(){return l.entityReference=Object.assign({},l.entityReference,{name:l.specification.name})}),s())};var s=function(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];return n.loadViewData(o.CORE_API.PhysicalSpecDefinitionStore.findForSpecificationId,[l.parentEntityRef.id],{force:e}).then(function(e){return e.data}).then(function(e){return l.specDefinitions=e}).then(function(t){var i=a.default.find(t,{status:"ACTIVE"});i&&l.selectSpecDefinition(i,e);var r={scope:"EXACT",entityReference:{kind:"PHYSICAL_SPECIFICATION",id:l.parentEntityRef.id}};n.loadViewData(o.CORE_API.LogicalDataElementStore.findBySelector,[r],{force:e}).then(function(e){return l.logicalDataElements=e.data})})};l.selectSpecDefinition=function(t){var a=arguments.length>1&&void 0!==arguments[1]&&arguments[1],r=n.loadViewData(o.CORE_API.PhysicalSpecDefinitionFieldStore.findForSpecDefinitionId,[t.id],{force:a}).then(function(e){return e.data}),s=n.loadViewData(o.CORE_API.PhysicalSpecDefinitionSampleFileStore.findForSpecDefinitionId,[t.id],{force:a}).then(function(e){return e.data});e.all([r,s]).then(function(e){var n=i(e,2),a=n[0],o=n[1];return l.selectedSpecDefinition={def:t,fields:a,sampleFile:o}})},l.showCreateSpecDefinition=function(){l.specDefinitionCreate.creating=!0},l.hideCreateSpecDefinition=function(){l.specDefinitionCreate.creating=!1},l.createSpecDefinition=function(i){n.execute(o.CORE_API.PhysicalSpecDefinitionStore.create,[l.parentEntityRef.id,i.def]).then(function(e){return e.data}).then(function(t){var a=n.execute(o.CORE_API.PhysicalSpecDefinitionFieldStore.createFields,[t,i.fields]).then(function(e){return e.data});if(i.sampleData){var r=n.execute(o.CORE_API.PhysicalSpecDefinitionSampleFileStore.create,[t,{name:l.specification.name,fileData:i.sampleData}]).then(function(e){return e.data});return e.all([a,r])}return a}).then(function(e){t.success("Specification definition created successfully"),s(!0),l.hideCreateSpecDefinition()},function(e){t.error("Failed to create specification definition. Ensure that 'version' is unique")})},l.deleteSpec=function(e){n.execute(o.CORE_API.PhysicalSpecDefinitionStore.deleteSpecification,[e.id]).then(function(e){return e.data}).then(function(n){n?(t.success("Deleted version "+e.version),s(!0)):t.error("Could not delete version "+e.version)})},l.activateSpec=function(e){n.execute(o.CORE_API.PhysicalSpecDefinitionStore.updateStatus,[e.id,d("ACTIVE")]).then(function(e){return e.data}).then(function(n){n?(t.success("Marked version "+e.version+" as active"),s(!0)):t.error("Could not mark version "+e.version+" as active")})},l.markSpecObsolete=function(e){n.execute(o.CORE_API.PhysicalSpecDefinitionStore.updateStatus,[e.id,d("OBSOLETE")]).then(function(e){return e.data}).then(function(n){n?(t.success("Marked version "+e.version+" as obsolete"),s(!0)):t.error("Could not mark version "+e.version+" as obsolete")})},l.updateFieldDescription=function(e,i){var a={newDescription:i.newVal};n.execute(o.CORE_API.PhysicalSpecDefinitionFieldStore.updateDescription,[e,a]).then(function(e){e?(t.success("Updated description for field"),l.selectSpecDefinition(l.selectedSpecDefinition.def,!0)):t.error("Could not update field description")})},l.updateLogicalDataElement=function(e,i){var a={newLogicalDataElement:i.newVal};n.execute(o.CORE_API.PhysicalSpecDefinitionFieldStore.updateLogicalElement,[e,a]).then(function(e){if(e){t.success("Updated logical data element for field");var i={scope:"EXACT",entityReference:{kind:"PHYSICAL_SPECIFICATION",id:l.parentEntityRef.id}};n.loadViewData(o.CORE_API.LogicalDataElementStore.findBySelector,[i],{force:!0}).then(function(e){return l.logicalDataElements=e.data}),l.selectSpecDefinition(l.selectedSpecDefinition.def,!0)}else t.error("Could not update logical data element")})}}u.$inject=["$q","Notification","ServiceBroker"];var p={template:l.default,bindings:{parentEntityRef:"<"},controller:u};t.default={component:p,id:"waltzPhysicalSpecDefinitionSection"}},1282:function(e,t){e.exports='<waltz-section name="Specification Definitions" small="( {{ $ctrl.specDefinitions.length }} )" icon=file-code-o id=specification-definition-section> <waltz-section-actions> <div waltz-has-role=LOGICAL_DATA_FLOW_EDITOR> <div class=btn-group uib-dropdown is-open=status.isopen> <button type=button class="btn btn-xs btn-primary" ng-click=$ctrl.showCreateSpecDefinition() ng-disabled="$ctrl.selectableSpecDefinitions.length == 0"> Add New Definition </button> </div> </div> </waltz-section-actions> <div ng-if=$ctrl.specDefinitionCreate.creating class=waltz-fade-if> <waltz-physical-spec-definition-create-panel status=$ctrl.specDefinitionCreate.status on-submit=$ctrl.createSpecDefinition on-cancel=$ctrl.hideCreateSpecDefinition> </waltz-physical-spec-definition-create-panel> </div> <div ng-if="! $ctrl.specDefinitionCreate.creating" class=waltz-fade-if> <div class=row ng-if="$ctrl.specDefinitions.length > 0"> <div class=col-sm-4> <table class="table table-condensed table-hover"> <thead> <tr> <th>Version</th> <th>Status</th> <th></th> </tr> </thead> <tbody> <tr ng-repeat="def in $ctrl.specDefinitions | orderBy: \'createdAt\':true" class="clickable waltz-visibility-parent" ng-class="{ \'waltz-highlighted-row\' : def.id === $ctrl.selectedSpecDefinition.def.id }" ng-click=$ctrl.selectSpecDefinition(def)> <td> <a ng-bind=def.version> </a> </td> <td> <span ng-bind="def.status | toDisplayName:\'releaseLifecycleStatus\'"> </span> </td> <td> <a ng-if="def.status === \'DEPRECATED\' || def.status === \'DRAFT\'" ng-click=$ctrl.activateSpec(def) class="btn btn-xs waltz-visibility-child-30"> <waltz-icon name=check></waltz-icon> <span class=small>activate</span> </a> <a ng-if="def.status === \'DEPRECATED\'" ng-click=$ctrl.markSpecObsolete(def) class="btn btn-xs waltz-visibility-child-30"> <waltz-icon name=archive></waltz-icon> <span class=small>mark obsolete</span> </a> <a ng-if="def.status === \'DRAFT\'" ng-click=$ctrl.deleteSpec(def) class="btn btn-xs waltz-visibility-child-30"> <waltz-icon name=trash-o></waltz-icon> <span class=small>delete</span> </a> </td> </tr> </tbody> </table> </div> <div class=col-sm-8 ng-if=$ctrl.selectedSpecDefinition.def> <waltz-physical-spec-definition-panel spec-definition=$ctrl.selectedSpecDefinition logical-data-elements=$ctrl.logicalDataElements default-active-tab-index=0 on-update-field-description=$ctrl.updateFieldDescription on-update-logical-data-element=$ctrl.updateLogicalDataElement> <no-data-message> <strong>No definitions</strong> for this physical specification. </no-data-message> </waltz-physical-spec-definition-panel> </div> </div> <waltz-no-data ng-if="$ctrl.specDefinitions.length == 0"> <message> <strong>No definitions</strong> for this physical specification. </message> </waltz-no-data> </div> </waltz-section>'},1283:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i={},a={url:"physical-specification/{id:int}",views:{"content@":function(e){return e&&e.__esModule?e:{default:e}}(n(1284)).default}};function o(e){e.state("main.physical-specification",i).state("main.physical-specification.view",a)}o.$inject=["$stateProvider"],t.default=o},1284:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=function(){return function(e,t){if(Array.isArray(e))return e;if(Symbol.iterator in Object(e))return function(e,t){var n=[],i=!0,a=!1,o=void 0;try{for(var r,l=e[Symbol.iterator]();!(i=(r=l.next()).done)&&(n.push(r.value),!t||n.length!==t);i=!0);}catch(e){a=!0,o=e}finally{try{!i&&l.return&&l.return()}finally{if(a)throw o}}return n}(e,t);throw new TypeError("Invalid attempt to destructure non-iterable instance")}}(),a=s(n(1)),o=n(0),r=n(31),l=s(n(1285));function s(e){return e&&e.__esModule?e:{default:e}}var c={visibility:{createReportOverlay:!1,createReportButton:!0,createReportBusy:!1},createReportForm:{name:""},logicalDataElements:[],selectedSpecDefinition:{},specDefinitions:[],specDefinitionCreate:{creating:!1},bookmarksSection:r.dynamicSections.bookmarksSection,entityDiagramsSection:r.dynamicSections.entityDiagramsSection,changeLogSection:r.dynamicSections.changeLogSection},d=function(e,t){t&&e.put(t.name,"PHYSICAL_SPECIFICATION","main.physical-specification.view",{id:t.id})};function u(e,t,n,r,l,s,u,p,f,m){var v=(0,o.initialiseData)(this,c),g=t.id,y={kind:"PHYSICAL_SPECIFICATION",id:g};v.entityReference=y,f.getById(g).then(function(e){return v.specification=e}).then(function(e){return n.getById(e.owningEntity.id)}).then(function(e){return v.owningEntity=e}).then(function(e){return p.getById(e.organisationalUnitId)}).then(function(e){return v.organisationalUnit=e}).then(function(){return v.entityReference=Object.assign({},v.entityReference,{name:v.specification.name})}).then(function(){return d(s,v.specification)}),m.findBySpecificationId(g).then(function(e){return v.physicalFlows=e}),u.findBySelector({entityReference:y,scope:"EXACT"}).then(function(e){v.logicalFlows=e,v.logicalFlowsById=a.default.keyBy(e,"id")}),v.loadFlowDiagrams=function(){(function(e,t,n,a){var o={entityReference:{id:e,kind:"PHYSICAL_SPECIFICATION"},scope:"EXACT"},r=[n.findForSelector(o),a.findForSelector(o)];return t.all(r).then(function(e){var t=i(e,2);return{flowDiagrams:t[0],flowDiagramEntities:t[1]}})})(g,e,r,l).then(function(e){return Object.assign(v,e)})},v.loadFlowDiagrams()}u.$inject=["$q","$stateParams","ApplicationStore","FlowDiagramStore","FlowDiagramEntityStore","HistoryStore","LogicalFlowStore","OrgUnitStore","PhysicalSpecificationStore","PhysicalFlowStore"],t.default={template:l.default,controller:u,controllerAs:"ctrl"}},1285:function(e,t){e.exports='<div> <waltz-page-header name="{{ ctrl.specification.name }}" small="Physical Specification" icon=file-text> <ol class=waltz-breadcrumbs> <li><a ui-sref=main>Home</a></li> <li> <waltz-entity-link entity-ref="{\n                        id: ctrl.owningEntity.id,\n                        kind: \'APPLICATION\',\n                        name: ctrl.owningEntity.name }"> </waltz-entity-link> </li> <li ng-bind=ctrl.specification.name></li> </ol> </waltz-page-header> <div class="waltz-page-summary waltz-page-summary-attach"> <div class=row ng-if=ctrl.specification> <div class=col-md-7> <waltz-physical-specification-overview owning-entity=ctrl.owningEntity specification=ctrl.specification organisational-unit=ctrl.organisationalUnit> </waltz-physical-specification-overview> </div> <div class=col-md-5> <waltz-data-type-usage-panel parent-entity-ref=ctrl.entityReference> </waltz-data-type-usage-panel> </div> </div> <waltz-no-data ng-if=!ctrl.specification> <message>No information for this physical specification</message> </waltz-no-data> </div> <br> <div ng-if=ctrl.specification> <waltz-physical-spec-definition-section parent-entity-ref=ctrl.entityReference> </waltz-physical-spec-definition-section> <waltz-dynamic-section-wrapper section=ctrl.entityDiagramsSection parent-entity-ref=ctrl.entityReference> </waltz-dynamic-section-wrapper> <waltz-section icon=link ng-if="ctrl.physicalFlows.length > 0" id=specification-usage-section name=Usage small="Associated Flows"> <p>This specification is associated with the following physical flows:</p> <table class="table table-condensed small"> <thead> <tr> <th>From</th> <th>To</th> <th>Frequency</th> <th>Transport</th> </tr> </thead> <tbody> <tr ng-repeat="flow in ctrl.physicalFlows"> <td> <a ng-bind=ctrl.logicalFlowsById[flow.logicalFlowId].source.name class=clickable ui-sref="main.physical-flow.view ({id: flow.id })"> </a> </td> <td> <a ng-bind=ctrl.logicalFlowsById[flow.logicalFlowId].target.name class=clickable ui-sref="main.physical-flow.view ({id: flow.id })"> </a> </td> <td> <span ng-bind="flow.frequency | toDisplayName:\'frequencyKind\'"></span> </td> <td> <span ng-bind="flow.transport | toDisplayName:\'transportKind\'"></span> </td> </tr> </tbody> </table> </waltz-section> <waltz-dynamic-section-wrapper section=ctrl.bookmarksSection parent-entity-ref=ctrl.entityReference> </waltz-dynamic-section-wrapper> <waltz-dynamic-section-wrapper section=ctrl.changeLogSection parent-entity-ref=ctrl.entityReference> </waltz-dynamic-section-wrapper> </div> </div>'},1286:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=function(){return function(e,t){if(Array.isArray(e))return e;if(Symbol.iterator in Object(e))return function(e,t){var n=[],i=!0,a=!1,o=void 0;try{for(var r,l=e[Symbol.iterator]();!(i=(r=l.next()).done)&&(n.push(r.value),!t||n.length!==t);i=!0);}catch(e){a=!0,o=e}finally{try{!i&&l.return&&l.return()}finally{if(a)throw o}}return n}(e,t);throw new TypeError("Invalid attempt to destructure non-iterable instance")}}(),a=s(n(1)),o=n(0),r=n(27),l=s(n(1287));function s(e){return e&&e.__esModule?e:{default:e}}var c={primaryRef:null,physicalFlows:[],logicalFlows:[],specifications:[],onInitialise:function(e){}},d=function(e){return!e.logicalFlow||!e.specification},u=function(e){return function(t){var n=t.logicalFlow.target;return n.id===e.id&&n.kind===e.kind}};function p(){var e=(0,o.initialiseData)(this,c);e.produceColumnDefs=[Object.assign((0,r.mkLinkGridCell)("Name","specification.name","physicalFlow.id","main.physical-flow.view"),{width:"20%"}),{field:"specification.externalId",displayName:"Ext. Id",width:"10%"},Object.assign((0,r.mkEntityLinkGridCell)("Receiver(s)","logicalFlow.target","left"),{width:"15%"}),{field:"specification.format",displayName:"Format",width:"8%",cellFilter:'toDisplayName:"dataFormatKind"'},{field:"physicalFlow.transport",displayName:"Transport",width:"14%",cellFilter:'toDisplayName:"transportKind"'},{field:"physicalFlow.frequency",displayName:"Frequency",width:"10%",cellFilter:'toDisplayName:"frequencyKind"'},{field:"physicalFlow.criticality",displayName:"Criticality",width:"10%",cellFilter:'toDisplayName:"physicalFlowCriticality"'},{field:"specification.description",displayName:"Description",width:"23%"}],e.consumeColumnDefs=[Object.assign((0,r.mkLinkGridCell)("Name","specification.name","physicalFlow.id","main.physical-flow.view"),{width:"20%"}),{field:"specification.externalId",displayName:"Ext. Id",width:"10%"},Object.assign((0,r.mkEntityLinkGridCell)("Source","logicalFlow.source","left"),{width:"15%"}),{field:"specification.format",displayName:"Format",width:"8%",cellFilter:'toDisplayName:"dataFormatKind"'},{field:"physicalFlow.transport",displayName:"Transport",width:"14%",cellFilter:'toDisplayName:"transportKind"'},{field:"physicalFlow.frequency",displayName:"Frequency",width:"10%",cellFilter:'toDisplayName:"frequencyKind"'},{field:"physicalFlow.criticality",displayName:"Criticality",width:"10%",cellFilter:'toDisplayName:"physicalFlowCriticality"'},{field:"specification.description",displayName:"Description",width:"23%"}],e.unusedSpecificationsColumnDefs=[{field:"name",displayName:"Name"},{field:"format",displayName:"Format",cellFilter:'toDisplayName:"dataFormatKind"'},{field:"description",displayName:"Description"}],e.$onChanges=function(){Object.assign(e,function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{produces:[],consumes:[]},n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:[],o=arguments.length>3&&void 0!==arguments[3]?arguments[3]:[];if(!e)return[];var r=a.default.keyBy(t,"id"),l=a.default.keyBy(o,"id"),s=a.default.chain(n).map(function(e){return{physicalFlow:e,logicalFlow:l[e.logicalFlowId],specification:r[e.specificationId]}}).reject(d).partition(u(e)).value(),c=i(s,2);return{consumes:c[0],produces:c[1]}}(e.primaryRef,e.specifications,e.physicalFlows,e.logicalFlows))},e.onProducesGridInitialise=function(t){e.producesExportFn=t.exportFn},e.onConsumesGridInitialise=function(t){e.consumesExportFn=t.exportFn},e.onUnusedSpecificationsGridInitialise=function(t){e.unusedSpecificationsExportFn=t.exportFn},e.exportProduces=function(){e.producesExportFn("produces.csv")},e.exportConsumes=function(){e.consumesExportFn("consumes.csv")},e.exportUnusedSpecifications=function(){e.unusedSpecificationsExportFn("unused-specifications.csv")},e.onInitialise({exportProducesFn:e.exportProduces,exportConsumesFn:e.exportConsumes,exportUnusedSpecificationsFn:e.exportUnusedSpecifications})}p.$inject=["$scope"];var f={template:l.default,bindings:{primaryRef:"<",physicalFlows:"<",specifications:"<",logicalFlows:"<",onInitialise:"<"},controller:p};t.default=f},1287:function(e,t){e.exports='<div> <div class=row ng-if="$ctrl.produces.length > 0"> <div class=col-md-12> <strong>Produces (<span ng-bind=$ctrl.produces.length></span>)</strong> <waltz-grid-with-search column-defs=$ctrl.produceColumnDefs entries=$ctrl.produces on-initialise=$ctrl.onProducesGridInitialise class=small> </waltz-grid-with-search> <hr> </div> </div> <div class=row ng-if="$ctrl.consumes.length > 0"> <div class=col-md-12> <strong>Consumes (<span ng-bind=$ctrl.consumes.length></span>)</strong> <waltz-grid-with-search column-defs=$ctrl.consumeColumnDefs entries=$ctrl.consumes on-initialise=$ctrl.onConsumesGridInitialise class=small> </waltz-grid-with-search> </div> </div> <waltz-no-data ng-if="$ctrl.produces.length == 0 && $ctrl.consumes.length == 0"> <message> <strong>No Physical Flow</strong> detail available for this <span ng-bind="$ctrl.primaryRef.kind | toDisplayName:\'entity\'"> </span> </message> </waltz-no-data> <div class=row ng-hide="$ctrl.unusedSpecifications | isEmpty"> <br> <div class=col-md-12> <strong>Unused Specifications</strong> <small class=text-muted> Specifications which have been registered, but are not sent to any consumers. </small> <br><br> <waltz-grid column-defs=$ctrl.unusedSpecificationsColumnDefs row-data=$ctrl.unusedSpecifications on-initialise=$ctrl.onUnusedSpecificationsGridInitialise class=small> </waltz-grid> </div> </div> </div> '},1288:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=n(0),a=o(n(1));function o(e){return e&&e.__esModule?e:{default:e}}var r={status:null,specDefinition:{def:{delimiter:",",type:"DELIMITED"}},specDefFields:{},onCancel:function(){return console.log("psdcp::onCancel")},onSubmit:function(e){return console.log("psdcp::onSubmit",e)}},l=["DATE","DECIMAL","INTEGER","STRING","BOOLEAN","ENUM"];function s(){var e={field:function(e,t){var n=a.default.split(e,/[,\W]+/);if(n.length>2){var i=a.default.chain(n).map(function(e){return e.trim()}).filter(function(e){return e.length>0}).value(),o=a.default.findIndex(i,function(e){return a.default.includes(l,e)});return{name:a.default.join(a.default.take(i,o)," "),type:i[o],description:a.default.join(a.default.drop(i,o+1)," "),position:t}}}(arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],arguments[1]),errors:[]};return e.field?(a.default.isEmpty(e.field.name)&&e.errors.push("Name must be defined"),a.default.isEmpty(e.field.type)&&e.errors.push("Type must be defined"),a.default.isEmpty(e.field.description)&&e.errors.push("Description must be defined"),a.default.includes(l,e.field.type)||e.errors.push("Type is invalid")):e.errors.push("Make sure all three columns: Name, Type and Description are populated"),e}var c={controller:function(){var e=(0,i.initialiseData)(this,r);e.cancel=function(){return(0,i.invokeFunction)(e.onCancel)},e.preview=function(){e.specDefFields.hasErrors=!1,e.specDefFields.parsedData=[];var t=a.default.chain(e.specDefFields.rawData).split("\n").value();e.specDefFields.parsedData=a.default.map(t,function(t,n){var i=s(t,n+1);return i.errors.length>0&&(e.specDefFields.hasErrors=!0),i})},e.onSelectorEntitySelect=function(t,n){var i=a.default.find(e.specDefFields.parsedData,["field.position",n]);i&&(i.field.logicalDataElementId=t.id,console.log("match: ",i)),console.log("fields: ",e.specDefFields)},e.submit=function(){e.specDefinition.fields=a.default.map(e.specDefFields.parsedData,"field"),(0,i.invokeFunction)(e.onSubmit,e.specDefinition)}},template:o(n(1289)).default,bindings:{status:"<",onCancel:"<",onSubmit:"<"}};t.default=c},1289:function(e,t){e.exports='<div> <form name=specDefForm class=form-horizontal role=form novalidate> <div class=form-group> <label for=version class="col-sm-3 control-label"> Version <span class=text-danger>*</span> </label> <div class=col-sm-9> <input type=text id=version maxlength=64 required class=form-control placeholder="Version of this specification definition" ng-model=$ctrl.specDefinition.def.version>  </div> </div> <div class=form-group> <label for=delimiter class="col-sm-3 control-label"> Delimiter <span class=text-danger>*</span> </label> <div class=col-sm-9> <select id=delimiter ng-model=$ctrl.specDefinition.def.delimiter> <option ng-value="\'&#9;\'" selected=selected>Tab</option> <option ng-value="\',\'">Comma ( , )</option> <option ng-value="\'|\'">Pipe ( | )</option> <option ng-value="\';\'">Semicolon ( ; )</option> <option ng-value="\':\'">Colon ( : )</option> <option ng-value="\'#\'">Hash ( # )</option> <option ng-value="\'?\'">Other</option> </select> </div> </div> <div class=form-group> <label class="col-sm-3 control-label" for=status> Status <span class=text-danger>*</span> </label> <div class=col-sm-9> <select id=status ng-model=$ctrl.specDefinition.def.status> <option ng-value="\'ACTIVE\'" selected=selected> Active (will mark any currently active versions as deprecated) </option> <option ng-value="\'DRAFT\'"> Draft (use for future releases) </option> <option ng-value="\'DEPRECATED\'"> Deprecated (use to document historic versions) </option> </select> </div> </div> <div class=form-group> <div class=col-sm-3 style=text-align:right> <label for=fields class=control-label> Fields <span class=text-danger>*</span> </label> <div class=help-block> Enter <b>tab</b> separated field data (one per line) in the following format: <br> <code>Name Type Description</code> <br> Allowed values for \'Type\' are: <br> DATE, DECIMAL, INTEGER, STRING, BOOLEAN, ENUM <br> <b>Example:</b> <pre style=font-size:xx-small;text-align:left>\nField1&#9;INTEGER&#9;description for field 1\nField2&#9;DATE&#9;description for field 2\n                    </pre> </div> </div> <div class=col-sm-9> <textarea id=fields required class=form-control placeholder="Enter your field definitions here.  You can simply cut n\' paste from a spreadsheet" ng-model=$ctrl.specDefFields.rawData ng-model-options="{ debounce: 250 }" ng-change=$ctrl.preview() rows=10>\n                </textarea> </div> </div> <div class=form-group> <label class="col-sm-3 control-label"> Fields </label> <div class=col-sm-9> <table class="table table-condensed"> <colgroup> <col width=20%> <col width=10%> <col width=25%> <col width=15%> <col width=30%> </colgroup> <thead> <tr> <th>Name</th> <th>Type</th> <th>Description</th> <th>Logical Element</th> <th>Errors</th> </tr> </thead> <tbody> <tr ng-repeat="fieldData in $ctrl.specDefFields.parsedData | orderBy:\'position\'"> <td> <span ng-bind=fieldData.field.name> </span> </td> <td> <span ng-bind=fieldData.field.type> </span> </td> <td> <span ng-bind=fieldData.field.description> </span> </td> <td> <waltz-entity-selector item-id=fieldData.field.position on-select=$ctrl.onSelectorEntitySelect entity-kinds="[\'LOGICAL_DATA_ELEMENT\']"> </waltz-entity-selector> </td> <td ng-class="{ \'bg-danger\' : fieldData.errors.length > 0 }"> <div ng-repeat="error in fieldData.errors"> <span ng-bind=error></span> </div> </td> </tr> </tbody> </table> </div> </div> <div class=form-group> <div class=col-sm-3 style=text-align:right> <label for=sampleData class=control-label> Sample Data </label> </div> <div class=col-sm-9> <textarea id=sampleData class=form-control placeholder="Enter sample data for this definition here.  Confidential data should be obfuscated." ng-model=$ctrl.specDefinition.sampleData rows=5>\n                </textarea> </div> </div> <div class=form-group style=padding-top:10px> <div class="col-sm-offset-3 col-sm-9"> <button type=button ng-disabled="specDefForm.$invalid || $ctrl.specDefFields.hasErrors" ng-click=$ctrl.submit() class="btn btn-success"> Submit </button> &nbsp; <a class=clickable ng-click=$ctrl.onCancel()> <span>Cancel</span> </a> </div> </div> </form> </div>'},1290:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i={template:function(e){return e&&e.__esModule?e:{default:e}}(n(1291)).default,bindings:{specification:"<",owningEntity:"<",organisationalUnit:"<"}};t.default=i},1291:function(e,t){e.exports='<waltz-sub-section name=Detail show-border=false> <content> <div class=waltz-sub-section-content> <div class=row> <div class="col-sm-4 waltz-display-field-label"> Owner: </div> <div class=col-sm-8> <waltz-entity-link entity-ref=$ctrl.specification.owningEntity> </waltz-entity-link> </div> </div> <div class=row> <div class="col-sm-4 waltz-display-field-label"> Format: </div> <div class=col-sm-8> <span ng-bind=$ctrl.specification.format></span> </div> </div> <div class=row> <div class="col-sm-4 waltz-display-field-label"> External Id: </div> <div class=col-sm-8> <span ng-bind=$ctrl.specification.externalId></span> </div> </div> <div class=row> <div class="col-sm-4 waltz-display-field-label"> Description: </div> <div class=col-sm-8> <span ng-bind=$ctrl.specification.description></span> </div> </div> </div> </content> </waltz-sub-section> '},1292:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=n(0);var a={physicalFlows:[],onFlowSelect:function(e){return console.log("wpsc: on-flow-select",e)}};var o={bindings:{physicalFlows:"<",onFlowSelect:"<"},controller:function(){(0,i.initialiseData)(this,a)},template:function(e){return e&&e.__esModule?e:{default:e}}(n(1293)).default};t.default=o},1293:function(e,t){e.exports='<div class=row> <div class=col-sm-12> <div ng-if="$ctrl.physicalFlows.length > 7"> <input type=search placeholder="search ..." ng-model=$ctrl.searchTerms class=form-control> <br> </div> <div class="small text-muted"> Select an application to see more detail about the flow and its lineage </div> <br> <div ng-class="{ \'waltz-scroll-region-300\': $ctrl.physicalFlows.length > 10}"> <table class="table table-condensed small table-hover"> <thead> <tr> <th width=30%>Target</th> <th width=5%>Transport</th> <th width=5%>Frequency</th> <th width=5%>Basis Offset</th> <th width=55%>Description</th> </tr> </thead> <tbody> <tr ng-repeat="flow in $ctrl.physicalFlows | filter:$ctrl.searchTerms | orderBy:\'target.name\'"> <td> <waltz-entity-icon-label ng-click=$ctrl.onFlowSelect(flow) entity-ref=flow.target class=waltz-action-link> </waltz-entity-icon-label> </td> <td> <span ng-bind=flow.transport></span> </td> <td> <span ng-bind=flow.frequency></span> </td> <td> <span ng-bind=flow.basisOffset></span> </td> <td> <span ng-bind=flow.description></span> </td> </tr> </tbody> </table> </div> <p class="small text-muted"> Applications which declare a physical flow which consumes this item. </p> </div> </div> '},1294:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=n(0),a=n(27);var o={mentions:[],onInitialise:function(e){}};var r={template:function(e){return e&&e.__esModule?e:{default:e}}(n(1295)).default,bindings:{mentions:"<",onInitialise:"<"},controller:function(){var e=(0,i.initialiseData)(this,o);e.columnDefs=[Object.assign((0,a.mkLinkGridCell)("Specification","specification.name","flow.id","main.physical-flow.view"),{width:"20%"}),Object.assign((0,a.mkEntityLinkGridCell)("From","sourceEntity","left"),{width:"13%"}),Object.assign((0,a.mkEntityLinkGridCell)("To","targetEntity","left"),{width:"13%"}),{field:"specification.format",displayName:"Format",width:"10%"},{field:"flow.transport",displayName:"Transport",width:"12%"},{field:"flow.frequency",displayName:"Frequency",width:"10%"},{field:"specification.description",displayName:"Description",width:"22%"}],e.onGridInitialise=function(t){e.exportFn=t.exportFn},e.exportGrid=function(){e.exportFn("mentions.csv")},e.onInitialise({exportFn:e.exportGrid})}};t.default=r},1295:function(e,t){e.exports='<div class=row> <div class=col-md-12> <br> <p class="text-muted small"> This table outlines where this specification is mentioned in the lineage of other specifications. </p> <br> <waltz-grid column-defs=$ctrl.columnDefs row-data=$ctrl.mentions on-initialise=$ctrl.onGridInitialise class=small> </waltz-grid> </div> </div>'},1296:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=r(n(1)),a=n(0),o=r(n(1297));function r(e){return e&&e.__esModule?e:{default:e}}var l={logicalDataElementsById:{},specDefinition:{},selectableDefinitions:[],onDefinitionSelect:function(e){return console.log("psdp::onDefinitionSelect",e)},onUpdateFieldDescription:function(e,t){return console.log("psdp::onUpdateFieldDescription",{fieldId:e,change:t})},onUpdateLogicalDataElement:function(e,t){return console.log("psdp::onUpdateLogicalDataElement",{fieldId:e,change:t})}};function s(e){var t=(0,a.initialiseData)(this,l);t.$onChanges=function(){t.logicalDataElements&&(t.logicalDataElementsById=i.default.keyBy(t.logicalDataElements,"id"))},t.definitionSelected=function(e){return(0,a.invokeFunction)(t.onDefinitionSelect,e)},t.updateDescription=function(n,o){return i.default.isEmpty(o.newVal)?e.reject("Too short"):(0,a.invokeFunction)(t.onUpdateFieldDescription,n,o)},t.updateLogicalElement=function(e,n){return(0,a.invokeFunction)(t.onUpdateLogicalDataElement,e,n)}}s.$inject=["$q"];var c={controller:s,template:o.default,bindings:{defaultActiveTabIndex:"<",logicalDataElements:"<",specDefinition:"<",selectableDefinitions:"<",onDefinitionSelect:"<",onUpdateFieldDescription:"<",onUpdateLogicalDataElement:"<"},transclude:{noDataMessage:"noDataMessage"}};t.default=c},1297:function(e,t){e.exports='<div> <uib-tabset ng-if=$ctrl.specDefinition.def active=1> <uib-tab index=0 heading=General> <div class=row> <br> <div class="col-sm-2 waltz-display-field-label"> Version </div> <div class=col-sm-10> <span ng-bind=$ctrl.specDefinition.def.version></span> <span ng-if="$ctrl.specDefinition.def.status === \'ACTIVE\'"> - <i>Latest</i> </span> <div waltz-has-role=LOGICAL_DATA_FLOW_EDITOR> <div class=btn-group uib-dropdown is-open=status.isopen> <span ng-if="$ctrl.selectableDefinitions.length > 0"> - <a class=clickable uib-dropdown-toggle> link to a different version <span class=caret></span> </a> </span> <ul class=dropdown-menu uib-dropdown-menu role=menu> <li ng-repeat="def in $ctrl.selectableDefinitions | orderBy: \'createdAt\':true" role=menuitem> <a class=clickable ng-click=$ctrl.definitionSelected(def)> <span ng-bind=def.version></span> - <span ng-bind="def.status | toDisplayName: \'releaseLifecycleStatus\'"></span> </a> </li> </ul> </div> </div> </div> </div> <div class=row> <br> <div class="col-sm-2 waltz-display-field-label"> Status </div> <div class=col-sm-4> <span ng-bind="$ctrl.specDefinition.def.status | toDisplayName: \'releaseLifecycleStatus\'"></span> </div> <div class="col-sm-2 waltz-display-field-label"> Type </div> <div class=col-sm-4> <span ng-bind="$ctrl.specDefinition.def.type | toDisplayName: \'physicalSpecDefinitionType\'"></span> </div> </div> <div class=row style=margin-bottom:20px> <br> <div class="col-sm-2 waltz-display-field-label"> Created By </div> <div class=col-sm-4> <span ng-bind=$ctrl.specDefinition.def.createdBy></span>, <waltz-from-now timestamp=$ctrl.specDefinition.def.createdAt> </waltz-from-now> </div> <div class="col-sm-2 waltz-display-field-label"> Updated By </div> <div class=col-sm-4> <span ng-bind=$ctrl.specDefinition.def.lastUpdatedBy></span>, <waltz-from-now timestamp=$ctrl.specDefinition.def.lastUpdatedAt> </waltz-from-now> </div> </div> </uib-tab> <uib-tab index=1 heading=Fields> <br> <table class="table table-condensed table-striped"> <colgroup> <col width=27%> <col width=7%> <col width=33%> <col width=33%> </colgroup> <thead> <tr> <th>Name</th> <th>Type</th> <th>Description</th> <th>Logical Element</th> </tr> </thead> <tbody> <tr ng-repeat="field in $ctrl.specDefinition.fields | orderBy:\'position\'"> <td> <span ng-bind=field.name> </span> </td> <td> <span ng-bind=field.type> </span> </td> <td> <waltz-editable-field on-save=$ctrl.updateDescription field-type=textarea initial-val=field.description item-id=field.id> </waltz-editable-field> </td> <td> <waltz-editable-field on-save=$ctrl.updateLogicalElement field-type=logical-data-element initial-val=$ctrl.logicalDataElementsById[field.logicalDataElementId] item-id=field.id> </waltz-editable-field> </td> </tr> </tbody> </table> </uib-tab> <uib-tab index=2 heading="Sample File"> <br> <div ng-if=$ctrl.specDefinition.sampleFile> <div class=row> <div class="col-sm-2 waltz-display-field-label"> Name </div> <div class=col-sm-4> <span ng-bind=$ctrl.specDefinition.sampleFile.name></span> </div> </div> <div class=row> <br> <div class="col-sm-2 waltz-display-field-label"> Sample Data </div> <div class=col-sm-10> <div ng-bind=$ctrl.specDefinition.sampleFile.fileData class=waltz-scroll-region-350 style=white-space:pre;font-family:monospace> </div> </div> </div> </div> <waltz-no-data ng-if="! $ctrl.specDefinition.sampleFile"> <message> <strong>No sample file</strong> uploaded for this physical specification definition. </message> </waltz-no-data> </uib-tab> </uib-tabset> <waltz-no-data ng-if="! $ctrl.specDefinition.def"> <message> <div ng-transclude=noDataMessage></div> </message> </waltz-no-data> </div>'},1298:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=r(n(6)),a=n(7),o=r(n(1299));function r(e){return e&&e.__esModule?e:{default:e}}t.default=function(){var e=i.default.module("waltz.physical-spec-defn-field",[]);return(0,a.registerComponents)(e,[o.default]),e.name}},1299:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=function(){return function(e,t){if(Array.isArray(e))return e;if(Symbol.iterator in Object(e))return function(e,t){var n=[],i=!0,a=!1,o=void 0;try{for(var r,l=e[Symbol.iterator]();!(i=(r=l.next()).done)&&(n.push(r.value),!t||n.length!==t);i=!0);}catch(e){a=!0,o=e}finally{try{!i&&l.return&&l.return()}finally{if(a)throw o}}return n}(e,t);throw new TypeError("Invalid attempt to destructure non-iterable instance")}}(),a=d(n(1)),o=n(2),r=n(0),l=n(17),s=n(27),c=d(n(1300));function d(e){return e&&e.__esModule?e:{default:e}}var u={selector:null,columnDefs:[],data:[],physicalFields:[],physicalSpecs:[],physicalSpecDefns:[]};function p(e,t){var n=(0,r.initialiseData)(this,u);n.$onInit=function(){n.columnDefs=[{field:"field.name",name:"Name"},{field:"field.type",name:"Type"},Object.assign({},(0,s.mkLinkGridCell)("Specification","specification.name","specification.id","main.physical-specification.view"),{width:"20%"}),{field:"specification.format",name:"Format"},{field:"specDefn.version",name:"Version"},{field:"specDefn.status",name:"Status"},{field:"field.description",name:"Description",width:"25%"}]},n.$onChanges=function(r){if(r.parentEntityRef&&n.parentEntityRef){n.selector=(0,l.mkSelectionOptions)(n.parentEntityRef);var s=t.loadViewData(o.CORE_API.PhysicalSpecDefinitionFieldStore.findBySelector,[n.selector]).then(function(e){return e.data}),c=t.loadViewData(o.CORE_API.PhysicalSpecDefinitionStore.findBySelector,[n.selector]).then(function(e){return e.data}),d=t.loadViewData(o.CORE_API.PhysicalSpecificationStore.findBySelector,[n.selector]).then(function(e){return e.data});e.all([s,c,d]).then(function(e){var t=i(e,3),o=t[0],r=t[1],l=t[2];n.physicalFields=o,n.physicalSpecDefns=r,n.physicalSpecs=l;var s=a.default.keyBy(r,"id"),c=a.default.keyBy(l,"id"),d=a.default.map(o,function(e){var t=s[e.specDefinitionId],n=c[t.specificationId];return Object.assign({},{field:e},{specDefn:t},{specification:n})});n.data=d})}},n.onGridInitialise=function(e){n.gridApi=e},n.exportGrid=function(){n.gridApi.exportFn("physical-fields.csv")}}p.$inject=["$q","ServiceBroker"];var f={template:c.default,bindings:{parentEntityRef:"<"},controller:p};t.default={component:f,id:"waltzRelatedPhysicalSpecDefnFieldSection"}},1300:function(e,t){e.exports="<div class=waltz-related-physical-spec-defn-field-section> <waltz-grid-with-search column-defs=$ctrl.columnDefs entries=$ctrl.data search-placeholder-text=Search... on-initialise=$ctrl.onGridInitialise> </waltz-grid-with-search> </div>"},1301:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=v(n(6)),a=v(n(1302)),o=v(n(1304)),r=v(n(1306)),l=v(n(1308)),s=v(n(1310)),c=n(7),d=m(n(1312)),u=m(n(1314)),p=m(n(1317)),f=v(n(1319));function m(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n]);return t.default=e,t}function v(e){return e&&e.__esModule?e:{default:e}}t.default=function(){var e=i.default.module("waltz.playpen",[]);return e.config(["$stateProvider",function(e){e.state("main.playpen",{url:"playpen",views:{"content@":{template:f.default}}}).state("main.playpen.1",{url:"/1",views:{"content@":a.default}}).state("main.playpen.2",{url:"/2",views:{"content@":o.default}}).state("main.playpen.3",{url:"/3?{id:int}",views:{"content@":r.default}}).state("main.playpen.4",{url:"/4?kind&{id:int}",views:{"content@":l.default}}).state("main.playpen.dyna-test",{url:"/dyna-test/{kind:string}/{id:int}/{sectionId:int}",views:{"content@":s.default}})}]),(0,c.registerComponents)(e,[u,p,d]),e.name}},1302:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});r(n(1));var i=r(n(1303)),a=n(2),o=n(0);n(155);function r(e){return e&&e.__esModule?e:{default:e}}var l={};function s(e,t,n){var i=(0,o.initialiseData)(this,l);i.$onInit=function(){n.execute(a.CORE_API.TaxonomyManagementStore.preview,[{changeType:"UPDATE_CONCRETENESS",changeDomain:{kind:"MEASURABLE_CATEGORY",id:4},a:{kind:"MEASURABLE",id:587},newValue:"false",createdBy:"admin"}]).then(function(e){return i.preview=e.data})}}s.$inject=["$element","$q","ServiceBroker"];var c={template:i.default,controller:s,controllerAs:"$ctrl",bindToController:!0,scope:{}};t.default=c},1303:function(e,t){e.exports='<div> <waltz-page-header name=Playpen small=1 icon=rocket> <ol class=waltz-breadcrumbs> <li><a ui-sref=main>Home</a></li> <li>Playpen</li> </ol> </waltz-page-header> <waltz-section name="Real Data"> <div class=row> <div class=col-sm-6> <waltz-taxonomy-change-command-preview preview=$ctrl.preview> </waltz-taxonomy-change-command-preview> </div> <div class=col-sm-6> <h1>Spacer</h1> </div> </div> </waltz-section> </div> '},1304:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=r(n(1)),a=n(2),o=r(n(1305));function r(e){return e&&e.__esModule?e:{default:e}}function l(e,t,n,o){var r=Object.assign(this,{});r.sourceColumns=["aS","bS","cS","dS"],r.targetColumns=[{name:"aT",required:!0},{name:"bT",required:!0},{name:"cT",required:!1},{name:"dT",required:!0},{name:"eT",required:!1}],r.newFlows=[{source:{id:155,kind:"APPLICATION",name:"Australian Kelpie Dog - 154",description:"All about Australian Kelpie Dog - 154"},target:{id:4142,kind:"APPLICATION",name:"Guinea Fowl - 4141",description:"All about Guinea Fowl - 4141"},dataType:{id:3e3,kind:"DATA_TYPE",name:"Pricing data",description:"Pricing"},provenance:"kam"},{source:{id:155,kind:"APPLICATION",name:"Australian Kelpie Dog - 154",description:"All about Australian Kelpie Dog - 154"},target:{id:4142,kind:"APPLICATION",name:"Guinea Fowl - 4141",description:"All about Guinea Fowl - 4141"},dataType:{id:1e3,kind:"DATA_TYPE",name:"Book Data",description:"Book data"},provenance:"kam"},{source:{id:174,kind:"APPLICATION",name:"Australian Kelpie Dog - 173",description:"All about Australian Kelpie Dog - 173"},target:{id:1258,kind:"APPLICATION",name:"Beagle - 1257",description:"All about Beagle - 1257"},dataType:{id:1e3,kind:"DATA_TYPE",name:"Book Data",description:"Book data"},provenance:"kam"},{source:{id:161,kind:"APPLICATION",name:"Balinese - 160",description:"All about Balinese - 160"},target:{id:1245,kind:"APPLICATION",name:"English Cocker Spaniel - 1244",description:"All about English Cocker Spaniel - 1244"},dataType:{id:1e3,kind:"DATA_TYPE",name:"Book Data",description:"Book data"},provenance:"kam"},{source:{id:180,kind:"APPLICATION",name:"Bombay - 179",description:"All about Bombay - 179"},target:{id:1264,kind:"APPLICATION",name:"Caiman - 1263",description:"All about Caiman - 1263"},dataType:{id:6e3,kind:"DATA_TYPE",name:"Currency",description:"Currency"},provenance:"kam"},{source:{id:175,kind:"APPLICATION",name:"Bull Shark - 174",description:"All about Bull Shark - 174"},target:{id:1259,kind:"APPLICATION",name:"River Dolphin - 1258",description:"All about River Dolphin - 1258"},dataType:{id:6e3,kind:"DATA_TYPE",name:"Currency",description:"Currency"},provenance:"kam"},{source:{id:162,kind:"APPLICATION",name:"Bulldog - 161",description:"All about Bulldog - 161"},target:{id:1246,kind:"APPLICATION",name:"Cheetah - 1245",description:"All about Cheetah - 1245"},dataType:{id:6e3,kind:"DATA_TYPE",name:"Currency",description:"Currency"},provenance:"kam"},{source:{id:169,kind:"APPLICATION",name:"Cavalier King Charles Spaniel - 168",description:"All about Cavalier King Charles Spaniel - 168"},target:{id:1253,kind:"APPLICATION",name:"Golden Lion Tamarin - 1252",description:"All about Golden Lion Tamarin - 1252"},dataType:{id:1e3,kind:"DATA_TYPE",name:"Book Data",description:"Book data"},provenance:"kam"}],r.onMappingsChanged=function(e){console.log("mappings changed: ",e.mappings,e.isComplete())},r.columnMappings={"source nar":{name:"source",required:!0},"target nar":{name:"target",required:!0},name:{name:"name",required:!0},"external id":{name:"externalId",required:!0},description:{name:"description",required:!0},frequency:{name:"frequency",required:!0},basis:{name:"basisOffset",required:!0},format:{name:"format",required:!0},transport:{name:"transport",required:!0},criticality:{name:"criticality",required:!0}},r.spreadsheetLoaded=function(e){console.log("spreadsheet loaded: ",e),r.sourceData=e.rowData},r.parserInitialised=function(e){console.log("parser init"),r.parseFlows=e.parseFlows},r.parseComplete=function(e){console.log("parse complete: ",e.data,e.isComplete()),r.validatedRows=e.data,r.uploadCmds=i.default.map(r.validatedRows,"originalCommand"),console.log("uploading: ",r.uploadCmds),r.uploadFlows()},r.uploaderInitialised=function(e){console.log("uploader initialised"),r.uploadFlows=e.uploadFlows},r.uploadComplete=function(e){console.log("upload complete: ",e)},r.validate=function(){r.parseFlows()},r.generate=function(){var e={sourceColumns:r.sourceColumns,targetColumns:r.targetColumns};o.loadViewData(a.CORE_API.SharedPreferenceStore.generateKeyRoute,[e],{force:!0}).then(function(e){console.log("key: ",e.data),o.execute(a.CORE_API.SharedPreferenceStore.save,[e.data,"physical-flow-upload-mapping",r.columnMappings]).then(function(e){return console.log("r2: ",e)})})}}l.$inject=["Notification","SvgDiagramStore","$element","ServiceBroker"];var s={template:o.default,controller:l,controllerAs:"ctrl",bindToController:!0,scope:{}};t.default=s},1305:function(e,t){e.exports='<div> <waltz-page-header name=Playpen small=2 icon=rocket> <ol class=waltz-breadcrumbs> <li><a ui-sref=main>Home</a></li> <li>Playpen</li> </ol> </waltz-page-header> <waltz-section name="Physical Flow Uploader"> <button class=btn ng-click=ctrl.generate()> Generate </button> </waltz-section> <waltz-section name=upload> <waltz-bulk-physical-flow-uploader flow-commands=ctrl.uploadCmds on-initialise=ctrl.uploaderInitialised on-upload-complete=ctrl.uploadComplete> </waltz-bulk-physical-flow-uploader> </waltz-section> <waltz-section name=parser> <button class=btn ng-click=ctrl.validate()> Validate </button> <waltz-bulk-physical-flow-parser column-mappings=ctrl.columnMappings source-data=ctrl.sourceData on-initialise=ctrl.parserInitialised on-parse-complete=ctrl.parseComplete> </waltz-bulk-physical-flow-parser> </waltz-section> <waltz-section name=loader> <waltz-spreadsheet-loader on-spreadsheet-loaded=ctrl.spreadsheetLoaded> </waltz-spreadsheet-loader> </waltz-section> </div> '},1306:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=n(0),a=function(e){return e&&e.__esModule?e:{default:e}}(n(1307));var o={parentEntityRef:{id:100,kind:"ORG_UNIT"}};function r(e,t){(0,i.initialiseData)(this,o)}r.$inject=["$stateParams","ServiceBroker"];var l={template:a.default,controller:r,controllerAs:"ctrl",bindToController:!0,scope:{}};t.default=l},1307:function(e,t){e.exports='<div> <waltz-section> <waltz-roadmaps-panel parent-entity-ref=ctrl.parentEntityRef> </waltz-roadmaps-panel> </waltz-section> <waltz-section name=debug> <pre ng-bind="ctrl.parentEntityRef | json"></pre> </waltz-section> </div> '},1308:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=n(0),a=function(e){return e&&e.__esModule?e:{default:e}}(n(1309));var o={parentEntityRef:{kind:"ORG_UNIT",id:6018},foo:"baa"};function r(e,t){(0,i.initialiseData)(this,o).$onInit=function(){}}r.$inject=["ServiceBroker","$stateParams"];var l={template:a.default,controller:r,controllerAs:"ctrl",bindToController:!0,scope:{}};t.default=l},1309:function(e,t){e.exports='<div> <waltz-page-header name="Playpen 4" icon=rocket> <ol class=waltz-breadcrumbs> <li><a ui-sref=main>Home</a></li> <li>Playpen</li> </ol> </waltz-page-header> <waltz-section name=boo> <waltz-drill-grid-panel parent-entity-ref=ctrl.parentEntityRef> </waltz-drill-grid-panel> </waltz-section> </div> '},1310:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=l(n(1)),a=n(0),o=n(31),r=l(n(1311));function l(e){return e&&e.__esModule?e:{default:e}}var s={parentEntityRef:{id:645,kind:"MEASURABLE"}};function c(e){var t=(0,a.initialiseData)(this,s);t.$onInit=function(){console.log("init",e),t.entityRef={kind:e.kind,id:e.id},t.section=i.default.find(o.dynamicSections,{id:e.sectionId})}}c.$inject=["$stateParams"];var d={template:r.default,controller:c,controllerAs:"ctrl"};t.default=d},1311:function(e,t){e.exports="<div style=padding-top:100px> <waltz-dynamic-section-wrapper section=ctrl.section parent-entity-ref=ctrl.entityRef> </waltz-dynamic-section-wrapper> </div> "},1312:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.id=t.component=void 0;var i=c(n(1)),a=c(n(1313)),o=n(0),r=n(2),l=n(25),s=n(12);function c(e){return e&&e.__esModule?e:{default:e}}var d={levels:[],levelStatsByKey:{}},u=(0,l.nest)().key(function(e){return(0,s.refToString)(e.logicalFlow.source)}).key(function(e){return e.dataTypeId}).rollup(function(e){return i.default.countBy(e,"rating")});function p(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return{DISCOURAGED:e.DISCOURAGED||0,PRIMARY:e.PRIMARY||0,SECONDARY:e.SECONDARY||0,NO_OPINION:e.NO_OPINION||0}}function f(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:[],a=u.entries(n);return i.default.each(a,function(n){i.default.each(n.values,function(a){var o=n.key+"/"+a.key,r=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[];if(t.length<e){var n=e-t.length,a=i.default.map(i.default.range(n),function(e){return p({})});return i.default.concat(t,a)}return i.default.concat(t,[])}(t+1,e[o]);r[t]=p(a.value),e[o]=r})}),e}function m(e){var t=(0,o.initialiseData)(this,d);t.loadNextLevel=function(){var n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],a=t.levels.length;if(!n.length){var o=t.levels[a-1];n=i.default.chain(o||[]).map(function(e){return e.logicalFlow.source}).uniqBy(s.refToString).value()}var l={logicalFlows:[],decorators:[]};return e.loadViewData(r.CORE_API.LogicalFlowStore.findUpstreamFlowsForEntityReferences,[n]).then(function(e){return e.data}).then(function(e){return l.logicalFlows=e,i.default.map(e,"id")}).then(function(t){return e.loadViewData(r.CORE_API.LogicalFlowDecoratorStore.findByFlowIdsAndKind,[t,"DATA_TYPE"])}).then(function(e){return l.decorators=e.data}).then(function(){var e=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[],n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:[],a=i.default.keyBy(t,"id");return i.default.map(n,function(t){return{level:e,dataTypeId:t.decoratorEntity.id,logicalFlow:a[t.dataFlowId],rating:t.rating}})}(a,l.logicalFlows,l.decorators);f(t.levelStatsByKey,a,e),t.levels=i.default.concat(t.levels,[e])}).then(function(){t.sources=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[],n=i.default.flatMap(e),a=i.default.chain(n).map("logicalFlow.source").keyBy(s.refToString).value(),o=u.entries(n);return i.default.chain(o).map(function(e){return{source:a[e.key],dataTypes:i.default.chain(e.values).map(function(n){return{dataType:t[n.key],counts:n.value,key:e.key+"/"+n.key}}).sortBy("dataType.name").value()}}).sortBy("source.name").value()}(t.levels,t.dataTypesById)})},t.$onInit=function(){var n=[t.parentEntityRef];e.loadAppData(r.CORE_API.DataTypeStore.findAll,[]).then(function(e){return t.dataTypesById=i.default.keyBy(e.data,"id")}).then(function(){return t.loadNextLevel(n)}).then(function(){return t.loadNextLevel()})},t.$onChanges=function(){}}m.$inject=["ServiceBroker"];t.component={bindings:{parentEntityRef:"<"},controller:m,template:a.default},t.id="waltzEntityDataSourcingPanel"},1313:function(e,t){e.exports=' <div> <button class="btn btn-primary" ng-click=$ctrl.loadNextLevel()>Load next level (curr: {{$ctrl.levels.length}})</button> <br> <table class="table table-condensed small"> <colgroup> <col width=40%> <col width=40%> <col width=30%> </colgroup> <thead> <tr> <th>Application</th> <th>Data Type</th> <th>Sourcing Overview</th> <th>Total</th> </tr> </thead> <tbody ng-repeat="appRow in $ctrl.sources"> <tr ng-repeat="dtRow in  appRow.dataTypes"> <td><span ng-if=$first ng-bind=appRow.source.name></span></td> <td><span ng-bind=dtRow.dataType.name></span></td> <td> <waltz-foo-widget data=$ctrl.levelStatsByKey[dtRow.key] keys="[ \'NO_OPINION\', \'DISCOURAGED\', \'SECONDARY\', \'PRIMARY\' ]"> </waltz-foo-widget> </td> </tr> </tbody> </table> </div>'},1314:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.id=t.component=void 0;var i=p(n(1)),a=n(5),o=n(83),r=n(405),l=p(n(1315)),s=n(0),c=n(44),d=n(2),u=n(1316);function p(e){return e&&e.__esModule?e:{default:e}}var f={svg:{w:1100,h:600}},m=(0,r.forceSimulation)().force("charge",(0,r.forceManyBody)().strength(-20)).force("collide",(0,r.forceCollide)(15)).force("x",(0,r.forceX)(f.svg.w/2).strength(.4).x(function(e){var t=f.svg.w/4*3,n=e.downstreams||[],a=i.default.flatMap(n,function(e){return e.fx?[e.fx,e.x]:[e.x]});return(i.default.min(a)||t)-100})).force("y",(0,r.forceY)(f.svg.h/2)).force("link",(0,r.forceLink)().id(function(e){return e.id}).distance(150));function v(e){a.event.active||m.alphaTarget(.1).restart(),e.fx=e.x,e.fy=e.y}function g(e){e.fx=a.event.x,e.fy=a.event.y}function y(e){a.event.active||m.alphaTarget(0).restart()}function h(e,t,n){var i=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[],n=e.selectAll((0,u.mkClassSelector)(u.Styles.FLOW)).data(t,function(e){return e.id}),i=n.enter().append("path").classed(u.Styles.FLOW,!0);return n.exit().remove(),i.merge(n)}(e.flows,t.flows),a=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[],n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},i=e.selectAll((0,u.mkClassSelector)(u.Styles.NODE)).data(t,function(e){return e.id}),a=i.enter().append("g").classed(u.Styles.NODE,!0);return a.on("dblclick",n.dblclick).call((0,o.drag)().on("start",v).on("drag",g).on("end",y)).call(u.addNodeSymbol).call(u.addNodeLabel),i.exit().remove(),i.merge(a)}(e.nodes,t.nodes,n.node);m.nodes(t.nodes).on("tick",function(){a.attr("transform",function(e){return"translate("+e.x+", "+e.y+")"}),i.call(c.lineWithArrowPath,.3)}),m.force("link").links(t.flows)}var w={};function b(e,t,n){var a=(0,s.initialiseData)(this,w),o={nodes:[],flows:[],filters:[],positionHints:{}},r={svg:null,nodes:null,flows:null,container:null};var l={node:{dblclick:function(e){return c(e.waltzData,!0)}}};function c(e,t){var r=(0,u.nodeToGraphId)(a.parentEntityRef);return n.loadViewData(d.CORE_API.LogicalFlowStore.findByEntityReference,[e]).then(function(n){var a=n.data;return t?i.default.filter(a,function(t){return t.target.kind===e.kind&&t.target.id===e.id}):a}).then(function(e){return function(e,t){o.nodes=(0,u.concatNodesFromFlows)(o.nodes,e),o.flows=(0,u.concatFlows)(o.flows,e),o.downstreams=(0,u.calcDownstreams)(o,i.default.map(e,u.flowToGraphId),t),o.nodes=i.default.map(o.nodes,function(e){return Object.assign({},e,{downstreams:o.downstreams[e.id]})})}(e,r)}).then(p)}function p(){m.alphaTarget(.01),m.restart(),h(r,o,l)}a.$onInit=function(){var t=e.find("div")[0];Object.assign(r,(0,u.prepareGroups)(t,f.svg)),c(a.parentEntityRef,!1).then(function(){return c({kind:"APPLICATION",id:137},!0)})}}b.$inject=["$element","$timeout","ServiceBroker"];t.component={bindings:{parentEntityRef:"<"},controller:b,template:l.default},t.id="waltzFlowExplorer"},1315:function(e,t){e.exports="<style></style> <div class=waltz-flow-explorer> </div>"},1316:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Styles=void 0,t.prepareGroups=function(e,t){var n=(0,a.select)(e).append("svg").attr("width",t.w).attr("height",t.h).attr("viewBox","0 0 "+t.w+" "+t.h),i=n.append("g").attr("transform","translate(0,0) scale(1)"),o=i.append("g").classed(r.FLOWS,!0),l=i.append("g").classed(r.NODES,!0);return{svg:n,container:i,flows:o,nodes:l}},t.mkClassSelector=function(e){return"."+e},t.addNodeSymbol=function(e){return e.filter(function(e){return"APPLICATION"===i.default.get(e,"waltzData.kind","APPLICATION")}).append("circle").classed(r.GLYPH,!0).attr("r",12),e.filter(function(e){return"ACTOR"===i.default.get(e,"waltzData.kind","APPLICATION")}).append("path").classed(r.GLYPH,!0).attr("d",l),e},t.addNodeLabel=function(e){return e.append("text").attr("text-anchor","middle").attr("dy","1.2em").text(function(e){return i.default.get(e,"waltzData.name","?")})},t.nodeToGraphId=s,t.flowToGraphId=c,t.concatNodesFromFlows=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[],n=i.default.chain(t).flatMap(function(e){return[e.source,e.target]}).map(function(e){return{id:s(e),waltzData:e,y:500}}).uniqBy("id").value();return i.default.unionBy(e,n,"id")},t.concatFlows=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[],n=i.default.map(t,function(e){return{id:c(e),waltzData:e,source:s(e.source),target:s(e.target)}}),a=i.default.map(e,function(e){return{id:e.id,waltzData:e.waltzData,source:i.default.isObject(e.source)?e.source.id:e.source,target:i.default.isObject(e.target)?e.target.id:e.source}});return i.default.unionBy(a,n,"id")},t.calcDownstreams=function(e,t,n){var a=Object.assign({},e.downstreams||{});a[n]=[];var o=i.default.groupBy(e.flows,"source"),r=i.default.keyBy(e.nodes,"id");return i.default.forEach(e.nodes,function(e){var t=i.default.chain(o[e.id]||[]).map("target").uniq().map(function(e){return r[e]}).value();a[e.id]=t}),a};var i=function(e){return e&&e.__esModule?e:{default:e}}(n(1)),a=n(5),o=n(82);var r=t.Styles={FLOW:"wfe-flow",FLOWS:"wfe-flows",NODE:"wfe-node",NODES:"wfe-nodes",GLYPH:"wfe-glyph"};var l=(0,o.symbol)().size(256).type(o.symbolWye);function s(e){return e.kind+"/"+e.id}function c(e){return"LOGICAL_FLOW/"+e.id}},1317:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.id=t.component=void 0;var i=c(n(1)),a=n(5),o=n(82),r=n(30),l=c(n(1318)),s=n(0);n(44);function c(e){return e&&e.__esModule?e:{default:e}}var d={STACK:"wfw-stack",LAYER:"wfw-layer",LAYER_CELL:"wfw-layer-cell"},u=5;var p={};function f(e,t){var n=e.selectAll("."+d.LAYER_CELL).data(function(e){return e});n.enter().append("rect").classed(d.LAYER_CELL,!0).merge(n).attr("width",t.x.bandwidth).attr("x",function(e){return t.x(e.data.level)}).attr("y",function(e){return t.y(e[1])}).attr("height",function(e){return t.y(e[0])-t.y(e[1])})}function m(e){var t=(0,s.initialiseData)(this,p);function n(){var e=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];return i.default.map(e||[],function(e,t){return Object.assign({},e,{level:t})})}(t.data),n=(0,o.stack)().keys(t.keys)(e),a=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],t=arguments[1],n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:[],a=i.default.chain(e).flatMap(function(e){return i.default.sum(i.default.map(n,function(t){return e[t]||0}))}).max().value(),o=(0,r.scaleLinear)().domain([0,a]).range([t.h,0]);return{x:(0,r.scaleBand)().domain(i.default.range(0,Math.ceil(e.length/u)*u)).range([0,t.w]).padding(.2),y:o}}(e,t.dimensions,t.keys);!function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:[],i=arguments[3],a=e.selectAll("."+d.LAYER).data(t),o=a.enter().append("g").classed(d.LAYER,!0).attr("data-key",function(e,t){return n[t]});a.merge(o).call(f,i)}(t.svg,n,t.keys,a)}t.$onInit=function(){var i=e.find("div")[0];t.dimensions=function(e){return{w:e.clientWidth,h:e.clientHeight}}(i),t.svg=function(e,t){return(0,a.select)(e).append("svg").attr("width",t.w).attr("height",t.h).attr("viewBox","0 0 "+t.w+" "+t.h)}(i,t.dimensions),n()},t.$onChanges=function(){t.svg&&n()}}m.$inject=["$element"];t.component={bindings:{data:"<",keys:"<"},controller:m,template:l.default},t.id="waltzFooWidget"},1318:function(e,t){e.exports="<div class=waltz-foo-widget> </div>"},1319:function(e,t){e.exports="<div> <waltz-page-header name=Playpen small=List icon=rocket> <ol class=waltz-breadcrumbs> <li><a ui-sref=main>Home</a></li> <li>Playpen</li> </ol> </waltz-page-header> <waltz-section name=Playpens> <ul> <li><a ui-sref=main.playpen.1>Playpen 1</a></li> <li><a ui-sref=main.playpen.2>Playpen 2</a></li> <li><a ui-sref=main.playpen.3>Playpen 3</a></li> </ul> </waltz-section> </div> "},1320:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=o(n(6)),a=o(n(1321));function o(e){return e&&e.__esModule?e:{default:e}}t.default=function(){var e=i.default.module("waltz.playpen5",[]);return e.config(["$stateProvider",function(e){e.state("main.playpen.5",{url:"/5",views:{"content@":a.default}})}]),e.name}},1321:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=function(e){return e&&e.__esModule?e:{default:e}}(n(1322));var a={};function o(){Object.assign(this,a).entityReference={kind:"CHANGE_INITIATIVE",id:1}}o.$inject=[];var r={template:i.default,controller:o,controllerAs:"ctrl",bindToController:!0,scope:{}};t.default=r},1322:function(e,t){e.exports='<div> <waltz-page-header name="Playpen 5" icon=rocket> <ol class=waltz-breadcrumbs> <li><a ui-sref=main>Home</a></li> <li>Playpen 5</li> </ol> </waltz-page-header> <waltz-section> <waltz-assessment-rating-sub-section parent-entity-ref=ctrl.entityReference> </waltz-assessment-rating-sub-section> </waltz-section> <waltz-section> <waltz-assessment-rating-editor parent-entity-ref=ctrl.entityReference> </waltz-assessment-rating-editor> </waltz-section> <waltz-section> <waltz-assessment-rating-panel parent-entity-ref=ctrl.entityReference> </waltz-assessment-rating-panel> </waltz-section> </div> '},1323:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=o(n(6)),a=o(n(1324));function o(e){return e&&e.__esModule?e:{default:e}}t.default=function(){var e=i.default.module("waltz.profile",[]);return e.config(a.default),e.name}},1324:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i={url:"profile"},a={url:"/view/{userId:string}",views:{"content@":function(e){return e&&e.__esModule?e:{default:e}}(n(1325)).default}};function o(e){e.state("main.profile",i).state("main.profile.view",a)}o.$inject=["$stateProvider"],t.default=o},1325:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=function(){return function(e,t){if(Array.isArray(e))return e;if(Symbol.iterator in Object(e))return function(e,t){var n=[],i=!0,a=!1,o=void 0;try{for(var r,l=e[Symbol.iterator]();!(i=(r=l.next()).done)&&(n.push(r.value),!t||n.length!==t);i=!0);}catch(e){a=!0,o=e}finally{try{!i&&l.return&&l.return()}finally{if(a)throw o}}return n}(e,t);throw new TypeError("Invalid attempt to destructure non-iterable instance")}}(),a=n(31),o=function(e){return e&&e.__esModule?e:{default:e}}(n(1326));var r={changeLogSection:a.dynamicSections.changeLogSection,contribution:{score:0,directScores:[],leaderBoard:[]},directs:[],managers:[],person:null,roles:[],user:null,passwordResetEnabled:!1};function l(e,t,n,a,o,l,s){var c=Object.assign(this,r),d=t.userId;c.userId=d,n.findByUserId(d).then(function(e){return c.person=e}).then(function(e){if(e){var t=e.employeeId;n.findManagers(t).then(function(e){return c.managers=e}),n.findDirects(t).then(function(e){return c.directs=e})}}),l.findForUserId(d).then(function(e){return c.user=e}),o.findForUserId(d).then(function(e){return c.contribution.score=e}),o.findForDirects(d).then(function(e){return c.contribution.directScores=e}),o.getLeaderBoard().then(function(e){return c.contribution.leaderBoard=e}),e.all([s.whoami(),a.findOrDefault("web.authentication",null)]).then(function(e){var t=i(e,2),n=t[0],a=t[1];return c.passwordResetEnabled=n.userName===d&&"waltz"===a}),c.resetPassword=function(){c.resetForm.password1===c.resetForm.password2?c.resetForm.password1.length<4?alert("Password too short (requires >= 4 chars)"):l.resetPassword(c.userId,c.resetForm.password1,c.resetForm.currentPassword).then(function(e){e?alert("Password updated"):alert("Password reset failed")}):alert("Passwords do not match!")}}l.$inject=["$q","$stateParams","PersonStore","SettingsService","UserContributionStore","UserStore","UserService"];var s={template:o.default,controller:l,controllerAs:"ctrl"};t.default=s},1326:function(e,t){e.exports='<div> <waltz-page-header icon=user name="{{ ctrl.person.displayName || ctrl.userId}}" small=profile> <ol class=waltz-breadcrumbs> <li><a ui-sref=main>Home</a></li> <li>Profile</li> <li ng-bind="ctrl.person.displayName || ctrl.userId"></li> </ol> </waltz-page-header> <div class=row> <div class=col-sm-12> <div ng-class="{ \'ws-inactive\' : ctrl.person.isRemoved }"> <div class="waltz-page-summary-attach waltz-page-summary" name=Summary> <div ng-if=ctrl.person> <div class=row> <div class=col-sm-6> <table class="table table-condensed"> <thead> <tr> <th colspan=2> Profile </th> </tr> </thead> <tbody> <tr> <td><strong>Name</strong></td> <td class=waltz-visibility-parent> <span ng-bind=ctrl.person.displayName></span> <strong class=waltz-visibility-child-30 ng-if=ctrl.person.isRemoved>[ Inactive ]</strong> </td> </tr> <tr> <td><strong>Email</strong></td> <td><span ng-bind=ctrl.person.email></span></td> </tr> <tr> <td><strong>Phone</strong></td> <td><span ng-bind=ctrl.person.officePhone></span></td> </tr> <tr> <td><strong>Employee Id</strong></td> <td><span ng-bind=ctrl.person.employeeId></span></td> </tr> <tr> <td><strong>Person Page</strong></td> <td> <a ui-sref="main.person.view ({ empId: ctrl.person.employeeId })">View</a> </td> </tr> </tbody> </table> </div> <div class=col-sm-3> <table class="table table-condensed"> <thead> <tr> <th>Managers</th> </tr> </thead> <tbody> <tr ng-repeat="manager in ctrl.managers"> <td> <a ui-sref="main.profile.view ({userId: manager.userId})" ng-bind=manager.displayName> </a> </td> </tr> </tbody> </table> </div> <div class=col-sm-3 ng-if="ctrl.directs.length > 0"> <table class="table table-condensed"> <thead> <tr> <th>Direct Reportees</th> </tr> </thead> <tbody> <tr ng-repeat="direct in ctrl.directs"> <td> <a ui-sref="main.profile.view ({userId: direct.userId})" ng-bind=direct.displayName> </a> </td> </tr> </tbody> </table> </div> </div> <div class=row ng-if=ctrl.passwordResetEnabled> <hr> <div class=col-md-12> <div ng-if=!ctrl.passwordResetShowing> <button ng-click="ctrl.passwordResetShowing = true" class="btn btn-xs btn-warning"> Reset password </button> </div> <div ng-if=ctrl.passwordResetShowing> <form novalidate ng-submit=ctrl.resetPassword()> <div class=form-group> <label for=currentPassword>Current password</label> <input ng-model=ctrl.resetForm.currentPassword id=currentPassword type=password name=currentPassword class=form-control placeholder="Enter current password" autofocus=true autocomplete=off required> </div> <div class=form-group> <label for=password1>Password</label> <input ng-model=ctrl.resetForm.password1 type=password id=password1 name=password1 class=form-control placeholder="Enter new password" required> </div> <div class=form-group> <label for=password2>Repeat Password</label> <input ng-model=ctrl.resetForm.password2 type=password id=password2 name=password2 class=form-control placeholder="enter password again" required> </div> <div class=form-group> <button class="btn btn-primary">Reset password</button> <a class=clickable ng-click="ctrl.passwordResetShowing = false">Cancel</a> </div> </form> </div> </div> </div> </div> <waltz-no-data ng-if=!ctrl.person> <message>No profile information for this user</message> </waltz-no-data> </div> </div> <br> <waltz-section name="Contribution Scores" ng-if=ctrl.person> <div class=row> <div class=col-sm-4> <table class=table> <thead> <tr> <th>User</th> <th>Score</th> </tr> </thead> <tr> <td> <span ng-bind=ctrl.person.displayName> </span> </td> <td> <span ng-bind=ctrl.contribution.score class="label label-info"> </span> </td> </tr> </table> </div> <div class=col-sm-4 ng-if="ctrl.contribution.directScores.length > 0"> <table class=table> <thead> <tr> <th>Directs</th> <th>Score</th> </tr> </thead> <tr ng-repeat="direct in ctrl.contribution.directScores"> <td> <a ui-sref="main.profile.view ({userId: direct.id})" ng-bind=direct.id> </a> </td> <td> <span class="label label-info" ng-bind=direct.count></span> </td> </tr> </table> </div> <div class=col-sm-4> <table class=table> <thead> <tr> <th>Leader Board</th> <th>Score</th> </tr> </thead> <tr ng-repeat="user in ctrl.contribution.leaderBoard"> <td> <a ui-sref="main.profile.view ({userId: user.id})" ng-bind=user.id> </a> </td> <td> <span class="label label-info" ng-bind=user.count></span> </td> </tr> </table> </div> </div> </waltz-section> <waltz-section name=Permissions ng-if=ctrl.person> <div ng-if="ctrl.user.roles.length > 0"> This user has the following permissions: <ul class=list-inline> <li ng-repeat="perm in ctrl.user.roles | orderBy" style=padding-top:5px;padding-bottom:5px> <span class="label label-info" ng-bind=perm></span> </li> </ul> </div> <div class="alert alert-info" ng-if="ctrl.user.roles.length == 0"> No permissions </div> </waltz-section> <waltz-dynamic-section-wrapper section=ctrl.changeLogSection parent-entity-ref=ctrl.person ng-if=ctrl.person> </waltz-dynamic-section-wrapper> </div> </div> </div>'},1327:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=d(n(6)),a=function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n]);return t.default=e,t}(n(248)),o=n(7),r=d(n(1328)),l=d(n(1330)),s=d(n(1332)),c=d(n(1334));function d(e){return e&&e.__esModule?e:{default:e}}t.default=function(){var e=i.default.module("waltz.ratings",[]);return(0,o.registerComponents)(e,[l.default,c.default,r.default,s.default]),(0,o.registerStores)(e,[a]),e.name}},1328:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=n(0),a=s(n(1)),o=n(2),r=n(19),l=s(n(1329));function s(e){return e&&e.__esModule?e:{default:e}}var c={pickerStyle:{},onSelect:function(e){return"No onSelect handler defined for rating-picker: "+e}};function d(e){var t=this,n=this;n.$onInit=function(){return(0,i.initialiseData)(t,c)},n.$onChanges=function(t){t.schemeId&&n.schemeId&&e.loadAppData(o.CORE_API.RatingSchemeStore.getById,[n.schemeId]).then(function(e){return n.options=a.default.chain(e.data.ratings).filter(function(e){return e.userSelectable}).map(function(e){return Object.assign({},e,{foregroundColor:(0,r.determineForegroundColor)(e.color)})}).orderBy(function(e){return e.position}).value()}),t.disabled&&(n.pickerStyle=n.disabled?{opacity:.4}:[])}}d.$inject=["ServiceBroker"];var u={bindings:{selected:"<",editDisabled:"<",onSelect:"<",onKeypress:"<",schemeId:"<"},template:l.default,controller:d};t.default={id:"waltzRatingPicker",component:u}},1329:function(e,t){e.exports='<div class=waltz-rating-picker tabindex=1 ng-keydown=$ctrl.onKeypress($event) ng-style=$ctrl.pickerStyle> <div ng-repeat="option in $ctrl.options track by option.rating" class=wrp-option> <input type=radio value="{{ option.rating }}" ng-model=$ctrl.selected ng-disabled=$ctrl.editDisabled ng-change=$ctrl.onSelect(option.rating) id="wrp-inp-{{ option.rating }}-{{ $id }}"> <label for="wrp-inp-{{ option.rating }}-{{ $id }}" ng-style="{ \'background-color\': option.color, color: option.foregroundColor }" ng-bind=option.name class=clickable> </label> <div class="small text-muted" ng-if=option.description ng-bind=option.description> </div> </div> </div>'},1330:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=function(e){return e&&e.__esModule?e:{default:e}}(n(1331)),a=n(0);var o={showName:!1};function r(){(0,a.initialiseData)(this,o)}r.$inject=[];var l={template:i.default,bindings:{rating:"<",showName:"<"},controller:r};t.default={id:"waltzRatingIndicatorCell",component:l}},1331:function(e,t){e.exports="<span class=wric-cell ng-style=\"{ 'background-color': $ctrl.rating.color }\"> </span> <span ng-if=$ctrl.showName ng-bind=$ctrl.rating.name> </span> "},1332:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=function(e){return e&&e.__esModule?e:{default:e}}(n(1333));function a(){}a.$inject=[];var o={template:i.default,bindings:{ratingScheme:"<"},controller:a};t.default={component:o,id:"waltzRatingSchemeLegend"}},1333:function(e,t){e.exports='<div> <span ng-bind=$ctrl.ratingScheme.name></span> <span ng-bind=$ctrl.ratingScheme.description class="text-muted small"> </span> <ul class="list-unstyled small"> <li ng-repeat="rating in $ctrl.ratingScheme.ratings"> <waltz-rating-indicator-cell rating=rating show-name=true> </waltz-rating-indicator-cell> <div class="small text-muted" ng-if=rating.description ng-bind=rating.description> </div> </li> </ul> </div>'},1334:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=function(e){return e&&e.__esModule?e:{default:e}}(n(1)),a=n(5),o=n(30);n(45);function r(e){var t=this,n=(0,a.select)(e[0]).select("svg").attrs({width:"250px",height:"3px"});t.$onChanges=function(){t.scores&&t.range&&t.ratingSchemeItems&&function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[0,0],a=arguments[2],r=(0,o.scaleLinear)().domain([0,t[1]]).range([0,250]),l=0,s=i.default.chain(a).filter(function(t){return e[t.rating]>0}).map(function(t){var n=e[t.rating],i=Object.assign({},t,{start:l,width:n});return l+=n,i}).value(),c=n.selectAll("rect").data(s,function(e){return e.rating});c.enter().append("rect").attr("fill",function(e){return e.color}).attr("height",3).attr("y",0).merge(c).attr("x",function(e){return r(e.start)}).attr("width",function(e){return r(e.width)})}(t.scores,t.range,t.ratingSchemeItems)}}r.$inject=["$element"];var l={template:'<svg class="rag-line"></svg>',bindings:{scores:"<",range:"<",ratingSchemeItems:"<"},controller:r};t.default={id:"waltzRagLine",component:l}},1335:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=f(n(6)),a=f(n(1336)),o=f(n(1338)),r=f(n(1340)),l=f(n(1342)),s=f(n(1344)),c=f(n(1346)),d=f(n(249)),u=f(n(1348)),p=n(7);function f(e){return e&&e.__esModule?e:{default:e}}t.default=function(){var e=i.default.module("waltz.roadmap",[]);return e.config(u.default),(0,p.registerComponents)(e,[a.default,r.default,s.default,l.default,c.default,o.default]),(0,p.registerStores)(e,[d.default]),e.name}},1336:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=n(0),a=n(2),o=n(12),r=function(e){return e&&e.__esModule?e:{default:e}}(n(1337));var l={};function s(e){return(0,i.notEmpty)(e.name)&&(0,i.notEmpty)(e.columnType)&&(0,i.notEmpty)(e.rowType)&&(0,i.notEmpty)(e.ratingScheme)}function c(e){var t=(0,i.initialiseData)(this,l);t.$onInit=function(){e.loadAppData(a.CORE_API.MeasurableCategoryStore.findAll).then(function(e){t.axisOptions=e.data}),e.loadAppData(a.CORE_API.RatingSchemeStore.findAll).then(function(e){t.ratingSchemes=e.data})},t.onFormChange=function(){t.preventSubmit=!s(t.model)},t.onAdd=function(){var e=function(e){return s(e)?{name:e.name,rowType:(0,o.toEntityRef)(e.rowType),columnType:(0,o.toEntityRef)(e.columnType),ratingSchemeId:e.ratingScheme.id}:null}(t.model);return t.onAddRoadmap(e)}}c.$inject=["ServiceBroker"];var d={controller:c,template:r.default,bindings:{onAddRoadmap:"<",onCancel:"<"}};t.default={id:"waltzAddRoadmap",component:d}},1337:function(e,t){e.exports='<div> <h4>Add New Roadmap</h4> <table class="table table-condensed small"> <colgroup> <col width=30%> <col width=30%> <col width=40%> </colgroup> <tr> <td> Name: </td> <td> <input class="form-control input-sm" ng-model=$ctrl.model.name ng-change=$ctrl.onFormChange() placeholder=name> <p class=help-block> A descriptive name, should not include temporal aspects. e.g. `Finance 2020` is <strong>not</strong> a good name, `Finance Product Roadmap` is a better name. </p> </td> <td></td> </tr> <tr> <td>Rating Scheme:</td> <td> <select ng-model=$ctrl.model.ratingScheme ng-change=$ctrl.onFormChange() ng-options="option.name for option in $ctrl.ratingSchemes track by option.id"> </select> <p class=help-block> The rating scheme defines the which set of ratings can be assigned to applications appearing in the roadmap scenarios. This is set at the roadmap level to ensure a common scheme between scenarios belonging to the same roadmap. </p> </td> <td> <waltz-rating-scheme-legend rating-scheme=$ctrl.model.ratingScheme> </waltz-rating-scheme-legend> </td> </tr> <tr> <td>Column Domain:</td> <td> <select ng-model=$ctrl.model.columnType ng-change=$ctrl.onFormChange() ng-options="option.name for option in $ctrl.axisOptions track by option.id"> </select> </td> <td></td> </tr> <tr> <td>Row Domain:</td> <td> <select ng-model=$ctrl.model.rowType ng-change=$ctrl.onFormChange() ng-options="option.name for option in $ctrl.axisOptions track by option.id"> </select> </td> <td></td> </tr> <tr> <td></td> <td> <button ng-click=$ctrl.onAdd() class="btn btn-success btn-sm" ng-disabled=$ctrl.preventSubmit> Add Roadmap </button> <a ng-click=$ctrl.onCancel() class=clickable> Cancel </a> </td> <td></td> </tr> </table> </div> '},1338:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=function(e){return e&&e.__esModule?e:{default:e}}(n(1339)),a=n(0),o=n(2);var r={LOADING:"LOADING",VIEW:"VIEW"},l={modes:r,ratingScheme:null,roadmap:null,visibility:{mode:r.LOADING}},s=function(e,t){t&&e.put(t.name,"ROADMAP","main.roadmap.view",{id:t.id})};function c(e,t,n,i){var c=(0,a.initialiseData)(this,l);function d(e,t,a){var o=!(arguments.length>3&&void 0!==arguments[3])||arguments[3],r=arguments.length>4&&void 0!==arguments[4]?arguments[4]:"Updated";return o&&_.isEmpty(a.newVal)&&!_.isDate(a.newVal)?Promise.reject("Waltz:updateField - Cannot set an empty value"):a.newVal!==a.oldVal?n.execute(t,[e,a.newVal]).then(function(){return i.success(r)}):Promise.reject("Nothing updated")}function u(){var t=n.loadViewData(o.CORE_API.RoadmapStore.getRoadmapById,[c.roadmapId],{force:!0}).then(function(e){return c.roadmap=e.data});return e.all([t]).then(function(){return n.loadViewData(o.CORE_API.RatingSchemeStore.getById,[c.roadmap.ratingSchemeId]).then(function(e){return c.ratingScheme=e.data})})}c.$onInit=function(){c.visibility.mode=r.LOADING,u().then(function(){c.visibility.mode=r.VIEW,s(t,c.roadmap)})},c.onSaveRoadmapName=function(e,t){return d(e.id,o.CORE_API.RoadmapStore.updateName,t,!0,"Roadmap name updated").then(function(){return u()})},c.onSaveRoadmapDescription=function(e,t){return d(e.id,o.CORE_API.RoadmapStore.updateDescription,t,!1,"Roadmap description updated").then(function(){return u()})},c.onCancel=function(){c.visibility.mode=r.LIST,c.selectedScenario=null,u()},c.markActive=function(){return d(c.roadmap.id,o.CORE_API.RoadmapStore.updateLifecycleStatus,{newVal:"ACTIVE",oldVal:c.roadmap.entityLifecycleStatus},!0,"Roadmap restored").then(function(){return u()})},c.markRemoved=function(){return d(c.roadmap.id,o.CORE_API.RoadmapStore.updateLifecycleStatus,{newVal:"REMOVED",oldVal:c.roadmap.entityLifecycleStatus},!0,"Roadmap deleted").then(function(){return u()})}}c.$inject=["$q","HistoryStore","ServiceBroker","Notification"];var d={bindings:{roadmapId:"<"},template:i.default,controller:c};t.default={id:"waltzRoadmapHeader",component:d}},1339:function(e,t){e.exports='<waltz-page-header name="{{ $ctrl.roadmap.name }}" icon=road small=Roadmap> <ol class=waltz-breadcrumbs> <li><a ui-sref=main>Home</a></li> <li>Roadmaps</li> <li><span ng-bind=$ctrl.roadmap.name></span></li> </ol> </waltz-page-header> <div class="waltz-page-summary waltz-page-summary-attach" ng-class="{\'ws-inactive\': $ctrl.roadmap.entityLifecycleStatus === \'REMOVED\'}"> <waltz-section-actions> <a class="btn btn-success btn-xs" waltz-has-role=SCENARIO_ADMIN ng-if="$ctrl.roadmap.entityLifecycleStatus === \'REMOVED\'" ng-click=$ctrl.markActive()> Restore </a> <a class="btn btn-danger btn-xs" waltz-has-role=SCENARIO_ADMIN ng-if="$ctrl.roadmap.entityLifecycleStatus === \'ACTIVE\'" ng-click=$ctrl.markRemoved()> Delete </a> </waltz-section-actions> <div ng-switch=$ctrl.visibility.mode> <div ng-switch-when=LOADING> <waltz-loading-notification name="Loading roadmap"> </waltz-loading-notification> </div> <div ng-switch-when=VIEW> <div class=row> <div class=col-sm-3> <label>Name:</label> </div> <div class=col-sm-9> <waltz-editable-field field-type=text on-save=$ctrl.onSaveRoadmapName item-id=$ctrl.roadmap save-label=Save edit-role=SCENARIO_ADMIN initial-val=$ctrl.roadmap.name> </waltz-editable-field> </div> </div> <div class=row> <div class=col-sm-3> <label>Dimensions:</label> </div> <div class=col-sm-9> <div> <span ng-bind=$ctrl.roadmap.columnType.name></span> / <span ng-bind=$ctrl.roadmap.rowType.name></span> </div> <p class="help-block small"> Column Domain / Row Domain </p> </div> </div> <div class=row> <div class=col-sm-3> <label>Description:</label> </div> <div class=col-sm-9> <waltz-editable-field field-type=textarea on-save=$ctrl.onSaveRoadmapDescription item-id=$ctrl.roadmap save-label=Save initial-val=$ctrl.roadmap.description empty-label="No description provided" edit-role=SCENARIO_ADMIN class=text-muted> </waltz-editable-field> </div> </div> <div class=row> <div class=col-sm-3> <label>Rating Scheme:</label> </div> <div class=col-sm-9> <waltz-rating-scheme-legend rating-scheme=$ctrl.ratingScheme> </waltz-rating-scheme-legend> </div> </div> </div> </div> </div> '},1340:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=s(n(1341)),a=n(0),o=s(n(53)),r=n(2),l=s(n(1));function s(e){return e&&e.__esModule?e:{default:e}}var c={LOADING:"LOADING",VIEW:"VIEW",ADD:"ADD"},d={permissions:{admin:!1,edit:!1},mode:c.LOADING,visibility:{subSection:!1,controls:!1}};function u(e,t,n){var i=(0,a.initialiseData)(this,d);function s(){var e=function(e){switch(e){case"APPLICATION":return r.CORE_API.RoadmapStore.findRoadmapsAndScenariosByRatedEntity;default:return r.CORE_API.RoadmapStore.findRoadmapsAndScenariosByFormalRelationship}}(i.parentEntityRef.kind);return t.loadViewData(e,[i.parentEntityRef],{force:!0}).then(function(e){i.references=e.data,i.mode=c.VIEW,i.visibility.subSection=i.visibility.subSection||!l.default.isEmpty(i.references)})}i.$onInit=function(){s(),n.whoami().then(function(e){i.permissions={admin:n.hasRole(e,o.default.SCENARIO_ADMIN),edit:n.hasRole(e,o.default.SCENARIO_EDITOR)},i.visibility.subSection=i.permissions.admin||!l.default.isEmpty(i.references),i.visibility.controls=i.permissions.admin&&"APPLICATION"!==i.parentEntityRef.kind})},i.onShowAddRoadmap=function(){i.permissions.admin&&(i.mode=c.ADD)},i.onAddRoadmap=function(n){var a=Object.assign({},n,{linkedEntity:i.parentEntityRef});return t.execute(r.CORE_API.RoadmapStore.addRoadmap,[a]).then(function(){e.success('Roadmap "'+n.name+'" created'),i.mode=c.LOADING,s()})},i.onCancel=function(){i.mode=c.VIEW}}u.$inject=["Notification","ServiceBroker","UserService"];var p={controller:u,template:i.default,bindings:{parentEntityRef:"<"}};t.default={id:"waltzRoadmapReferences",component:p}},1341:function(e,t){e.exports=' <waltz-sub-section name=Roadmaps ng-if=$ctrl.visibility.subSection> <content> <div style=margin:8px> <div ng-switch=$ctrl.mode> <div ng-switch-when=LOADING> <waltz-loading-notification show=true name="Looking for associated roadmaps"> </waltz-loading-notification> </div> <div ng-switch-when=ADD> <waltz-add-roadmap on-add-roadmap=$ctrl.onAddRoadmap on-cancel=$ctrl.onCancel> </waltz-add-roadmap> </div> <div ng-switch-when=VIEW> <p> This entity appears in the following roadmap/scenarios </p> <div ng-if="$ctrl.references.length === 0"> <waltz-no-data> <message> <strong>Not linked</strong>to any roadmap scenarios. <br> <a ng-if=$ctrl.permissions.admin class=clickable ng-click=$ctrl.onShowAddRoadmap()> <waltz-icon name=plus></waltz-icon> Add Roadmap? </a> </message> </waltz-no-data> <br> </div> <table class="table table-condensed" ng-if="$ctrl.references.length > 0"> <thead> <tr> <th>Roadmap</th> <th>Scenario</th> <th>Effective Date</th> <th>Type</th> <th>State</th> </tr> </thead> <tbody ng-repeat="ref in $ctrl.references"> <tr ng-if="ref.scenarios.length === 0"> <td> <a ui-sref="main.roadmap.view ({id: ref.roadmap.id })"> <span uib-popover-template="\'wrar-roadmap-popover.html\'" popover-trigger=mouseenter popover-append-to-body=true popover-placement=top ng-bind=ref.roadmap.name> </span> </a> </td> <td> - </td> <td> - </td> <td> - </td> <td> - </td> </tr> <tr ng-repeat="scenario in ref.scenarios" ng-if="ref.scenarios.length > 0"> <td> <a ui-sref="main.roadmap.view ({id: ref.roadmap.id })"> <span ng-if=$first uib-popover-template="\'wrar-roadmap-popover.html\'" popover-trigger=mouseenter popover-append-to-body=true popover-placement=top ng-bind=ref.roadmap.name> </span> </a> </td> <td> <a ui-sref="main.scenario.view ({ id: scenario.id })"> <span ng-bind=scenario.name uib-popover-template="\'wrar-scenario-popover.html\'" popover-trigger=mouseenter popover-append-to-body=true popover-placement=top> </span> </a> </td> <td> <span ng-bind=scenario.effectiveDate> </span> </td> <td> <span ng-bind="scenario.scenarioType | toDisplayName:\'scenarioType\'"> </span> </td> <td> <span ng-bind="scenario.releaseStatus | toDisplayName:\'releaseLifecycleStatus\'"> </span> </td> </tr> </tbody> </table> </div> </div> </div> <div class=waltz-sub-section-controls ng-if=$ctrl.visibility.controls> <div ng-switch=$ctrl.mode> <div ng-switch-when=VIEW> <span ng-if=$ctrl.permissions.admin> <a class=clickable ng-click=$ctrl.onShowAddRoadmap()> <waltz-icon name=plus></waltz-icon> Add Roadmap </a> </span> </div> <div ng-switch-when=ADD> <span ng-if=$ctrl.permissions.admin> <a class=clickable ng-click=$ctrl.onCancel()> Cancel </a> </span> </div> </div> </div> </content> </waltz-sub-section> <script type=text/ng-template id=wrar-roadmap-popover.html> <div class="small">\n        <h5>\n            <span ng-bind="ref.roadmap.name"></span>\n            <small>Roadmap</small>\n        </h5>\n\n        <waltz-markdown text="ref.roadmap.description">\n        </waltz-markdown>\n\n        <hr>\n\n        <label>Dimensions:</label>\n        <br>\n        <span ng-bind="::ref.roadmap.columnType.name"></span>\n        /\n        <span ng-bind="::ref.roadmap.rowType.name"></span>\n    </div> <\/script> <script type=text/ng-template id=wrar-scenario-popover.html> <div class="small">\n        <h5>\n            <span ng-bind="scenario.name"></span>\n            <small>Scenario</small>\n        </h5>\n\n        <waltz-markdown text="scenario.description">\n        </waltz-markdown>\n\n        <hr>\n\n        <waltz-last-updated entity="scenario">\n        </waltz-last-updated>\n    </div> <\/script>'},1342:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=function(e){return e&&e.__esModule?e:{default:e}}(n(1343)),a=n(0),o=n(2);var r={scenario:null};function l(e,t){var n=(0,a.initialiseData)(this,r);function i(){return t.loadViewData(o.CORE_API.ScenarioStore.getById,[n.scenarioId],{force:!0}).then(function(e){return Object.assign(n,e.data)})}n.$onInit=function(){i()},n.onSaveName=function(e,t){n.onSaveScenarioName(e,t).then(function(){return i()})},n.onSaveDescription=function(e,t){n.onSaveScenarioDescription(e,t).then(function(){return i()})},n.onSaveEffectiveDate=function(e,t){n.onSaveScenarioEffectiveDate(e,t).then(function(){return i()})}}l.$inject=["$q","ServiceBroker"];var s={controller:l,template:i.default,bindings:{scenarioId:"<",onCancel:"<",onSaveScenarioName:"<",onSaveScenarioDescription:"<",onSaveScenarioEffectiveDate:"<",onSaveScenarioType:"<",onAddAxisItem:"<",onRemoveAxisItem:"<",onRepositionAxisItems:"<"}};t.default={component:s,id:"waltzRoadmapScenarioConfig"}},1343:function(e,t){e.exports='<div> <table class="table table-condensed small"> <colgroup> <col width=30%> <col width=70%> </colgroup> <tr> <td>Name:</td> <td> <waltz-editable-field field-type=text on-save=$ctrl.onSaveName item-id=$ctrl.scenario save-label=Save initial-val=$ctrl.scenario.name> </waltz-editable-field> </td> </tr> <tr> <td>Effective Date:</td> <td> <waltz-editable-field field-type=date on-save=$ctrl.onSaveEffectiveDate item-id=$ctrl.scenario save-label=Save initial-val=$ctrl.scenario.effectiveDate> </waltz-editable-field> </td> </tr> <tr> <td>Scenario Type:</td> <td> <waltz-editable-enum enum-kind=scenarioType on-save=$ctrl.onSaveScenarioType ctx=$ctrl.scenario save-label=Save initial-val=$ctrl.scenario.scenarioType> </waltz-editable-enum> </td> </tr> <tr> <td> Columns: <p class=help-block> ( <span ng-bind="$ctrl.roadmap.columnType.id | toDisplayName:\'measurableCategory\'"></span> ) </p> </td> <td> <waltz-roadmap-scenario-axis-config axis-domain=$ctrl.roadmap.columnType axis-orientation=COLUMN scenario-id=$ctrl.scenario.id on-add-axis-item=$ctrl.onAddAxisItem on-remove-axis-item=$ctrl.onRemoveAxisItem on-reposition-axis-items=$ctrl.onRepositionAxisItems> </waltz-roadmap-scenario-axis-config> </td> </tr> <tr> <td> Rows: <p class=help-block> ( <span ng-bind="$ctrl.roadmap.rowType.id | toDisplayName:\'measurableCategory\'"></span> ) </p> </td> <td> <waltz-roadmap-scenario-axis-config axis-domain=$ctrl.roadmap.rowType axis-orientation=ROW scenario-id=$ctrl.scenario.id on-add-axis-item=$ctrl.onAddAxisItem on-remove-axis-item=$ctrl.onRemoveAxisItem on-reposition-axis-items=$ctrl.onRepositionAxisItems> </waltz-roadmap-scenario-axis-config> </td> </tr> <tr> <td>Description:</td> <td> <waltz-editable-field field-type=textarea on-save=$ctrl.onSaveDescription item-id=$ctrl.scenario save-label=Save initial-val=$ctrl.scenario.description empty-label="No description provided" class=text-muted> </waltz-editable-field> </td> </tr> </table> </div> '},1344:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=function(e){return e&&e.__esModule?e:{default:e}}(n(1345)),a=n(0),o=n(2),r=n(156);var l={id:"VIEW",name:"View"},s={tabs:[l,{id:"PICK",name:"Pick"},{id:"SORT",name:"Sort"}],activeTabId:l.id};function c(e,t,n){var i=(0,a.initialiseData)(this,s);function c(){if(i.usedItems&&i.axisDomain&&i.measurablesByCategory){i.allItems||(i.allItems=i.measurablesByCategory[i.axisDomain.id]);var e=_.keyBy(i.allItems,"id");i.checkedItemIds=_.map(i.usedItems,function(e){return e.domainItem.id}),i.expandedItemIds=_.chain(i.checkedItemIds).map(function(t){return e[t]}).compact().map("parentId").uniq().value()}}function d(){t.loadViewData(o.CORE_API.ScenarioStore.loadAxis,[i.scenarioId,i.axisOrientation],{force:!0}).then(function(e){return i.usedItems=e.data}).then(function(){return c()})}i.$onInit=function(){t.loadAppData(o.CORE_API.MeasurableStore.findAll).then(function(e){return i.measurablesByCategory=_.chain(e.data).map(function(e){return Object.assign({},e,{concrete:!0})}).groupBy(function(e){return e.categoryId}).value()}).then(function(){return c()})},i.$onChanges=function(){i.axisDomain&&d()},i.onCancel=function(){i.activeTabId=l.id},i.onItemCheck=function(e){var t=_.get(_.maxBy(i.usedItems,function(e){return e.position}),"position",0)+10,n={orientation:i.axisOrientation,domainItem:{id:e,kind:"MEASURABLE"},position:t};i.onAddAxisItem(n).then(function(){return d()})},i.onItemToggle=function(e){_.some(i.usedItems,function(t){return t.domainItem.id===e})?i.onItemUncheck(e):i.onItemCheck(e)},i.onItemUncheck=function(e){var t={orientation:i.axisOrientation,domainItem:{id:e,kind:"MEASURABLE"}};i.onRemoveAxisItem(t).then(function(){return d()})},i.onMoveUp=function(e){var t=_.findIndex(i.usedItems,function(t){return t.id===e});i.usedItems=(0,r.move)(i.usedItems,t,-1)},i.onMoveDown=function(e){var t=_.findIndex(i.usedItems,function(t){return t.id===e});i.usedItems=(0,r.move)(i.usedItems,t,1)},i.onMoveTop=function(e){var t=function(t){return t.id===e},n=_.find(i.usedItems,t);i.usedItems=[n].concat(_.reject(i.usedItems,t))},i.onMoveBottom=function(e){var t=function(t){return t.id===e},n=_.find(i.usedItems,t);i.usedItems=_.reject(i.usedItems,t).concat([n])},i.onSortAlphabetically=function(){i.usedItems=_.sortBy(i.usedItems,function(e){return e.domainItem.name.toLowerCase()})},i.onSaveSort=function(){var e=_.map(i.usedItems,function(e){return e.id});i.onRepositionAxisItems(i.scenarioId,i.axisOrientation,e).then(function(){return d()}).then(function(){return n.success("Axis reordered")})}}c.$inject=["$q","ServiceBroker","Notification"];var d={bindings:{scenarioId:"<",axisOrientation:"@",axisDomain:"<",onAddAxisItem:"<",onRemoveAxisItem:"<",onRepositionAxisItems:"<",onSave:"<"},controller:c,template:i.default};t.default={component:d,id:"waltzRoadmapScenarioAxisConfig"}},1345:function(e,t){e.exports='<div> <div ng-switch=$ctrl.visibility.mode> <div class=waltz-tabs> <input type=radio ng-repeat-start="tab in $ctrl.tabs" ng-model=$ctrl.activeTabId ng-value=tab.id name="{{tab.name + $id}}" id="{{tab.id + $id}}"> <label for="{{tab.id + $id}}" ng-bind=tab.name ng-repeat-end> </label> <div ng-switch=$ctrl.activeTabId class="wt-tab wt-active"> <div ng-switch-when=VIEW> <p class=help-block> The list below describes the axis items that will be used when drawing this scenario. <br> Use the \'pick\' and \'sort\' tabs to alter this list. </p> <ul ng-if="$ctrl.usedItems.length > 0"> <li ng-repeat="item in $ctrl.usedItems"> <span ng-bind=item.domainItem.name></span> <span class=text-muted> ( <span ng-bind=item.position></span> / <span ng-bind=item.domainItem.id></span> ) </span> </li> </ul> <waltz-no-data ng-if="$ctrl.usedItems.length === 0"> <message> <strong>No axis items defined</strong>. Use the <a ng-click="$ctrl.activeTabId = \'PICK\'" class=clickable> pick </a> tab to select some. </message> </waltz-no-data> </div> <div ng-switch-when=PICK> <p class=help-block> Select the items to use in the axis. </p> <waltz-multi-select-tree-control items=$ctrl.allItems on-click=$ctrl.onItemToggle on-check=$ctrl.onItemCheck on-uncheck=$ctrl.onItemUncheck checked-item-ids=$ctrl.checkedItemIds expanded-item-ids=$ctrl.expandedItemIds> <span ng-bind=node.name></span> </waltz-multi-select-tree-control> </div> <div ng-switch-when=SORT> <p class=help-block> Use the arrows to move items or <a class=clickable ng-click=$ctrl.onSortAlphabetically()> <waltz-icon name=sort-alpha-asc></waltz-icon> Sort Alphabetically </a> </p> <table class=waltz-mini-table> <tr ng-repeat="item in $ctrl.usedItems track by item.id" class=waltz-visibility-parent> <td class=waltz-visibility-child-30> <a ng-if=!$first class=clickable ng-click=$ctrl.onMoveTop(item.id)> <waltz-icon name=step-forward fixed-width=true alt="Move item to top" rotate=270> </waltz-icon> </a> </td> <td class=waltz-visibility-child-30> <a ng-if=!$first class=clickable ng-click=$ctrl.onMoveUp(item.id)> <waltz-icon name=arrow-up fixed-width=true alt="Move item up"> </waltz-icon> </a> </td> <td> <span ng-bind=item.domainItem.name></span> <span class=text-muted> ( <span ng-bind=item.position></span> / <span ng-bind=item.domainItem.id></span> ) </span> </td> <td class=waltz-visibility-child-30> <a ng-if=!$last class=clickable ng-click=$ctrl.onMoveDown(item.id)> <waltz-icon name=arrow-down fixed-width=true alt="Move item down"> </waltz-icon> </a> </td> <td class=waltz-visibility-child-30> <a ng-if=!$last class=clickable ng-click=$ctrl.onMoveBottom(item.id)> <waltz-icon name=step-forward fixed-width=true alt="Move item to bottom" rotate=90> </waltz-icon> </a> </td> </tr> </table> <br> <button ng-click=$ctrl.onSaveSort() class="btn btn-xs btn-success"> Save sort order </button> <waltz-no-data ng-if="$ctrl.usedItems.length === 0"> <message> <strong>No axis items defined</strong>. Use the <a ng-click="$ctrl.activeTabId = \'PICK\'" class=clickable> pick </a> tab to select some. </message> </waltz-no-data> </div> </div> </div> </div> </div>'},1346:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=n(2),a=c(n(1)),o=n(155),r=n(0),l=n(5),s=c(n(53));function c(e){return e&&e.__esModule?e:{default:e}}var d={EDIT:"EDIT",VIEW:"VIEW"},u={ADD_APPLICATION:"ADD_APPLICATION",EDIT_CELL:"EDIT_CELL"},p={INFOPOP:"wrsd-infopop",INFOPOP_CLOSE:"infopop-close"},f={bindings:{scenarioId:"<",onCancel:"<"},template:c(n(1347)).default,controller:v},m={dialog:null,handlers:{},hiddenAxes:[],lastRatings:{},layoutOptions:{defaultColMaxWidth:2,maxColWidths:{}},mode:d.VIEW,permissions:{admin:!1,edit:!1}};function v(e,t,n,c,f){var v=(0,r.initialiseData)(this,m),g=function(){return{display:"block",position:"absolute",left:l.event.pageX-2+"px",top:l.event.pageY-100+"px"}},y=function(e){var n=e.column,i=e.row,o=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[],n=arguments[2],i=arguments[3],o=a.default.chain(t).filter(function(e){return e.column.id===n.id&&e.row.id===i.id}).map(function(e){return e.item.id}).value();return a.default.chain(e).reject(function(e){return a.default.includes(o,e.id)}).orderBy(function(e){return e.name.toLowerCase()}).value()}(v.applications,v.scenarioDefn.ratings,n,i),r=g();t(function(){v.selectedRow=i,v.selectedColumn=n,v.dialog={type:u.ADD_APPLICATION,row:i,column:n,applicationPickList:o,tabs:[{name:"Pick app",value:"PICK"},{name:"Search for any app",value:"SEARCH"}],tab:"PICK",style:r}})},h={title:"Switch to edit mode",action:function(){return t(function(){return v.mode=d.EDIT})}};function w(){return(0,o.prepareData)(v.scenarioDefn,v.applications,v.measurables,v.hiddenAxes)}function b(){I(S()).then(function(){return v.vizData=w()})}function S(){return c.loadViewData(i.CORE_API.ScenarioStore.getById,[v.scenarioId],{force:!0}).then(function(e){return v.scenarioDefn=e.data})}function I(e){return e.then(function(){return a.default.map(v.scenarioDefn.ratings,function(e){return e.item.id})}).then(function(e){return c.loadViewData(i.CORE_API.ApplicationStore.findByIds,[e],{force:!0})}).then(function(e){return v.applications=e.data})}function D(){(0,l.select)("."+p.INFOPOP).style("display","none")}function A(){return(0,l.selectAll)("."+p.INFOPOP).data([1]).enter().append("div").attr("class",p.INFOPOP),{onNodeClick:function(e){var t=e.node.name,n=e.domainCoordinates.column.name,i=e.domainCoordinates.row.name,o=a.default.get(v,["ratingsByCode",e.state.rating,"name"],"?");!function(e){(0,l.select)("."+p.INFOPOP).style("left",l.event.pageX-2+"px").style("top",l.event.pageY-2+"px").style("display","block").html(e).select("."+p.INFOPOP_CLOSE).on("click",function(){return D()})}('\n                    <table class="table table-condensed small">\n                        <thead>\n                        <tr>\n                            <th colspan="2">'+t+"</th>\n                        </tr>\n                        </thead>\n                        <tbody>\n                        <tr>\n                            <td>Column:</td>\n                            <td>"+n+"</td>\n                        </tr>\n                        <tr>\n                            <td>Row:</td>\n                            <td>"+i+"</td>\n                        </tr>\n                        <tr>\n                            <td>Comment:</td>\n                            <td>"+a.default.get(e,["state","comment"],"- No comment -")+"</td>\n                        </tr>\n                        <tr>\n                            <td>Rating:</td> \n                            <td>"+o+'</td>\n                        </tr>\n                        </tbody>\n                    </table>\n                    <a class="clickable infopop-close">\n                        Close\n                    </a>\n                ')},onNodeGridClick:function(){D()},contextMenus:{node:function(){return D(),v.permissions.edit?v.mode===d.VIEW?[h]:[{title:"Add another application",action:function(e,t){return y(t.domainCoordinates)}},{title:"Edit",action:function(e,n){var i=g();t(function(){v.dialog={type:u.EDIT_CELL,data:n,workingState:Object.assign({rating:"G",comment:""},n.state),style:i}})}},{divider:!0},{title:"Remove",action:function(e,t){var a=[v.scenarioDefn.scenario.id,t.node.id,t.domainCoordinates.column.id,t.domainCoordinates.row.id];c.execute(i.CORE_API.ScenarioStore.removeRating,a).then(function(){return n.success("Item removed")}).then(function(){return b()})}}]:null},nodeGrid:function(){return D(),v.permissions.edit?v.mode===d.VIEW?[h]:[{title:"Add application",action:function(e,t){return y({row:t.row,column:t.column})}}]:null},axisItem:function(e,i,o){var r={title:"Hide",action:function(e,i){return t(function(){0===v.hiddenAxes.length&&n.info("Hid axis from grid, you can restore from the Hidden Axes menu in Diagram Controls"),v.hiddenAxes.push(i),v.vizData=w()})}},l={title:"Decrease width",action:function(e,n){return t(function(){var e=(v.layoutOptions.maxColWidths[n.id]||0)-1;v.layoutOptions.maxColWidths[n.id]=Math.max(e,v.layoutOptions.defaultColMaxWidth),v.vizData=w()})}},s={title:"Increase width",action:function(e,n){return t(function(){v.layoutOptions.maxColWidths[n.id]=(v.layoutOptions.maxColWidths[n.id]||v.layoutOptions.defaultColMaxWidth)+1,v.vizData=w()})}};return a.default.compact([r,"COLUMN"===e.axisOrientation?l:null,"COLUMN"===e.axisOrientation?s:null])}}}}v.$onInit=function(){var t=S(),n=I(t),o=function(e){return e.then(function(){return c.loadAppData(i.CORE_API.MeasurableStore.findAll)}).then(function(e){var t=a.default.map(v.scenarioDefn.axisDefinitions,function(e){return e.domainItem.id});v.measurables=a.default.filter(e.data,function(e){return a.default.includes(t,e.id)})})}(t);t.then(function(){return c.loadAppData(i.CORE_API.RatingSchemeStore.getById,[v.scenarioDefn.roadmap.ratingSchemeId])}).then(function(e){return v.ratingsByCode=a.default.keyBy(e.data.ratings,"rating")}),e.all([t,n,o]).then(function(){return v.vizData=w()}),v.handlers=A(),f.whoami().then(function(e){return v.permissions={admin:f.hasRole(e,s.default.SCENARIO_ADMIN),edit:f.hasRole(e,s.default.SCENARIO_EDITOR)}})};v.toggleMode=function(){v.mode=v.mode===d.VIEW?d.EDIT:d.VIEW},v.onRatingSelect=function(e){v.dialog.workingState.rating=e},v.onAddApplication=function(e){var t=function(e){return a.default.get(v.lastRatings,[e.id],a.default.chain(v.ratingsByCode).values().sortBy(["position"]).head().value())}(e),o=[v.scenarioDefn.scenario.id,e.id,v.selectedColumn.id,v.selectedRow.id,t];c.execute(i.CORE_API.ScenarioStore.addRating,o).then(function(){a.default.remove(v.dialog.applicationPickList,function(t){return t.id===e.id}),b(),n.success("Added rating")})},v.onSaveCell=function(e,t,a,o){var r=[v.scenarioDefn.scenario.id,e.id,t.id,a.id,o.rating,o.comment];c.execute(i.CORE_API.ScenarioStore.updateRating,r).then(function(){b(),n.success("Edited rating"),v.onCloseDialog(),v.lastRatings[e.id]=o.rating})},v.onCloseDialog=function(){v.dialog=null},v.unhideAxis=function(e){a.default.remove(v.hiddenAxes,function(t){return t.id===e.id}),v.vizData=w()},v.unhideAllAxes=function(){v.hiddenAxes=[],v.vizData=w()}}v.$inject=["$q","$timeout","Notification","ServiceBroker","UserService"];t.default={id:"waltzRoadmapScenarioDiagram",component:f}},1347:function(e,t){e.exports=' <div> <p class=help-block> </p><div ng-if=$ctrl.permissions.edit> <span ng-if="$ctrl.mode === \'VIEW\'"> You are currently viewing this scenario. <br> <a ng-click="$ctrl.mode = \'EDIT\'" class=clickable> Switch to edit mode </a> (also available via context menu). </span> <span ng-if="$ctrl.mode === \'EDIT\'" class=clickable> You are currently editing this scenario. Use the context menu to add applications, change ratings and update descriptions. <br> <a ng-click="$ctrl.mode = \'VIEW\'"> Switch back to view mode. </a> </span> </div> <p></p> <waltz-scenario-diagram rating-scheme-id=$ctrl.scenarioDefn.roadmap.ratingSchemeId row-data=$ctrl.vizData.rowData column-headings=$ctrl.vizData.columnHeadings row-headings=$ctrl.vizData.rowHeadings handlers=$ctrl.handlers hidden-axes=$ctrl.hiddenAxes layout-options=$ctrl.layoutOptions on-unhide-axis=$ctrl.unhideAxis on-unhide-all-axes=$ctrl.unhideAllAxes> </waltz-scenario-diagram> </div> <div ng-if=$ctrl.dialog ng-style=$ctrl.dialog.style style="background-color:#fafafa;border:2px solid #ccc;border-radius:3px;padding:6px;min-width:500px;z-index:100"> <div ng-switch=$ctrl.dialog.type> <div ng-switch-when=EDIT_CELL> <h4> <span>Edit:</span> <span ng-bind=$ctrl.dialog.data.node.name></span> <small> <a ng-click=$ctrl.onCloseDialog() class=clickable> <waltz-icon name=close></waltz-icon> Close </a> </small> </h4> <p class=help-block> Editing application: <span ng-bind=$ctrl.dialog.data.node.name></span> in position: <span ng-bind=$ctrl.dialog.data.domainCoordinates.column.name></span> / <span ng-bind=$ctrl.dialog.data.domainCoordinates.row.name></span> </p> <div class=row> <div class=col-sm-6> <p class=help-block> Select a rating for this application: </p> <div class=small> <waltz-rating-picker selected=$ctrl.dialog.workingState.rating scheme-id=$ctrl.scenarioDefn.roadmap.ratingSchemeId on-select=$ctrl.onRatingSelect> </waltz-rating-picker> </div> </div> <div class=col-sm-6> <p class=help-block> Adding a comment to a rating will help users to understand why and application has been placed in this state. </p> <textarea ng-model=$ctrl.dialog.workingState.comment cols=30 rows=6>\n                    </textarea> </div> </div> <div> <button ng-click="$ctrl.onSaveCell(\n                            $ctrl.dialog.data.node,\n                            $ctrl.dialog.data.domainCoordinates.column,\n                            $ctrl.dialog.data.domainCoordinates.row,\n                            $ctrl.dialog.workingState)" class="btn btn-primary btn-sm"> Save </button> <a ng-click=$ctrl.onCloseDialog() class=clickable> Cancel </a> </div> </div> <div ng-switch-when=ADD_APPLICATION> <h4> <span>Add Application</span> <small> <a ng-click=$ctrl.onCloseDialog() class=clickable> <waltz-icon name=close></waltz-icon> Close </a> </small> </h4> Add application to: <table class=waltz-mini-table> <tr> <td>Column:</td> <td> <span ng-bind=$ctrl.dialog.column.name></span> </td> </tr> <tr> <td>Row:</td> <td> <span ng-bind=$ctrl.dialog.row.name></span> </td> </tr> </table> <br> <div class=waltz-tabs> <input type=radio ng-repeat-start="tab in $ctrl.dialog.tabs" ng-model=$ctrl.dialog.tab ng-value=tab.value name={{tab.name}} id="{{tab.id + $id}}"> <label for="{{tab.id + $id}}" ng-bind=tab.name ng-repeat-end> </label> <div ng-switch=$ctrl.dialog.tab class="wt-tab wt-active"> <div ng-switch-when=PICK> <p class=help-block> Select from applications already mentioned in this scenario </p> <div ng-if="$ctrl.dialog.applicationPickList.length === 0"> <div class="small alert alert-warning"> No additional applications to pick from. Perhaps use <a ng-click="$ctrl.dialog.tab = \'SEARCH\'" class=clickable> search </a> to add one </div> </div> <div ng-if="$ctrl.dialog.applicationPickList.length > 0"> <div ng-class="{\'waltz-scroll-region-150\': $ctrl.dialog.applicationPickList.length > 10}"> <ul> <li ng-repeat="app in $ctrl.dialog.applicationPickList"> <a ng-click=$ctrl.onAddApplication(app) class=clickable> <span ng-bind=app.name></span> </a> </li> </ul> </div> </div> </div> <div ng-switch-when=SEARCH> <p class=help-block> Search for an application using it\'s name or asset code </p> <waltz-basic-app-selector on-add=$ctrl.onAddApplication on-cancel=$ctrl.onCloseDialog> </waltz-basic-app-selector> </div> </div> </div> <br> </div> <div> </div> </div></div>'},1348:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i={},a={url:"roadmap/{id:int}",views:{"content@":function(e){return e&&e.__esModule?e:{default:e}}(n(1349)).default.component}};function o(e){e.state("main.roadmap",i).state("main.roadmap.view",a)}o.$inject=["$stateProvider"],t.default=o},1349:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=function(e){return e&&e.__esModule?e:{default:e}}(n(1350)),a=n(0),o=n(31);var r={changeLogSection:o.dynamicSections.changeLogSection,relatedAppGroupsSection:o.dynamicSections.relatedAppGroupsSection,relatedOrgUnitSection:o.dynamicSections.relatedOrgUnitSection};function l(e){var t=(0,a.initialiseData)(this,r);t.$onInit=function(){t.roadmapId=e.id,t.parentEntityRef={kind:"ROADMAP",id:t.roadmapId}}}l.$inject=["$stateParams"];var s={controller:l,template:i.default,bindings:{},controllerAs:"$ctrl"};t.default={id:"waltzScenarioView",component:s}},1350:function(e,t){e.exports="<waltz-roadmap-header roadmap-id=$ctrl.roadmapId> </waltz-roadmap-header> <br> <waltz-scenario-list-section roadmap-id=$ctrl.roadmapId> </waltz-scenario-list-section> <br> <waltz-dynamic-section-wrapper section=$ctrl.relatedAppGroupsSection parent-entity-ref=$ctrl.parentEntityRef> </waltz-dynamic-section-wrapper> <br> <waltz-dynamic-section-wrapper section=$ctrl.relatedOrgUnitSection parent-entity-ref=$ctrl.parentEntityRef> </waltz-dynamic-section-wrapper> <br> <waltz-dynamic-section-wrapper section=$ctrl.changeLogSection parent-entity-ref=$ctrl.parentEntityRef> </waltz-dynamic-section-wrapper> "},1575:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=n(2),a=r(n(1576)),o=r(n(404));function r(e){return e&&e.__esModule?e:{default:e}}function l(e,t){return e.all([t.loadAppData(i.CORE_API.EnumValueStore.findAll),t.loadAppData(i.CORE_API.DataTypeStore.findAll),t.loadAppData(i.CORE_API.DrillGridDefinitionStore.findAll)])}function s(e,t){t.when("","/home"),e.state("main",{url:"/",resolve:{warmUp:l},views:{header:{template:"<waltz-navbar></waltz-navbar>"},content:a.default}}).state("main.home",{url:"home",views:{content:{template:o.default}}})}function c(e,t){e.$on("$stateChangeSuccess",function(){t[0].body.scrollTop=0,t[0].documentElement.scrollTop=0})}function d(e,t,n){t.setupNag(function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"";e.$on("$stateChangeSuccess",function(){n.info(t)})})}function u(e,t,n){e.$on("$stateChangeSuccess",function(e,i,a){var o=i.name;n.write(o,a).then(function(e){"2b80f7e798f485cdd37996f447c34316b006db45"!=e.revision&&(console.log("Waltz reloading as server reported version does not match client. Server:",e,"client: ","2b80f7e798f485cdd37996f447c34316b006db45"),t.location.reload())})})}function p(e){e.$on("$stateChangeError",function(e,t,n,i,a,o){console.log("$stateChangeError - fired when an error occurs during transition."),console.log(arguments)}),e.$on("$stateNotFound",function(e,t,n,i){console.log("$stateNotFound "+t.to+" - fired when a state cannot be found by its name."),console.log(t,n,i)})}function f(e,t,n,i){var a=function(){console.log("Reloading page due to inactivity"),n.location.reload()};i.findOrDefault("ui.inactivity-timeout",null).then(function(n){if(n){console.log("Configuring inactivity timer for "+n+" ms");var i=t(a,n);e.$on("$stateChangeSuccess",function(e,o,r){i&&t.cancel(i),i=t(a,n)})}})}l.$inject=["$q","ServiceBroker"],s.$inject=["$stateProvider","$urlRouterProvider"],c.$inject=["$rootScope","$document"],d.$inject=["$rootScope","NagMessageService","Notification"],u.$inject=["$rootScope","$window","AccessLogStore"],p.$inject=["$rootScope"],f.$inject=["$rootScope","$timeout","$window","SettingsService"],t.default=function(e){e.config(s).run(c).run(d).run(u).run(f).run(p)}},1578:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=o(n(1)),a=o(n(89));function o(e){return e&&e.__esModule?e:{default:e}}function r(e,t){t.isDevModeEnabled().then(function(n){n&&t.findAll().then(function(t){console.log("Dev Extensions enabled"),i.default.chain(t).filter(function(e){return e.name.startsWith(a.default.httpHeaderPrefix)}).each(function(t){var n=t.name.replace(a.default.httpHeaderPrefix,"");e.defaults.headers.common[n]=t.value}).value()})})}function l(e){e.defaults.cache=!1,e.defaults.headers.get||(e.defaults.headers.get={}),e.defaults.headers.get["If-Modified-Since"]="0",e.useApplyAsync(!0)}r.$inject=["$http","SettingsService"],l.$inject=["$httpProvider"],t.default=function(e){e.constant("BaseApiUrl","./api").constant("BaseUrl","./").constant("BaseExtractUrl","./data-extract").config(l).run(r)}},239:function(e,t,n){"use strict";function i(e,t){var n=t+"/notification";return{findAll:function(){return e.get(n).then(function(e){return e.data})}}}Object.defineProperty(t,"__esModule",{value:!0}),t.store=i,i.$inject=["$http","BaseApiUrl"];var a=t.serviceName="NotificationStore";t.NotificationStore_API={findAll:{serviceName:a,serviceFnName:"findAll",description:"findAll notifications for the logged in user"}}},240:function(e,t,n){"use strict";function i(e,t){var n=t+"/org-unit";return{getById:function(t){return e.get(n+"/"+t).then(function(e){return e.data})},findAll:function(){return e.get(n).then(function(e){return e.data})},findByIds:function(t){return e.post(n+"/by-ids",t).then(function(e){return e.data})},findRelatedByEntityRef:function(t){return e.get(n+"/related/"+t.kind+"/"+t.id,t).then(function(e){return e.data})},findDescendants:function(t){return e.get(n+"/"+t+"/descendants").then(function(e){return e.data})},findImmediateHierarchy:function(t){return e.get(n+"/"+t+"/immediate-hierarchy").then(function(e){return e.data})},search:function(t){return e.get(n+"/search/"+t).then(function(e){return e.data})}}}Object.defineProperty(t,"__esModule",{value:!0}),t.store=i,i.$inject=["$http","BaseApiUrl"];var a=t.serviceName="OrgUnitStore";t.OrgUnitStore_API={getById:{serviceName:a,serviceFnName:"getById",description:"executes getById"},findAll:{serviceName:a,serviceFnName:"findAll",description:"executes findAll"},findByIds:{serviceName:a,serviceFnName:"findByIds",description:"executes findByIds"},findRelatedByEntityRef:{serviceName:a,serviceFnName:"findRelatedByEntityRef",description:"executes findRelatedByEntityRef"},findDescendants:{serviceName:a,serviceFnName:"findDescendants",description:"executes findDescendants"},findImmediateHierarchy:{serviceName:a,serviceFnName:"findImmediateHierarchy",description:"executes findImmediateHierarchy"},search:{serviceName:a,serviceFnName:"search",description:"executes search"}}},241:function(e,t,n){"use strict";function i(e,t){var n=t+"/person";return{getByEmployeeId:function(t){return e.get(n+"/employee-id/"+t).then(function(e){return e.data})},getById:function(t){return e.get(n+"/id/"+t).then(function(e){return e.data?e.data:function(e){return{id:e,displayName:arguments.length>1&&void 0!==arguments[1]?arguments[1]:"Unknown"}}(t)})},findByUserId:function(t){return e.get(n+"/user-id/"+t).then(function(e){return e.data})},findDirects:function(t){return e.get(n+"/employee-id/"+t+"/directs").then(function(e){return e.data})},findManagers:function(t){return e.get(n+"/employee-id/"+t+"/managers").then(function(e){return e.data})},countCumulativeReportsByKind:function(t){return e.get(n+"/employee-id/"+t+"/count-cumulative-reports").then(function(e){return e.data})},search:function(t){return e.get(n+"/search/"+t).then(function(e){return e.data})}}}Object.defineProperty(t,"__esModule",{value:!0}),i.$inject=["$http","BaseApiUrl"];t.PersonStore_API={getByEmployeeId:{serviceName:"PersonStore",serviceFnName:"getByEmployeeId",description:"get person by employee id"},getById:{serviceName:"PersonStore",serviceFnName:"getById",description:"get person by id"},findByUserId:{serviceName:"PersonStore",serviceFnName:"findByUserId",description:"find person by user id"},findDirects:{serviceName:"PersonStore",serviceFnName:"findDirects",description:"find direct reports for person"},findManagers:{serviceName:"PersonStore",serviceFnName:"findManagers",description:"find managers for person"},countCumulativeReportsByKind:{serviceName:"PersonStore",serviceFnName:"countCumulativeReportsByKind",description:"count Cumulative Reports [empId]"},search:{serviceName:"PersonStore",serviceFnName:"search",description:"search for people"}};t.default={store:i,serviceName:"PersonStore"}},242:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.PhysicalFlowStore_API=t.serviceName=void 0,t.store=a;var i=n(8);function a(e,t){var n=t+"/physical-flow";return{findBySpecificationId:function(t){return e.get(n+"/specification/"+t).then(function(e){return e.data})},findByLogicalFlowId:function(t){return e.get(n+"/logical-flow/"+t).then(function(e){return e.data})},findByEntityReference:function(t){return(0,i.checkIsEntityRef)(t),e.get(n+"/entity/"+t.kind+"/"+t.id).then(function(e){return e.data})},findByProducerEntityReference:function(t){return(0,i.checkIsEntityRef)(t),e.get(n+"/entity/"+t.kind+"/"+t.id+"/produces").then(function(e){return e.data})},findByConsumerEntityReference:function(t){return(0,i.checkIsEntityRef)(t),e.get(n+"/entity/"+t.kind+"/"+t.id+"/consumes").then(function(e){return e.data})},findBySelector:function(t){return(0,i.checkIsIdSelector)(t),e.post(n+"/selector",t).then(function(e){return e.data})},getById:function(t){return e.get(n+"/id/"+t).then(function(e){return e.data})},searchReports:function(t){return e.get(n+"/search-reports/"+t).then(function(e){return e.data})},create:function(t){return(0,i.checkIsCreatePhysicalFlowCommand)(t),e.post(n,t).then(function(e){return e.data})},deleteById:function(t){return e.delete(n+"/"+t).then(function(e){return e.data})},updateSpecDefinitionId:function(t,i){return e.post(n+"/id/"+t+"/spec-definition",i).then(function(e){return e.data})},updateAttribute:function(t,i){return e.post(n+"/id/"+t+"/attribute",i).then(function(e){return e.data})},validateUpload:function(t){return e.post(n+"/upload/validate",t).then(function(e){return e.data})},upload:function(t){return e.post(n+"/upload",t).then(function(e){return e.data})},cleanupOrphans:function(){return e.get(n+"/cleanup-orphans").then(function(e){return e.data})}}}a.$inject=["$http","BaseApiUrl"];var o=t.serviceName="PhysicalFlowStore";t.PhysicalFlowStore_API={findBySpecificationId:{serviceName:o,serviceFnName:"findBySpecificationId",description:"executes findBySpecificationId"},findByLogicalFlowId:{serviceName:o,serviceFnName:"findByLogicalFlowId",description:"executes findByLogicalFlowId"},findByEntityReference:{serviceName:o,serviceFnName:"findByEntityReference",description:"executes findByEntityReference"},findByProducerEntityReference:{serviceName:o,serviceFnName:"findByProducerEntityReference",description:"executes findByProducerEntityReference"},findByConsumerEntityReference:{serviceName:o,serviceFnName:"findByConsumerEntityReference",description:"executes findByConsumerEntityReference"},findBySelector:{serviceName:o,serviceFnName:"findBySelector",description:"executes findBySelector"},getById:{serviceName:o,serviceFnName:"getById",description:"executes getById"},searchReports:{serviceName:o,serviceFnName:"searchReports",description:"executes searchReports"},create:{serviceName:o,serviceFnName:"create",description:"executes create"},deleteById:{serviceName:o,serviceFnName:"deleteById",description:"executes deleteById"},updateSpecDefinitionId:{serviceName:o,serviceFnName:"updateSpecDefinitionId",description:"executes updateSpecDefinitionId"},updateAttribute:{serviceName:o,serviceFnName:"updateAttribute",description:"executes updateAttribute"},validateUpload:{serviceName:o,serviceFnName:"validateUpload",description:"executes validateUpload"},upload:{serviceName:o,serviceFnName:"upload",description:"executes upload"},cleanupOrphans:{serviceName:o,serviceFnName:"cleanupOrphans",description:"cleans up orphaned physical flows"}}},243:function(e,t,n){"use strict";function i(e,t){var n=t+"/physical-spec-data-type";return{findBySpecificationId:function(t){return e.get(n+"/specification/"+t).then(function(e){return e.data})},findBySpecificationSelector:function(t){return e.post(n+"/specification/selector",t).then(function(e){return e.data})},save:function(t,i){return e.post(n+"/specification/"+t,i).then(function(e){return e.data})}}}Object.defineProperty(t,"__esModule",{value:!0}),t.store=i,i.$inject=["$http","BaseApiUrl"];var a=t.serviceName="PhysicalSpecDataTypeStore";t.PhysicalSpecDataTypeStore_API={findBySpecificationId:{serviceName:a,serviceFnName:"findBySpecificationId",description:"finds data types for a given specification id"},findBySpecificationSelector:{serviceName:a,serviceFnName:"findBySpecificationSelector",description:"finds data types for a given specification id selector"},save:{serviceName:a,serviceFnName:"save",description:"saves (inserts/deletes) data types for a given specification id"}}},244:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.PhysicalSpecDefinitionFieldStore_API=t.serviceName=void 0,t.store=a;var i=n(8);function a(e,t){var n=t+"/physical-spec-definition-field";return{findBySelector:function(t){return(0,i.checkIsIdSelector)(t),e.post(n+"/selector",t).then(function(e){return e.data})},findForSpecDefinitionId:function(t){return e.get(n+"/spec-definition/"+t).then(function(e){return e.data})},createFields:function(t,i){return e.post(n+"/spec-definition/"+t+"/fields",i).then(function(e){return e.data})},updateDescription:function(t,i){return e.put(n+"/"+t+"/description",i).then(function(e){return e.data})},updateLogicalElement:function(t,i){return e.put(n+"/"+t+"/logical-data-element",i).then(function(e){return e.data})}}}a.$inject=["$http","BaseApiUrl"];var o=t.serviceName="PhysicalSpecDefinitionFieldStore";t.PhysicalSpecDefinitionFieldStore_API={findBySelector:{serviceName:o,serviceFnName:"findBySelector",description:"executes findBySelector"},findForSpecDefinitionId:{serviceName:o,serviceFnName:"findForSpecDefinitionId",description:"executes findForSpecDefinitionId"},createFields:{serviceName:o,serviceFnName:"createFields",description:"executes createFields"},updateDescription:{serviceName:o,serviceFnName:"updateDescription",description:"executes updateDescription"},updateLogicalElement:{serviceName:o,serviceFnName:"updateLogicalElement",description:"executes updateLogicalElement"}}},245:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.PhysicalSpecDefinitionStore_API=t.serviceName=void 0,t.store=a;var i=n(8);function a(e,t){var n=t+"/physical-spec-definition";return{findBySelector:function(t){return(0,i.checkIsIdSelector)(t),e.post(n+"/selector",t).then(function(e){return e.data})},findForSpecificationId:function(t){return e.get(n+"/specification/"+t).then(function(e){return e.data})},create:function(t,i){return e.post(n+"/specification/"+t,i).then(function(e){return e.data})},updateStatus:function(t,i){return e.put(n+"/specification/"+t+"/status",i).then(function(e){return e.data})},deleteSpecification:function(t){return e.delete(n+"/specification/"+t).then(function(e){return e.data})}}}a.$inject=["$http","BaseApiUrl"];var o=t.serviceName="PhysicalSpecDefinitionStore";t.PhysicalSpecDefinitionStore_API={findBySelector:{serviceName:o,serviceFnName:"findBySelector",description:"executes findBySelector"},findForSpecificationId:{serviceName:o,serviceFnName:"findForSpecificationId",description:"executes findForSpecificationId"},create:{serviceName:o,serviceFnName:"create",description:"executes create"},updateStatus:{serviceName:o,serviceFnName:"updateStatus",description:"executes updateStatus"},deleteSpecification:{serviceName:o,serviceFnName:"deleteSpecification",description:"executes deleteSpecification"}}},246:function(e,t,n){"use strict";function i(e,t){var n=t+"/physical-spec-definition-sample-file";return{findForSpecDefinitionId:function(t){return e.get(n+"/spec-definition/"+t).then(function(e){return e.data})},create:function(t,i){return e.post(n+"/spec-definition/"+t,i).then(function(e){return e.data})}}}Object.defineProperty(t,"__esModule",{value:!0}),t.store=i,i.$inject=["$http","BaseApiUrl"];var a=t.serviceName="PhysicalSpecDefinitionSampleFileStore";t.PhysicalSpecDefinitionSampleFileStore_API={findForSpecDefinitionId:{serviceName:a,serviceFnName:"findForSpecDefinitionId",description:"executes findForSpecDefinitionId"},create:{serviceName:a,serviceFnName:"create",description:"executes create"}}},247:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.PhysicalSpecificationStore_API=t.serviceName=void 0,t.store=a;var i=n(8);function a(e,t){var n=t+"/physical-specification";return{findByEntityReference:function(t){return(0,i.checkIsEntityRef)(t),e.get(n+"/application/"+t.kind+"/"+t.id).then(function(e){return e.data})},findBySelector:function(t){return(0,i.checkIsIdSelector)(t),e.post(n+"/selector",t).then(function(e){return e.data})},getById:function(t){return e.get(n+"/id/"+t).then(function(e){return e.data})},deleteById:function(t){return e.delete(n+"/"+t).then(function(e){return e.data})},search:function(t){return e.get(n+"/search/"+t).then(function(e){return e.data})}}}a.$inject=["$http","BaseApiUrl"];var o=t.serviceName="PhysicalSpecificationStore";t.PhysicalSpecificationStore_API={findByEntityReference:{serviceName:o,serviceFnName:"findByEntityReference",description:"executes findByEntityReference"},findBySelector:{serviceName:o,serviceFnName:"findBySelector",description:"executes findBySelector"},getById:{serviceName:o,serviceFnName:"getById",description:"executes getById"},deleteById:{serviceName:o,serviceFnName:"deleteById",description:"executes deleteById"},search:{serviceName:o,serviceFnName:"search",description:"executes search"}}},248:function(e,t,n){"use strict";function i(e,t){var n=t+"/rating-scheme";return{findAll:function(t){return e.get(n).then(function(e){return e.data})},getById:function(t){return e.get(n+"/id/"+t).then(function(e){return e.data})}}}Object.defineProperty(t,"__esModule",{value:!0}),t.store=i,i.$inject=["$http","BaseApiUrl"];var a=t.serviceName="RatingSchemeStore";t.RatingSchemeStore_API={findAll:{serviceName:a,serviceFnName:"findAll",description:"executes findAll"},getById:{serviceName:a,serviceFnName:"getById",description:"executes getById"}}},249:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.RoadmapStore_API=void 0;var i=n(8);function a(e,t){var n=t+"/roadmap";return{addRoadmap:function(t){return e.post(n,t).then(function(e){return e.data})},getRoadmapById:function(t){return e.get(n+"/id/"+t).then(function(e){return e.data})},findRoadmapsBySelector:function(t){return(0,i.checkIsIdSelector)(t),e.post(n+"/by-selector",t).then(function(e){return e.data})},updateDescription:function(t,i){return e.post(n+"/id/"+t+"/description",i).then(function(e){return e.data})},updateLifecycleStatus:function(t,i){return e.post(n+"/id/"+t+"/lifecycleStatus",i).then(function(e){return e.data})},updateName:function(t,i){return e.post(n+"/id/"+t+"/name",i).then(function(e){return e.data})},addScenario:function(t,i){return e.post(n+"/id/"+t+"/add-scenario",i).then(function(e){return e.data})},findRoadmapsAndScenariosByRatedEntity:function(t){return e.get(n+"/by-rated-entity/"+t.kind+"/"+t.id).then(function(e){return e.data})},findRoadmapsAndScenariosByFormalRelationship:function(t){return e.get(n+"/by-formal-relationship/"+t.kind+"/"+t.id).then(function(e){return e.data})}}}a.$inject=["$http","BaseApiUrl"];var o="RoadmapStore";t.RoadmapStore_API={addRoadmap:{serviceName:o,serviceFnName:"addRoadmap",description:"executes addRoadmap [ command ]"},getRoadmapById:{serviceName:o,serviceFnName:"getRoadmapById",description:"executes findScenariosForRoadmap [roadmapId]"},findRoadmapsBySelector:{serviceName:o,serviceFnName:"findRoadmapsBySelector",description:"executes findRoadmapsBySelector [selectorOptions]"},updateDescription:{serviceName:o,serviceFnName:"updateDescription",description:"executes updateDescription [roadmapId, newDescription]"},updateLifecycleStatus:{serviceName:o,serviceFnName:"updateLifecycleStatus",description:"executes updateLifecycleStatus [roadmapId, newStatus]"},updateName:{serviceName:o,serviceFnName:"updateName",description:"executes updateName [roadmapId, newName]"},addScenario:{serviceName:o,serviceFnName:"addScenario",description:"executes addScenario [roadmapId, name]"},findRoadmapsAndScenariosByRatedEntity:{serviceName:o,serviceFnName:"findRoadmapsAndScenariosByRatedEntity",description:"executes findRoadmapsAndScenariosByRatedEntity [ratedEntityRef]"},findRoadmapsAndScenariosByFormalRelationship:{serviceName:o,serviceFnName:"findRoadmapsAndScenariosByFormalRelationship",description:"executes findRoadmapsAndScenariosByFormalRelationship [relatedEntityRef]"}};t.default={serviceName:o,store:a}},399:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.enrichPhysicalFlow=a,t.enrichSpecification=o,t.removeEnrichments=function(e){return i.default.omit(e,["frequencyName","transportName","criticalityName","formatName"])},t.combinePhysicalWithLogical=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[],n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:[],r=arguments[3],l=i.default.keyBy(t,"id"),s=i.default.keyBy(n,"id");return i.default.map(e,function(e){var t=l[e.logicalFlowId],n=a(e,r),i=o(s[e.specificationId],r);return{physical:n,logical:t,specification:i}})};var i=function(e){return e&&e.__esModule?e:{default:e}}(n(1));function a(e,t){var n={frequencyName:t.lookup("frequencyKind",e.frequency),transportName:t.lookup("transportKind",e.transport),criticalityName:t.lookup("physicalFlowCriticality",e.criticality)};return Object.assign({},e,n)}function o(e,t){var n=t.lookup("dataFormatKind",e.format);return Object.assign({},e,{formatName:n})}},73:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.investmentRagNames=t.baseRagNames=void 0,t.mkRatingsKeyHandler=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:function(){},n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:function(){},a=i.default.keyBy(e,function(e){return e.rating.toUpperCase()});return function(e){if(27===e.keyCode)n();else{var i=a[e.key.toUpperCase()];if(i&&i.userSelectable)return t(i.rating)}}},t.ragToRatingSchemeItem=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"Z",t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"base",n=r[t]||a;return n[e]||n.Z},t.indexRatingSchemes=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];return i.default.chain(e).map(function(e){return Object.assign({},e,{ratingsByCode:i.default.keyBy(e.ratings,"rating"),ratingsById:i.default.keyBy(e.ratings,"id")})}).keyBy("id").value()},t.distinctRatingCodes=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return i.default.chain(e).flatMap(function(e,t){return e.ratings}).map("rating").uniq().value()},t.mkAuthoritativeRatingSchemeItems=function(e){var t=function(t){return e.lookup("AuthoritativenessRating",t)};return{DISCOURAGED:{rating:"R",name:t("DISCOURAGED"),position:30,color:"#DA524B"},SECONDARY:{rating:"A",name:t("SECONDARY"),position:20,color:"#D9923F"},PRIMARY:{rating:"G",name:t("PRIMARY"),position:10,color:"#5BB65D"},NO_OPINION:{rating:"Z",name:t("NO_OPINION"),position:40,color:"#939393"}}};var i=function(e){return e&&e.__esModule?e:{default:e}}(n(1));var a=t.baseRagNames={R:{rating:"R",name:"Poor",position:30,color:"#DA524B"},A:{rating:"A",name:"Adequate",position:20,color:"#D9923F"},G:{rating:"G",name:"Good",position:10,color:"#5BB65D"},Z:{rating:"Z",name:"Unknown",position:40,color:"#939393"},X:{rating:"X",name:"Not Applicable",position:50,color:"#D1D1D1"}},o=t.investmentRagNames={R:{rating:"R",name:"Disinvest",position:30,color:"#DA524B"},A:{rating:"A",name:"Maintain",position:20,color:"#D9923F"},G:{rating:"G",name:"Invest",position:10,color:"#5BB65D"},Z:{rating:"Z",name:"Unknown",position:40,color:"#939393"},X:{rating:"X",name:"Not Applicable",position:50,color:"#D1D1D1"}},r={base:a,investment:o}}}]);